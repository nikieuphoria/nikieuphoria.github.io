<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>The Fountainhead</title>
  <icon>https://www.gravatar.com/avatar/5b3fe3154f9feca5494c1336bceab02e</icon>
  <subtitle>flee as a bird to your blue sea</subtitle>
  <link href="https://nikieuphoria.github.io/atom.xml" rel="self"/>
  
  <link href="https://nikieuphoria.github.io/"/>
  <updated>2025-12-11T08:10:47.871Z</updated>
  <id>https://nikieuphoria.github.io/</id>
  
  <author>
    <name>niki</name>
    <email>zn40489@gmail.com</email>
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>008-moment</title>
    <link href="https://nikieuphoria.github.io/2025/12/30/008-moment/"/>
    <id>https://nikieuphoria.github.io/2025/12/30/008-moment/</id>
    <published>2025-12-29T16:00:00.000Z</published>
    <updated>2025-12-11T08:10:47.871Z</updated>
    
    <content type="html"><![CDATA[<ol><li><p>用脚投票（Voting by foot &#x2F; Vote by foot）</p><blockquote><p>通过迁移到更符合自己偏好和利益的地区，来表达对原所在地的不满和支持。</p></blockquote></li><li><p>国家是在特定领土内垄断合法暴力使用权的机构</p></li><li><p>利维坦：Leviathan，国家权力的终极形态，通过权力集中来化解无政府状态下的”war of all against all“</p></li><li><p>创作者的宿命：自我反思都逃不出”观察-描摹-复述”的循环</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;ol&gt;
&lt;li&gt;&lt;p&gt;用脚投票（Voting by foot &amp;#x2F; Vote by foot）&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;通过迁移到更符合自己偏好和利益的地区，来表达对原所在地的不满和支持。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;国</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>007-2025年的故事</title>
    <link href="https://nikieuphoria.github.io/2025/12/25/007-2025%E7%9A%84%E7%BB%93%E6%9D%9F/"/>
    <id>https://nikieuphoria.github.io/2025/12/25/007-2025%E7%9A%84%E7%BB%93%E6%9D%9F/</id>
    <published>2025-12-24T16:00:00.000Z</published>
    <updated>2025-12-11T08:10:11.545Z</updated>
    
    <content type="html"><![CDATA[<p>我尽量忍住不说一些不具体的、意向式的思考和感受了。</p><p>看到友邻的blog，看到她五年前的一些记录，这种跨越时空的感受真是有趣！</p><p>所以我决定写一些具体的事情，避免几年后我看不懂自己在思考什么（~</p><blockquote><p>钱塘江上潮信来，今日方知我是我。</p></blockquote><p><img src="/images/sky1.jpg" alt="EC2"></p><p>其实我有点迷茫，“迷茫”是好俗套使用频率好高的一个词语。</p><p>但这几次的迷茫有点不一样。</p><p>上学时期的迷茫，无非是选哪一种效率更高的学习方式，无法是时间放在哪一科上成效最高</p><p>这几次的迷茫，时间维度拉长到剩下的一生，不结婚不生育，那我要做什么呢？</p><p>如果一直从事本行业，我会慢慢掌握技术，慢慢学会侃侃而谈，可是难道我能忍受吗？</p><p>我好像无法忍受。</p><p>夜晚会有行蚁似的躁动在血液里面奔涌，对可能让人生颠倒的选择上瘾。</p><p>百无聊赖打开steam，却又不太想玩游戏。</p><p>在希望和失望里面等待，反反复复，陷入循环。</p><p>When I was still trapped in that job, I imagined many times what I would say in my resignation letter. In fact, this imagination gave me a lot of strength to survive each day.<br>Yet another pain haunted me.None of the 14 people who joined with me as new grads had left.<br>I was terrified of being the first, terrified of leaving with nothing lined up，terrified of looking like a failure<br><img src="/images/maxin.jpg" alt="EC2"></p><p>周六和wxy一起出门玩，凌晨在灯光暗沉的酒吧喝了一杯评鉴不来的酒。</p><p>和nana约定下次在泰国见，我还在思考什么时候去。<br><img src="/images/letters.jpg" alt="EC2"></p><h4 id="2025"><a href="#2025" class="headerlink" title="2025"></a>2025</h4><ul><li><input disabled type="checkbox"> 第一个tattoo</li><li><input disabled type="checkbox"> 内部转岗</li><li><input disabled type="checkbox"> 参加社招</li><li><input disabled type="checkbox"> 跨省搬家</li><li><input disabled type="checkbox"> CKA</li><li><input disabled type="checkbox"> steam游戏时长100h+</li><li><input disabled type="checkbox"> 播客收听时长100h+</li><li><input disabled type="checkbox"> 阅读时长170h+</li><li><input disabled type="checkbox"> 搭建起自己的linkedin，connect了一些大姥</li><li><input disabled type="checkbox"> 专题写作5w字，虽然感觉又搁置了</li><li><input disabled type="checkbox"> 公众号约稿一篇，也传递出一点点光亮</li><li><input disabled type="checkbox"> 从喝酒中获得快乐</li><li><input disabled type="checkbox"> 体检结果很健康</li><li><input disabled type="checkbox"> 辞职（ing）</li><li><input disabled type="checkbox"> 尝试了date app</li></ul><p>今年我愈发觉得，在公司希望人成为没有怨言的牛马工具的时代，我更应该保留自己的柔软和尖锐，绝对不要背叛自己。<br>I’m a human being.</p><h4 id="2026"><a href="#2026" class="headerlink" title="2026"></a>2026</h4><ul><li><input disabled type="checkbox"> ILETS</li><li><input disabled type="checkbox"> 学习go语言</li><li><input disabled type="checkbox"> 学会自由泳</li><li><input disabled type="checkbox"> 学一些理财、金融知识</li><li><input disabled type="checkbox"> 了解web3</li><li><input disabled type="checkbox"> 健身（<del>奢望</del>）</li><li><input disabled type="checkbox"> 阅读30本书</li><li><input disabled type="checkbox"> solo trip</li><li><input disabled type="checkbox"> 12部纪录片（）</li><li><input disabled type="checkbox"> 尝试episoden</li><li><input disabled type="checkbox"> 读《SRE-google运维解密》</li><li><input disabled type="checkbox"> 更加具体地记录生活，写成博客</li><li><input disabled type="checkbox"> 学习K8S的设计模式（陈皓的博客）</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;我尽量忍住不说一些不具体的、意向式的思考和感受了。&lt;/p&gt;
&lt;p&gt;看到友邻的blog，看到她五年前的一些记录，这种跨越时空的感受真是有趣！&lt;/p&gt;
&lt;p&gt;所以我决定写一些具体的事情，避免几年后我看不懂自己在思考什么（~&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;钱塘江上潮信来</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>006-奥德赛时间</title>
    <link href="https://nikieuphoria.github.io/2025/11/04/006-%E5%A5%A5%E5%BE%B7%E8%B5%9B%E6%97%B6%E9%97%B4/"/>
    <id>https://nikieuphoria.github.io/2025/11/04/006-%E5%A5%A5%E5%BE%B7%E8%B5%9B%E6%97%B6%E9%97%B4/</id>
    <published>2025-11-03T16:00:00.000Z</published>
    <updated>2025-11-19T09:39:26.294Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>The Odyssey Times<br>源自古希腊史诗《奥德赛》（<em>Odyssey</em>）——荷马的两大史诗之一，讲的是奥德修斯在特洛伊战争后返乡的漫长旅程。于是“奥德赛时期”常被比喻成一个文明或个人在漂泊、考验、寻找自我意义的阶段。</p></blockquote><p>反刍痛苦，然后像是灵魂出窍一样过了一周两周一个月半年。</p><p>描述摸不着的痛苦，就如同隔着橱窗看买不起的漂亮礼物。就如同我现在也“感受”不到五六年前排山倒海的溺亡感。</p><p>同时我又是一个记忆力飘渺的人，时间在我脑海里从不是线性，而是大珠小珠落玉盘。故此我还是记录一下最近发生的事情：</p><p>上周面试了两家公司，马不停蹄的三场面试。一家面完一个小时HR立马打电话约二面了，还在等结果。</p><p>最近在玩《星露谷物语》，已经80 hour+。<br>《沉默意志》，画风的设计都非常令人惊喜，很漂亮！<br>《纸房子》还没有玩完，当成故事看，并没有代入感。我学生时代不算乖乖牌，但当时脑子里最大的念头还是“我要学习”。能够感受到家庭的窒息，学校里面人际交往的被凝视感。</p><p>周六去体检了，没有结节囊肿，指标一路绿灯。还以为情绪会变成身体里的一个存在。</p><p>很讨厌美团，淘宝等一众国内app，界面臃肿，信息过载，弹窗横飞，颜色刺眼，跳一跳就转了好几个软件。</p><p>近一年关注了很多电影博主，女性视角下温柔坚定敏锐的特质一一展现。最近最喜欢的是<em>辣椒梦话</em>博主。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;The Odyssey Times&lt;br&gt;源自古希腊史诗《奥德赛》（&lt;em&gt;Odyssey&lt;/em&gt;）——荷马的两大史诗之一，讲的是奥德修斯在特洛伊战争后返乡的漫长旅程。于是“奥德赛时期”常被比喻成一个文明或个人在漂泊、考验、寻找自我意义的阶段。&lt;</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>20251105-Is breakfast the most important meal of the day</title>
    <link href="https://nikieuphoria.github.io/2025/11/04/20251105-Is%20breakfast%20the%20most%20important%20meal%20of%20the%20day/"/>
    <id>https://nikieuphoria.github.io/2025/11/04/20251105-Is%20breakfast%20the%20most%20important%20meal%20of%20the%20day/</id>
    <published>2025-11-03T16:00:00.000Z</published>
    <updated>2025-11-05T08:01:45.827Z</updated>
    
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="language" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/language/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>005-alcohol  &amp;   cigarette</title>
    <link href="https://nikieuphoria.github.io/2025/10/22/005-alcohol%20%20&amp;%20%20%20cigarette/"/>
    <id>https://nikieuphoria.github.io/2025/10/22/005-alcohol%20%20&amp;%20%20%20cigarette/</id>
    <published>2025-10-21T16:00:00.000Z</published>
    <updated>2025-11-19T09:48:26.973Z</updated>
    
    <content type="html"><![CDATA[<p>伊甸园里，蛇诱惑人类吃下苹果，他们从此有了羞耻心，用树叶遮蔽身体。人能承担在别人面前缴械的下场吗？</p><p>袒露脆弱、自私、虚荣、伪善、刻薄和矫情，是另外一层树叶。</p><p><em>世界是由强烈的信念、贫乏的想象力和微弱的理解所支配的。</em></p><p>我需要绝对强烈的信念，更狂妄的想象，以及放弃对理解的渴望。</p><hr><p>自诩不喜欢玩游戏，但只要我一入迷，就有千万种借口安慰自己通宵玩游戏没关系，事情紧迫近在眼前没关系，ddl已经变成套在脖颈的绳索也没关系。</p><p>这些狂喜的沉迷，让我已然忘记“我”本身，我只是承载游戏的工具，我只需要作为角色去思考就行，况且不行就氪金，再不行就回档，又或者永远有下一个春天，别那么焦虑。</p><p>但越让我沉迷，就越会出现一种现象：某个未知的瞬间，“我”立马回归我，然后药效褪去，潮水退去，疯狂变成冬天哈出的一口气，什么都没有留下，我再也无法沉迷。</p><hr><p>大学中有一段时间，我无法相信自己能活到中年，悲观和痛苦像是腌咸菜一样，将绝望和抑郁腌制进我的身体里。</p><p>还记得有一个场景，舍友在畅想未来，我却无法想象自己四五十岁的样子。</p><p>我的梦向来充满鬼魅、杀人狂、天灾和死亡，心理学说这是焦虑，中医说这是精神衰弱，我已经坦然接受，这可能是我喜欢cult片恐怖片丧尸片的原因之一。<br>做过自杀的梦：当时情况紧急，割腕死不了还得找刀，第二选择是跳楼，还有吃药。梦里的情绪如此真实，抉择如此真实。</p><hr><p>请问niki11月可以找到一份更好的工作吗</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">帮我解说这一支签文：第二十籤</span><br><span class="line">中平　裴度為相</span><br><span class="line">天上仙花難問種。人間塵事幾多更。</span><br><span class="line">前程己註公私簿。罰賞分明濁與清。(己同已)</span><br><span class="line">仙機：</span><br><span class="line">名與利。附之命。</span><br><span class="line">病審醫。婚未定。</span><br><span class="line">宅平安。要修省。</span><br><span class="line">孕與蚕。作福吉。</span><br><span class="line">行欲歸。難定日。</span><br><span class="line">若謀望。修善得。</span><br><span class="line">問風水：全憑心地發。</span><br><span class="line">問遺失：求之終可得。</span><br><span class="line">問自身：禍福自己求。</span><br><span class="line">問天時：隨我意轉移。</span><br><span class="line">問出行：如修善可去。</span><br><span class="line"></span><br><span class="line">解說及記載：</span><br><span class="line">雪梅為安南國王之宮主。特徵聯求婚。</span><br><span class="line">其聯首曰。太極殿前三尺雪。</span><br><span class="line">後有廣東人。姓黃名華貴。當時福至心靈。</span><br><span class="line">以梅之得植於人間。原出於天上仙花之種。</span><br><span class="line">乃以。廣寒宮裏一枝梅。為聯比以應徵。卒獲招為駙馬。</span><br><span class="line">論此簽意。凡事平穩。倘能力行善事。當可獲福也。</span><br><span class="line"></span><br><span class="line">■裴度為相</span><br><span class="line">唐朝。裴度貧落未遇。相士相他縱理(紋)入口。</span><br><span class="line">法當餓死。後遊香山寺中。拾得三條寶帶。</span><br><span class="line">裴度坐而守之。少頃一婦哭來。曰借帶贖父罪。</span><br><span class="line">裴度即交回婦。又遇前相士驚曰。相改可有陰德乎。</span><br><span class="line">乃言還帶一節。後裴度進身及第。位至宰相。進爵晉國公。</span><br><span class="line">壽登耄耋。</span><br></pre></td></tr></table></figure><p>niki今年能能够脱离这个（工作）环境吗</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">## 第三十五籤</span><br><span class="line"></span><br><span class="line">#### 中吉　唐僧取經</span><br><span class="line"></span><br><span class="line">#### 天將降任此其人。筋骨先勞苦彼身。  </span><br><span class="line">莫謂佳景來可易。貧窮富貴有前因。</span><br><span class="line"></span><br><span class="line">**仙機：**  </span><br><span class="line">名與利。求實難。  </span><br><span class="line">蚕與畜。盡力看。  </span><br><span class="line">病漸愈。婚有緣。  </span><br><span class="line">論家宅。要積德。  </span><br><span class="line">謀望者。當審擇。  </span><br><span class="line">問行人。難揣測。</span><br><span class="line"></span><br><span class="line">問風水：時到自然發。  </span><br><span class="line">問遺失：尋之宜勉力。  </span><br><span class="line">問自身：修善得平安。  </span><br><span class="line">問天時：豐耗無定期。  </span><br><span class="line">問出行：進退當慎之。</span><br><span class="line"></span><br><span class="line">**解說及記載：**  </span><br><span class="line">天將以大任降此人。必先以貧窮勞苦其身。  </span><br><span class="line">莫謂富貴發達。佳景來得輕易。  </span><br><span class="line">人之貧窮富貴。有前世因果也。  </span><br><span class="line">求得此簽者。要立一片善心。凡事勿辭勞苦。將來必有報應。  </span><br><span class="line">就此簽而論。有佳景二字。實則此簽有吉而無凶。  </span><br><span class="line">但必先要一番艱辛。不修善則富貴不來也。  </span><br><span class="line">此先難後易之簽。要慎妨小人口舌。</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;伊甸园里，蛇诱惑人类吃下苹果，他们从此有了羞耻心，用树叶遮蔽身体。人能承担在别人面前缴械的下场吗？&lt;/p&gt;
&lt;p&gt;袒露脆弱、自私、虚荣、伪善、刻薄和矫情，是另外一层树叶。&lt;/p&gt;
&lt;p&gt;&lt;em&gt;世界是由强烈的信念、贫乏的想象力和微弱的理解所支配的。&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>kubenetes</title>
    <link href="https://nikieuphoria.github.io/2025/09/30/kubernetes/"/>
    <id>https://nikieuphoria.github.io/2025/09/30/kubernetes/</id>
    <published>2025-09-29T16:00:00.000Z</published>
    <updated>2025-11-03T03:28:35.809Z</updated>
    
    <content type="html"><![CDATA[<h2 id="一、-集群架构"><a href="#一、-集群架构" class="headerlink" title="一、 集群架构"></a>一、 集群架构</h2><h3 id="1-1-集群架构"><a href="#1-1-集群架构" class="headerlink" title="1.1 集群架构"></a>1.1 集群架构</h3><ul><li><p><strong>概念</strong>：Master Node (控制平面) 和 Worker Node (工作节点) 的职责。</p></li><li><p><strong>组件</strong>：</p><ul><li><p><strong>Master Node</strong>：<code>kube-apiserver</code>, <code>kube-scheduler</code>, <code>kube-controller-manager</code>, <code>etcd</code></p><ul><li><code>etcd</code>：数据存储，键值对数据库。</li></ul></li><li><p><strong>Worker Node</strong>：<code>kubelet</code>, <code>kube-proxy</code>, 容器运行时 (Container Runtime, 如 containerd&#x2F;Docker)。</p></li></ul></li><li><p><strong>关键点</strong>：各组件功能、通信方式。</p></li><li><p><strong>思维导图&#x2F;草图</strong>：绘制K8s集群组件图。</p></li></ul><h3 id="1-2-API-对象-API-Objects"><a href="#1-2-API-对象-API-Objects" class="headerlink" title="1.2 API 对象 (API Objects)"></a>1.2 API 对象 (API Objects)</h3><ul><li><strong>概念</strong>：K8s 中一切皆对象。</li></ul><p>K8s 把资源按功能、稳定性、来源，分成不同的 group，每个 group 里可能有几个资源种类（kind）+ 各自的版本（v1）。</p><table><thead><tr><th>Kind</th><th>usage</th></tr></thead><tbody><tr><td><code>Pod</code></td><td>最基本的运行单元</td></tr><tr><td><code>Service</code></td><td>网络访问入口，抽象 Pod 集合</td></tr><tr><td><code>ConfigMap</code></td><td>配置数据，挂进容器</td></tr><tr><td><code>Secret</code></td><td>加密信息（密码、token）</td></tr><tr><td><code>PersistentVolume</code></td><td>静态磁盘资源</td></tr><tr><td><code>PersistentVolumeClaim</code></td><td>申请磁盘</td></tr><tr><td><code>Namespace</code></td><td>空间隔离，逻辑项目划分</td></tr><tr><td><code>Node</code></td><td>集群节点，通常由系统管理</td></tr><tr><td><code>LimitRange</code></td><td>限制单个 Pod 资源使用范围</td></tr><tr><td><code>ResourceQuota</code></td><td>限制整个 namespace 的资源用量</td></tr></tbody></table><h3 id="1-3-YAML-文件-YAML-Files"><a href="#1-3-YAML-文件-YAML-Files" class="headerlink" title="1.3 YAML 文件 (YAML Files)"></a>1.3 YAML 文件 (YAML Files)</h3><ul><li><p><strong>概念</strong>：K8s 配置文件的主要格式。</p></li><li><p><strong>YAML 基础</strong>：缩进、键值对、列表、块序列。</p></li><li><p><strong><code>kubectl</code> 配合</strong>：<code>kubectl apply -f &lt;file.yaml&gt;</code>, <code>kubectl create -f &lt;file.yaml&gt; --dry-run=client -o yaml &gt; output.yaml</code>。</p></li></ul><h3 id="1-4-kubectl-基础-kubectl-Basics"><a href="#1-4-kubectl-基础-kubectl-Basics" class="headerlink" title="1.4 kubectl 基础 (kubectl Basics)"></a>1.4 <code>kubectl</code> 基础 (kubectl Basics)</h3><ul><li><p><strong>配置</strong>：<code>~/.kube/config</code> 文件。</p></li><li><p><strong>常用命令</strong>：</p><ul><li><p><code>kubectl get &lt;resource&gt; -o wide</code></p></li><li><p><code>kubectl describe &lt;resource&gt; &lt;name&gt;</code></p></li><li><p><code>kubectl create/apply/delete -f &lt;file.yaml&gt;</code></p></li><li><p><code>kubectl edit &lt;resource&gt; &lt;name&gt;</code></p></li><li><p><code>kubectl run &lt;pod-name&gt; --image=&lt;image&gt; --restart=Never --dry-run=client -o yaml</code></p></li><li><p><code>kubectl logs &lt;pod-name&gt; [-c &lt;container-name&gt;]</code></p></li><li><p><code>kubectl exec -it &lt;pod-name&gt; [-c &lt;container-name&gt;] -- bash</code></p></li></ul></li><li><p><strong>命令速查表</strong>：整理常用的 <code>kubectl</code> 命令和参数。</p></li><li><p><strong>技巧</strong>：<code>--dry-run=client -o yaml</code>, <code>--force</code>, <code>-w</code> (watch)。</p></li></ul><h2 id="二、集群安装与配置"><a href="#二、集群安装与配置" class="headerlink" title="二、集群安装与配置"></a>二、集群安装与配置</h2><h3 id="2-1-kubeadm-工具-kubeadm-Tool"><a href="#2-1-kubeadm-工具-kubeadm-Tool" class="headerlink" title="2.1 kubeadm 工具 (kubeadm Tool)"></a>2.1 <code>kubeadm</code> 工具 (kubeadm Tool)</h3><ul><li><strong>概念</strong>：用于快速安装 K8s 集群的工具。</li></ul><h3 id="2-2-组件配置-Component-Configuration"><a href="#2-2-组件配置-Component-Configuration" class="headerlink" title="2.2 组件配置 (Component Configuration)"></a>2.2 组件配置 (Component Configuration)</h3><ul><li><p><strong><code>kubelet</code></strong>：配置 (Cgroup Driver, <code>kubeconfig</code> 路径)。</p></li><li><p><strong>API Server</strong>：端口、认证方式、准入控制器 (Admission Controllers)。</p></li><li><p><strong>Controller Manager &#x2F; Scheduler</strong>：相关启动参数。</p></li></ul><h3 id="2-3-证书管理-Certificate-Management"><a href="#2-3-证书管理-Certificate-Management" class="headerlink" title="2.3 证书管理 (Certificate Management)"></a>2.3 证书管理 (Certificate Management)</h3><ul><li><p><strong>概念</strong>：K8s 各组件间通过 TLS 证书进行安全通信。</p></li><li><p><strong>核心证书</strong>：<code>ca.crt</code>, <code>ca.key</code>, <code>apiserver.crt</code>, <code>apiserver.key</code>, <code>kubelet.crt</code>, <code>kubelet.key</code> 等。</p></li><li><p><strong>签发方式</strong>：<code>kubeadm</code> 自动管理、手动签发 (<code>cfssl</code> 或 <code>openssl</code>)。</p></li><li><p><strong>续期</strong>：<code>kubeadm certs renew</code>。</p></li></ul><h3 id="2-4-备份与恢复-Backup-Restore"><a href="#2-4-备份与恢复-Backup-Restore" class="headerlink" title="2.4 备份与恢复 (Backup &amp; Restore)"></a>2.4 备份与恢复 (Backup &amp; Restore)</h3><ul><li><p><strong>ETCD 备份</strong>：</p><ul><li><p>概念：K8s 所有集群状态都存储在 ETCD 中。</p></li><li><p>命令：<code>etcdctl snapshot save</code>, <code>etcdctl snapshot restore</code>。</p></li><li><p>关键参数：证书路径 (<code>--cacert</code>, <code>--cert</code>, <code>--key</code>)。</p></li></ul></li><li><p><strong>恢复步骤</strong>：停止 <code>kube-apiserver</code>, <code>kube-controller-manager</code>, <code>kube-scheduler</code>, 恢复 ETCD, 重启组件。</p></li></ul><h2 id="三、应用生命周期管理"><a href="#三、应用生命周期管理" class="headerlink" title="三、应用生命周期管理"></a>三、应用生命周期管理</h2><h3 id="3-1-Pod-管理-Pod-Management"><a href="#3-1-Pod-管理-Pod-Management" class="headerlink" title="3.1 Pod 管理 (Pod Management)"></a>3.1 Pod 管理 (Pod Management)</h3><ul><li><strong>概念</strong>：K8s 最小调度单位，包含一个或多个容器。</li><li><strong>生命周期</strong>：Pending, Running, Succeeded, Failed, Unknown。</li><li><strong>重启策略</strong>：Always, OnFailure, Never。</li><li><strong>共享资源</strong>：网络、存储。</li></ul><p><strong>Pod</strong> 是可以在 Kubernetes 中创建和管理的、最小的可部署的计算单元。</p><p><strong>容器之间共享：</strong></p><ul><li>网络命名空间（同一个 IP，端口互通）</li><li>存储卷（Volume）</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get pods              <span class="comment"># 查看 Pod 列表</span></span><br><span class="line">kubectl describe pod my-pod   <span class="comment"># 查看详细信息</span></span><br><span class="line">kubectl logs my-pod           <span class="comment"># 查看日志</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it my-pod -- /bin/bash  <span class="comment"># 进容器</span></span><br><span class="line">kubectl delete pod my-pod     <span class="comment"># 删除 Pod</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>共享网络：<strong>通过Pause容器，把其他业务容器加入到Pause容器里面，让所有业务容器在同一个名称空间中，可以实现网络共享。</strong></li></ul><p>容器本身之间相互隔离的（namespace、group）<br>前提条件：容器在同一个ns里面<br>每一个Pod都有一个特殊的被称为“根容器”的pause容器。</p><h4 id="3-1-1创建pod的方式"><a href="#3-1-1创建pod的方式" class="headerlink" title="3.1.1创建pod的方式"></a>3.1.1创建pod的方式</h4><h5 id="kubectl-run临时创建"><a href="#kubectl-run临时创建" class="headerlink" title="kubectl run临时创建"></a>kubectl run临时创建</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl run tomcat --image=xianchao/tomcat-8.5-jre8:v1  --image-pull-policy=<span class="string">&#x27;IfNotPresent&#x27;</span>  --port=8080</span><br></pre></td></tr></table></figure><h5 id="用-YAML-文件创建-Pod"><a href="#用-YAML-文件创建-Pod" class="headerlink" title="用 YAML 文件创建 Pod"></a>用 YAML 文件创建 Pod</h5><p>#<strong>工作节点</strong>上ctr导入镜像 ctr -n&#x3D;<a href="http://k8s.io/">k8s.io</a> images import xianchao-tomcat.tar.gz #查看导入镜像 ctr -n&#x3D;<a href="http://k8s.io/">k8s.io</a> images list |grep nginx</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">tomcat</span>  <span class="comment">#Pod的名字</span></span><br><span class="line">    <span class="attr">labels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">myapip</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment">#规格规范</span></span><br><span class="line">  <span class="attr">containers:</span>   <span class="comment">#必须写的字段</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-c</span>  <span class="comment">#Pod里容器的名字</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">xianchao/tomcat-8.5-jre8:v1</span>  </span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>定义一个Pod资源，Pod被删除，就彻底被删除</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl apply -f pod-tomcat.yaml</span><br><span class="line">[root@master ~]# kubectl describe pod tomcat -n default</span><br><span class="line">Name:             tomcat</span><br><span class="line">Namespace:        default</span><br><span class="line">Priority:         0</span><br><span class="line">Service Account:  default</span><br><span class="line">Node:             node1/172.20.196.18</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># YAML 里没指定pod分配到哪个node上，master node上的scheduler 自己分配到pode1。</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="控制器创建"><a href="#控制器创建" class="headerlink" title="控制器创建"></a>控制器创建</h5><p>常见的管理Pod的控制器：Replicaset、Deployment、Job、CronJob、Daemonset、Statefulset。</p><p>控制器管理的Pod可以确保Pod始终维持在<strong>指定的副本数</strong>运行。</p><p>pod,spec.selector-<strong>标签过滤器</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">apiVersion: apps/v1  <span class="comment">#Kubernetes 的 API 版本，apps/v1 是这类控制器的标准版本</span></span><br><span class="line">kind: Deployment   <span class="comment">#创建控制器</span></span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-test</span><br><span class="line">  labels:</span><br><span class="line">    app: nginx-deploy</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: my-nginx</span><br><span class="line">        image: xianchao/nginx:v1</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除控制器</span></span><br><span class="line">kubectl delete deployment &lt;deployment-name&gt;</span><br></pre></td></tr></table></figure><h4 id="3-1-2-资源配额"><a href="#3-1-2-资源配额" class="headerlink" title="3.1.2 资源配额"></a>3.1.2 资源配额</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#定义resource quota应用到namespace</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ResourceQuota</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">resource1</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">resourcequota-label:</span> <span class="string">ns-test-label</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ns-test</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hard:</span></span><br><span class="line">    <span class="attr">limits.cpu:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">limits.memory:</span> <span class="string">2Gi</span></span><br><span class="line">    <span class="attr">requests.cpu:</span> <span class="number">2</span></span><br><span class="line">    <span class="attr">requests.memory:</span> <span class="string">1Gi</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#应用资源配额</span></span><br><span class="line"><span class="string">kubectl</span> <span class="string">apply</span> <span class="string">-f</span> <span class="string">namespace-quota.yaml</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-2pod生命周期"><a href="#3-2pod生命周期" class="headerlink" title="3.2pod生命周期"></a>3.2pod生命周期</h3><h4 id="3-2-1Pod的五个阶段（Phase）"><a href="#3-2-1Pod的五个阶段（Phase）" class="headerlink" title="3.2.1Pod的五个阶段（Phase）"></a>3.2.1Pod的五个阶段（Phase）</h4><p>pod从开pod从开始创建到终止退出的时间范围称为Pod生命周期始创建到终止退出的时间范围称为Pod生命周期 在整个生命周期中，Pod会出现几种<strong>状态</strong>（<strong>相位</strong>）：</p><ol><li><strong>Pending</strong><ul><li>API Server 收到你创建 Pod 的请求，Pod 信息写进 etcd</li><li>还没调度到节点，或者镜像还在拉取</li></ul></li><li><strong>ContainerCreating</strong><ul><li>调度器找好节点，Kubelet 开始创建 pause 容器、挂卷、拉镜像</li></ul></li><li><strong>Running</strong><ul><li>所有容器启动成功，开始对外提供服务</li><li>期间会跑健康探针（存活性&#x2F;就绪性）来判断是不是还活着</li></ul></li><li><strong>Succeeded</strong><ul><li>Pod 里的容器都正常结束（退出码 0）</li><li>常见于一次性任务（Job）</li></ul></li><li><strong>Failed</strong><ul><li>所有容器都结束了，但至少一个是异常退出（退出码非 0）</li></ul></li><li><strong>Unknown</strong><ul><li>K8s 根本问不到节点的 kubelet 状态，Pod 状态成谜</li></ul></li></ol><h4 id="3-2-2pod重启策略"><a href="#3-2-2pod重启策略" class="headerlink" title="3.2.2pod重启策略"></a>3.2.2pod重启策略</h4><p>Pod的重启策略（RestartPolicy）应用于Pod内的所有容器，当某个容器异常退出或者健康检查失败时，kubelet将根据 重启策略来进行相应的操作。</p><p>Pod.spec.restartPolicy</p><ul><li>Always：只要容器异常退出，kubelet就会自动重启该容器。（这个是默认的重启策略）</li><li>OnFailure：当容器终止运行且退出码不为0时，由kubelet自动重启该容器。</li><li>Never：不论容器运行状态如何，kubelet都不会重启该容器。</li></ul><h4 id="3-2-3Init-容器：主容器前的准备工序"><a href="#3-2-3Init-容器：主容器前的准备工序" class="headerlink" title="3.2.3Init 容器：主容器前的准备工序"></a><strong>3.2.3Init 容器</strong>：主容器前的准备工序</h4><ul><li><strong>创建 pause 容器</strong><ul><li>Pod 的第一个容器，主要干网络和命名空间的事，其他容器都挂它下面</li></ul></li><li><strong>跑 Init 容器（InitContainers）</strong><ul><li>顺序执行，干完才能启动主容器</li><li>常用来准备数据、等依赖服务可用</li></ul></li><li><strong>启动主容器（Containers）</strong><ul><li>正式跑业务代码的地方</li></ul></li></ul><h4 id="3-2-4hooks钩子"><a href="#3-2-4hooks钩子" class="headerlink" title="3.2.4hooks钩子"></a>3.2.4hooks钩子</h4><p>pod.spec.containers.lifecycle.</p><ul><li><strong>PostStart</strong>：容器刚启动就执行</li><li><strong>PreStop</strong>：容器结束前执行（可做清理或优雅下线）</li></ul><p>当用户请求删除含有pod的资源对象时（如RC、deployment等），K8S为了让应用程序优雅关闭（<strong>即让应用程序完成正在处理的请求后，再关闭软件</strong>），K8S提供两种信息通知：</p><ul><li>默认情况下，K8s 调用 <code>docker stop</code>，容器先接收 SIGTERM 信号，若应用在超时时间内未退出，则强制 SIGKILL。</li><li>若配置了 <code>preStop</code> 回调，则在 SIGTERM 前会先执行预定义操作，从而实现更平滑的下线。</li></ul><p> 案例演示</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">life-demo</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">lifecycle-demo-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">docker.io/xianchao/nginx:v1</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">lifecycle:</span></span><br><span class="line">      <span class="attr">postStart:</span></span><br><span class="line">         <span class="attr">exec:</span></span><br><span class="line">           <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>,<span class="string">&quot;echo &#x27;lifecycle hookshandler&#x27; &gt; /usr/share/nginx/html/test.html&quot;</span>]</span><br><span class="line">      <span class="attr">preStop:</span></span><br><span class="line">         <span class="attr">exec:</span></span><br><span class="line">           <span class="attr">command:</span></span><br><span class="line">           <span class="bullet">-</span> <span class="string">&quot;/bin/sh&quot;</span></span><br><span class="line">           <span class="bullet">-</span> <span class="string">&quot;-c&quot;</span></span><br><span class="line">           <span class="bullet">-</span> <span class="string">&quot;nginx -s stop&quot;</span></span><br></pre></td></tr></table></figure><p>curl ip&#x2F;test.html</p><h4 id="3-2-5probe探针"><a href="#3-2-5probe探针" class="headerlink" title="3.2.5probe探针"></a>3.2.5probe探针</h4><h5 id="1-Liveness-Probe（存活探针）"><a href="#1-Liveness-Probe（存活探针）" class="headerlink" title="1. Liveness Probe（存活探针）"></a>1. Liveness Probe（存活探针）</h5><p><strong>作用</strong>：检测容器是否还在运行</p><ul><li>如果检测失败，kubelet会杀死容器，然后根据重启策略决定是否重启</li><li>用于检测应用程序死锁、无响应等情况</li></ul><p><strong>使用场景</strong>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">livenessProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/healthz</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-Readiness-Probe（就绪探针）"><a href="#2-Readiness-Probe（就绪探针）" class="headerlink" title="2. Readiness Probe（就绪探针）"></a>2. Readiness Probe（就绪探针）</h5><p><strong>作用</strong>：检测容器是否准备好接收流量</p><ul><li>如果检测失败，会将Pod从Service的Endpoints中移除，停止转发流量</li><li>容器不会被重启，只是暂时不接收请求</li></ul><p><strong>使用场景</strong>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">readinessProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/ready</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">initialDelaySeconds:</span> <span class="number">5</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">5</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="3-Startup-Probe（启动探针）"><a href="#3-Startup-Probe（启动探针）" class="headerlink" title="3. Startup Probe（启动探针）"></a>3. Startup Probe（启动探针）</h5><p><strong>作用</strong>：检测容器内的<strong>应用程序</strong>是否已经启动</p><ul><li>在Startup Probe成功之前，其他两个探针会被禁用</li><li>主要用于启动时间较长的容器</li></ul><p><strong>使用场景</strong>：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">startupProbe:</span></span><br><span class="line">  <span class="attr">httpGet:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/startup</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">failureThreshold:</span> <span class="number">30</span></span><br><span class="line">  <span class="attr">periodSeconds:</span> <span class="number">10</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="探针检测方式"><a href="#探针检测方式" class="headerlink" title="探针检测方式"></a>探针检测方式</h5><p><strong>HTTP GET</strong>：发送HTTP请求，返回200-399状态码表示成功<br><strong>TCP Socket</strong>：尝试建立TCP连接<br><strong>Exec</strong>：在容器内执行命令，返回码为0表示成功</p><p> 关键参数</p><ul><li><code>initialDelaySeconds</code>：容器启动后延迟多久开始探测</li><li><code>periodSeconds</code>：探测间隔时间</li><li><code>timeoutSeconds</code>：探测超时时间</li><li><code>successThreshold</code>：连续成功次数阈值</li><li><code>failureThreshold</code>：连续失败次数阈值</li></ul><p>这三个探针配合使用，可以确保应用程序的健康运行和流量的正确路由。</p><h3 id="3-3-DaemonSet-守护进程集"><a href="#3-3-DaemonSet-守护进程集" class="headerlink" title="3.3 DaemonSet (守护进程集)"></a>3.3 DaemonSet (守护进程集)</h3><ul><li><strong>概念</strong>：确保每个节点（或符合特定条件的节点）运行一个 Pod 副本。</li><li><strong>使用场景</strong>：日志收集代理 (Fluentd), 监控代理 (Node Exporter), 网络插件。</li></ul><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><p>DaemonSet 确保集群中每个节点都运行指定 Pod 的一个副本，常用于系统级服务</p><h4 id="主要特性"><a href="#主要特性" class="headerlink" title="主要特性"></a>主要特性</h4><ol><li><strong>一对一关系</strong>：每个符合条件的节点上最多运行一个 DaemonSet Pod</li><li><strong>自动调度</strong>：新节点加入集群时，自动在该节点创建 Pod</li><li><strong>自动清理</strong>：节点离开集群时，相应的 Pod 会被删除</li><li><strong>节点亲和性</strong>：可通过 nodeSelector、tolerations 等控制在哪些节点运行</li></ol><h4 id="典型应用场景"><a href="#典型应用场景" class="headerlink" title="典型应用场景"></a>典型应用场景</h4><ul><li><strong>日志收集</strong>：Fluentd、Filebeat 等在每个节点收集日志</li><li><strong>监控代理</strong>：Node Exporter、cAdvisor 等监控节点资源</li><li><strong>网络插件</strong>：Calico、Flannel 等网络组件</li><li><strong>存储守护进程</strong>：Ceph、GlusterFS 等分布式存储</li><li><strong>安全扫描</strong>：在每个节点运行安全检查工具、</li><li></li></ul><h4 id="yaml示例"><a href="#yaml示例" class="headerlink" title="yaml示例"></a>yaml示例</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ds-1</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">f-log</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span>   <span class="comment">#标签选择器</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">f-log</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span>   <span class="comment">#基于这回模板定义的pod具有的标签</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">f-log</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">tolerations:</span>   <span class="comment">#定义容忍度</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span>    </span><br><span class="line">        <span class="attr">effect:</span> <span class="string">NoSchedule</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fluentd-elasticsearch</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">xianchao/fluentd:v2.5.1</span></span><br><span class="line">        <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">        <span class="attr">resources:</span>          <span class="comment">#资源配额</span></span><br><span class="line">          <span class="attr">limits:</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line">          <span class="attr">requests:</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">            <span class="attr">memory:</span> <span class="string">200Mi</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/log</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line">          <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">30</span>  <span class="comment"># 停止 Pod 前等待 30 秒</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlog</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/log</span>       <span class="comment">#基于本地目录创建一个卷</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">varlibdockercontainers</span></span><br><span class="line">        <span class="attr">hostPath:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">/var/lib/docker/containers</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><p>tolerations：</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tolerations:</span>   <span class="comment"># 定义 Pod 的容忍度</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">node-role.kubernetes.io/master</span>    <span class="comment"># 匹配节点上带的 taint key</span></span><br><span class="line">    <span class="attr">effect:</span> <span class="string">NoSchedule</span>                     <span class="comment"># 表示该 taint 的效果：禁止调度</span></span><br></pre></td></tr></table></figure><p>  <strong>解释</strong>：</p><ul><li><p><strong>背景</strong>：K8s 默认会在 master 节点上打一个 taint：</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">key=node-role.kubernetes.io/master:NoSchedule</span><br></pre></td></tr></table></figure><p>  意思是：一般的 Pod 不允许调度到 master 节点上。</p></li><li><p><strong>tolerations</strong>：加了这个字段，Pod 就能“容忍”这个 taint，从而允许被调度到 master 节点。</p></li></ul><p>  <strong>备注总结</strong>：</p><ul><li><code>taint</code> 是节点的“驱赶规则”</li><li><code>toleration</code> 是 Pod 的“免死金牌”</li><li>这个例子就是：Pod 可以调度到 master 节点，不会因为 <code>NoSchedule</code> 被拒绝。</li></ul></li></ul><h3 id="3-4-StatefulSet-有状态集"><a href="#3-4-StatefulSet-有状态集" class="headerlink" title="3.4 StatefulSet (有状态集)"></a>3.4 StatefulSet (有状态集)</h3><ul><li><strong>概念</strong>：管理有状态应用（如数据库），确保 Pod 的唯一性、持久性存储和有序部署&#x2F;扩展&#x2F;删除。</li><li><strong>关键特性</strong>：稳定的网络标识、稳定的持久化存储、有序的启动&#x2F;停止&#x2F;更新。</li></ul><p>前面我们部署的应用，都是不需要存储数据，不需要记住状态的，可以随意扩充副本，每个副本都是一样的，可替代的。<br>而像数据库、Redis 这类有状态的，则不能随意扩充副本。<br>StatefulSet 会固定每个 Pod 的名字</p><h4 id="StatefulSet-特性"><a href="#StatefulSet-特性" class="headerlink" title="StatefulSet 特性"></a><strong>StatefulSet 特性</strong></h4><ul><li><strong>网络标识：</strong><ul><li>必须配合 Headless Service（<code>clusterIP: None</code>）。</li><li>这样 Pod 会有固定的 DNS 解析，比如 <code>pod.name.svc-name.namespace.svc.cluster.local</code></li><li>因此应用不要用 Pod IP，应该用 Pod 的 DNS 名。</li></ul></li><li><strong>顺序控制</strong><ul><li>Pod 创建和销毁是有序的，创建是顺序的，销毁是逆序的。</li></ul></li><li><strong>稳定的存储</strong><ul><li>搭配 VolumeClaimTemplates实现了<strong>动态存储供应</strong>，每个 Pod 会有独立的 PVC，比如 <code>data-web-0</code>, <code>data-web-1</code>。</li><li>即使 Pod 重建，挂载的 PVC 还是之前那个，不会丢数据。</li></ul></li></ul><aside> 💡<p>Headless Service</p><ul><li><strong>普通服务</strong>会为所有 Pods 提供一个单一的虚拟 IP 地址，并负责在这些 Pods 之间进行负载均衡。</li><li><strong>无头服务</strong>（Headless Service）则没有这个虚拟 IP。它的主要作用是为每个 Pod 提供一个<strong>独立的 DNS 域名</strong>。 </li></ul></aside><h6 id="yaml示例-1"><a href="#yaml示例-1" class="headerlink" title="yaml示例"></a>yaml示例</h6><p><img src="/images/statefulset.drawio.png" alt="statefulset"></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">创建headless service</span><br><span class="line">创建statefulset，2副本，模板为以nginx为镜像的容器，设置挂载点，使用叫nfs的sc</span><br><span class="line">volumeClaimTemplates使用命名为nfs的storageclass，为每个 Pod 生成独立的 PVC，PVC 再通过 StorageClass 动态申请并绑定到 PV</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata: </span><br><span class="line">  name: nginx</span><br><span class="line">  labels:</span><br><span class="line">     app: nginx</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    name: web</span><br><span class="line">  clusterIP: None   #headless服务</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">---</span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: StatefulSet</span><br><span class="line">metadata: </span><br><span class="line">  name: web</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  serviceName: &quot;nginx&quot;     #headless service的名字</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata: </span><br><span class="line">     labels:</span><br><span class="line">       app: nginx</span><br><span class="line">    spec: </span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">          name: web</span><br><span class="line">        volumeMounts:</span><br><span class="line">        - name: www</span><br><span class="line">          mountPath: /usr/share/nginx/html</span><br><span class="line">  volumeClaimTemplates:    #存储卷申请模板</span><br><span class="line">  - metadata:</span><br><span class="line">      name: www</span><br><span class="line">    spec:</span><br><span class="line">      accessModes: [&quot;ReadWriteOnce&quot;]</span><br><span class="line">      storageClassName: &quot;nfs&quot;    #指定从哪个sc存储类申请pv</span><br><span class="line">      resources:</span><br><span class="line">        requests: </span><br><span class="line">          storage: 1Gi</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-5-configmap与secret"><a href="#3-5-configmap与secret" class="headerlink" title="3.5 configmap与secret"></a>3.5 configmap与secret</h3><h4 id="configmap"><a href="#configmap" class="headerlink" title="configmap"></a>configmap</h4><p><strong>把配置抽离出来，集中管理，方便一改多用</strong>。</p><ul><li>一种 <strong>Kubernetes 原生对象</strong>，用来存储 <strong>配置数据</strong>（非敏感信息）。</li><li>数据以 <strong>键值对 (key-value)</strong> 的形式存在。</li><li>Pod 可以通过 <strong>环境变量</strong> 或者 <strong>挂载文件</strong> 的方式读取 ConfigMap。</li></ul><h5 id="1-创建ConfigMap的方式"><a href="#1-创建ConfigMap的方式" class="headerlink" title="1. 创建ConfigMap的方式"></a>1. 创建ConfigMap的方式</h5><h6 id="直接用kubectl命令"><a href="#直接用kubectl命令" class="headerlink" title="直接用kubectl命令"></a>直接用kubectl命令</h6><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从字面值创建</span></span><br><span class="line">kubectl create configmap my-config --from-literal=key1=value1 --from-literal=key2=value2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从文件创建</span></span><br><span class="line">kubectl create configmap app-config --from-file=config.properties</span><br><span class="line"></span><br><span class="line"><span class="comment"># 从目录创建</span></span><br><span class="line">kubectl create configmap configs --from-file=./config-dir/</span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="用YAML文件"><a href="#用YAML文件" class="headerlink" title="用YAML文件"></a>用YAML文件</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-config</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">database_url:</span> <span class="string">&quot;mysql://localhost:3306/mydb&quot;</span></span><br><span class="line">  <span class="attr">log_level:</span> <span class="string">&quot;info&quot;</span></span><br><span class="line">  <span class="attr">config.properties:</span> <span class="string">|</span></span><br><span class="line"><span class="string">    server.port=8080</span></span><br><span class="line"><span class="string">    server.host=0.0.0.0</span></span><br><span class="line"><span class="string">    debug=true</span></span><br><span class="line"><span class="string"></span></span><br></pre></td></tr></table></figure><h5 id="2-在Pod中使用ConfigMap"><a href="#2-在Pod中使用ConfigMap" class="headerlink" title="2. 在Pod中使用ConfigMap"></a>2. 在Pod中使用ConfigMap</h5><table><thead><tr><th>方式</th><th>用途</th><th>注入形式</th><th>场景</th></tr></thead><tbody><tr><td>configMapKeyRef</td><td>精确注入单个环境变量</td><td>特定键值对作为环境变量</td><td>只注入少量或特定配置</td></tr><tr><td>envFrom</td><td>批量注入环境变量</td><td>键值对作为环境变量</td><td>注入大量公共配置</td></tr><tr><td>Volume 挂载</td><td>注入配置文件</td><td>键值对作为文件</td><td>注入完整的 .conf, .properties 等配置文件</td></tr></tbody></table><h6 id="envfrom"><a href="#envfrom" class="headerlink" title="envfrom"></a>envfrom</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-with-bulk-config</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">envFrom:</span></span><br><span class="line">    <span class="comment"># 批量注入所有键值对作为环境变量</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">configMapRef:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">my-config</span></span><br><span class="line">    <span class="comment"># 可以添加前缀避免冲突</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h6 id="configMapKeyRef"><a href="#configMapKeyRef" class="headerlink" title="configMapKeyRef"></a>configMapKeyRef</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-with-specific-config</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">env:</span></span><br><span class="line">    <span class="comment"># 注入单个配置项</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">APP_MODE</span></span><br><span class="line">      <span class="attr">valueFrom:</span></span><br><span class="line">        <span class="attr">configMapKeyRef:</span></span><br><span class="line">          <span class="attr">name:</span> <span class="string">my-config</span>           <span class="comment"># ConfigMap 名称</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">APP_MODE</span>            <span class="comment"># 指定的键</span></span><br></pre></td></tr></table></figure><h6 id="做成volume挂载"><a href="#做成volume挂载" class="headerlink" title="做成volume挂载"></a>做成volume挂载</h6><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">app-with-config-files</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="comment"># 挂载完整 ConfigMap</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/etc/config</span>      <span class="comment"># 挂载到容器的路径</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="comment"># 挂载完整 ConfigMap</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config-volume</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">my-config</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ConfigMap更新后，环境变量不会自动更新，但挂载的文件会（有一定延迟）。生产环境中建议用文件挂载方式，更灵活。</p><h2 id="四、调度"><a href="#四、调度" class="headerlink" title="四、调度"></a>四、调度</h2><p>在 Kubernetes 中，Pod 默认由调度器（Scheduler）<strong>自动选择合适的节点</strong>来运行。如果想<strong>手动控制 Pod 去哪个节点</strong>，可以使用以下几种方式：</p><table><thead><tr><th>方法</th><th>优点</th><th>缺点</th><th>场景</th></tr></thead><tbody><tr><td>nodeName</td><td>简单直接</td><td>死板，不推荐</td><td>测试&#x2F;调试</td></tr><tr><td>nodeSelector</td><td>快速精准</td><td>功能弱</td><td>简单需求</td></tr><tr><td>nodeAffinity</td><td>灵活强大</td><td>配置稍多</td><td>精准调度</td></tr><tr><td>tolerations</td><td>控制流入</td><td>需要配合 taint</td><td>节点隔离</td></tr></tbody></table><h3 id="nodeName"><a href="#nodeName" class="headerlink" title="nodeName"></a>nodeName</h3><p>指定pod节点运行在哪个具体node上<br>kubectl explain pod.spec.nodeName</p><h3 id="4-1-节点选择器-Node-Selector"><a href="#4-1-节点选择器-Node-Selector" class="headerlink" title="4.1 节点选择器 (Node Selector)"></a>4.1 节点选择器 (Node Selector)</h3><ul><li><p><strong>概念</strong>：最简单的调度方式，通过 Pod 的 <code>nodeSelector</code> 字段与 Node 的 <code>labels</code> 匹配。</p></li><li><p><strong>YAML 示例</strong>：<br>  kubectl explain pod.spec.nodeSelector</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">label</span> <span class="string">nodes</span> <span class="string">node-1</span> <span class="string">disktype=ssd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#yaml文件中</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">disktype:</span> <span class="string">ssd</span></span><br></pre></td></tr></table></figure><p>一个 Pod 的 YAML 文件里，kubectl explain pod.spec.nodeSelector</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">label</span> <span class="string">nodes</span> <span class="string">node-1</span> <span class="string">disktype=ssd</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#yaml文件中</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nodeSelector:</span></span><br><span class="line">    <span class="attr">disktype:</span> <span class="string">ssd</span></span><br></pre></td></tr></table></figure><p>一个 Pod 的 YAML 文件里，<strong>如果同时用了 <code>nodeName</code> 和 <code>nodeSelector</code>，那就必须同时满足这俩条件，缺一不可，否则就会调度失败，Pod 一直 Pending</strong></p><h3 id="4-2-节点亲和性-Node-Affinity"><a href="#4-2-节点亲和性-Node-Affinity" class="headerlink" title="4.2 节点亲和性 (Node Affinity)"></a>4.2 节点亲和性 (Node Affinity)</h3><ul><li><p><strong>概念</strong>：更灵活的调度方式，基于 Node 标签进行“亲和”或“反亲和”调度。</p></li><li><p><strong>类型</strong>：</p><ul><li><code>requiredDuringSchedulingIgnoredDuringExecution</code> (硬性要求)</li><li><code>preferredDuringSchedulingIgnoredDuringExecution</code> (软性要求)</li></ul></li><li><p><strong>YAML 示例</strong>：</p></li></ul><h4 id="required（硬亲和性）"><a href="#required（硬亲和性）" class="headerlink" title="required（硬亲和性）"></a>required（硬亲和性）</h4><p><strong>必须满足</strong>，不满足Pod 就卡在 Pending</p><ul><li>nodeSelectorTerms:<ul><li><ul><li>matchExpressions:<br>- - key: type1 operator: “In” values:</li></ul></li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-test2</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">ns-test</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">tomcat-pod</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat-container</span></span><br><span class="line">      <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">docker.io/xianchao/tomcat-8.5-jre8:v1</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">matchExpressions:</span>     <span class="comment">#多个键值对时是 AND 关系（全部条件都要满足）</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">type1</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">&quot;In&quot;</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">va1</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">niki</span></span><br><span class="line">             </span><br></pre></td></tr></table></figure><hr><h4 id="preferred（软亲和性）"><a href="#preferred（软亲和性）" class="headerlink" title="preferred（软亲和性）"></a>preferred（软亲和性）</h4><p><strong>加分项</strong>，满足条件更优先。权重越高，pod调度的几率越大</p><ul><li><ul><li>preference:</li></ul></li><li>weight:</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">affinity:</span></span><br><span class="line">  <span class="attr">nodeAffinity:</span></span><br><span class="line">    <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">preference:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">type1</span></span><br><span class="line">              <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">              <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">value1</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-3-Pod-Affinity-Anti-Affinity"><a href="#4-3-Pod-Affinity-Anti-Affinity" class="headerlink" title="4.3 Pod Affinity&#x2F;Anti-Affinity"></a>4.3 Pod Affinity&#x2F;Anti-Affinity</h3><ul><li><p><strong>概念</strong>：基于集群中<strong>其他 Pod 的标签</strong>来调度 Pod。</p></li><li><p><strong>Pod Affinity</strong>：将 Pod 调度到特定 Pod 附近。</p></li><li><p><strong>Pod Anti-Affinity</strong>：将 Pod 远离特定 Pod 调度（如避免单点故障）。</p></li><li><p><strong>类型</strong>：<code>required</code>, <code>preferred</code>。</p></li></ul><h4 id="1-podAffinity-跟哪些pod一起"><a href="#1-podAffinity-跟哪些pod一起" class="headerlink" title="1.podAffinity -跟哪些pod一起"></a>1.podAffinity -跟哪些pod一起</h4><p>通过 label 来筛选一批 Pod，亲和性调度只影响<strong>调度时</strong>。</p><p>在 Pod Affinity 规则里，先用 labelSelector 找出符合条件的 Pod，再用 topologyKey 看这些 Pod 所在的节点和当前 Pod 的节点是否处于同一“位置”（即标签值相同），最后 namespace 决定匹配范围是当前命名空间还是跨命名空间。</p><p><strong>关键字段</strong></p><ul><li><strong>labelSelector</strong><ul><li>选出一组目标 Pod（通过标签匹配）</li></ul></li><li><strong>namespaces</strong><ul><li>目标 Pod 所在的命名空间，不填默认当前命名空间</li></ul></li><li><strong>topologyKey</strong><ul><li>表示“同一个位置”的判断依据（例如 <code>kubernetes.io/hostname</code>、<code>rack</code>、<code>zone</code>）</li></ul></li></ul><h5 id="required（硬亲和性）-1"><a href="#required（硬亲和性）-1" class="headerlink" title="required（硬亲和性）"></a>required（硬亲和性）</h5><p><strong>必须满足</strong>，否则新 Pod 卡在 <code>Pending</code>。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">yaml</span></span><br><span class="line"><span class="string">CopyEdit</span></span><br><span class="line"><span class="attr">affinity:</span></span><br><span class="line">  <span class="attr">podAffinity:</span></span><br><span class="line">    <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">              <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">              <span class="attr">values:</span></span><br><span class="line">                <span class="bullet">-</span> <span class="string">myapp</span></span><br><span class="line">        <span class="attr">topologyKey:</span> <span class="string">rack</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><hr><h5 id="preferred（软亲和性）-1"><a href="#preferred（软亲和性）-1" class="headerlink" title="preferred（软亲和性）"></a>preferred（软亲和性）</h5><p><strong>满足更优先</strong>，不满足也能调度。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">yaml</span></span><br><span class="line"><span class="string">CopyEdit</span></span><br><span class="line"><span class="attr">affinity:</span></span><br><span class="line">  <span class="attr">podAffinity:</span></span><br><span class="line">    <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">podAffinityTerm:</span></span><br><span class="line">          <span class="attr">labelSelector:</span></span><br><span class="line">            <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">app</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">myapp</span></span><br><span class="line">          <span class="attr">topologyKey:</span> <span class="string">rack</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-podAntiAffinity-反亲和性"><a href="#2-podAntiAffinity-反亲和性" class="headerlink" title="2.podAntiAffinity-反亲和性"></a>2.podAntiAffinity-反亲和性</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#强制让相同标签 la=anti 的 Pod 分布到不同的 rack 里，防止它们集中在一起。</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">anti</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">     <span class="attr">la:</span> <span class="string">anti</span></span><br><span class="line">     <span class="attr">app:</span> <span class="string">myapp</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">con</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">xianchao/tomcat-8.5-jre8:v1</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">&quot;IfNotPresent&quot;</span></span><br><span class="line">  <span class="attr">affinity:</span></span><br><span class="line">    <span class="attr">podAntiAffinity:</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">topologyKey:</span> <span class="string">rack</span></span><br><span class="line">          <span class="attr">labelSelector:</span></span><br><span class="line">            <span class="attr">matchExpressions:</span></span><br><span class="line">              <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">la</span></span><br><span class="line">                <span class="attr">operator:</span> <span class="string">&quot;In&quot;</span></span><br><span class="line">                <span class="attr">values:</span></span><br><span class="line">                  <span class="bullet">-</span> <span class="string">anti</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4-污点与容忍-Taints-Tolerations"><a href="#4-4-污点与容忍-Taints-Tolerations" class="headerlink" title="4.4 污点与容忍 (Taints &amp; Tolerations)"></a>4.4 污点与容忍 (Taints &amp; Tolerations)</h3><ul><li><p><strong>概念</strong>：Taint污点是节点的“拒绝声明”，容忍（toleration）是 Pod 的“通行证”。 污点的effect跟 Pod 容忍的effect，必须完全一样才能生效。</p><ul><li><strong>Taint (污点)</strong>：标记节点不接受没有特定容忍度的 Pod。</li><li><strong>Toleration (容忍)</strong>：允许 Pod 调度到带有特定污点的节点上。</li></ul></li><li><p><strong><code>kubectl taint</code> 命令</strong>：<code>kubectl taint nodes &lt;node-name&gt; &lt;key&gt;=&lt;value&gt;:&lt;effect&gt;</code>。</p></li><li><p><strong>Taint Effects</strong>：<code>NoSchedule</code>, <code>PreferNoSchedule</code>, <code>NoExecute</code>。</p></li></ul><p><strong>taint由三部分组成</strong>：</p><ul><li><strong>key</strong>：污点的名字，比如 <code>key=dedicated</code></li><li><strong>value</strong>：具体的值，比如 <code>value=db</code></li><li><strong>effect</strong>：影响方式，常见有<ul><li><code>NoSchedule</code>：不调度 Pod 上来（除非 Pod 容忍了这个污点）</li><li><code>PreferNoSchedule</code>：最好不，但不是绝对禁止</li><li><code>NoExecute</code>：不仅不调度，还会把不容忍的 Pod 赶走</li></ul></li></ul><p><strong>toleration写法：</strong></p><ul><li><strong>key &#x2F; value</strong>：匹配哪个污点</li><li><strong>operator</strong>：<strong>Equal 表示“值必须等于 value”；Exists 表示“只要有这个 key 就行”</strong></li><li><strong>effect</strong>：</li><li><strong>tolerationSeconds</strong>：容忍多久（只对 NoExecute 有用）</li></ul><h4 id="yaml示例-2"><a href="#yaml示例-2" class="headerlink" title="yaml示例"></a>yaml示例</h4><p><strong>1. 给节点加污点</strong></p><p>比如你要让节点只跑数据库相关的 Pod：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl taint nodes &lt;节点名&gt; dedicated=db:NoSchedule</span><br><span class="line"></span><br><span class="line"><span class="comment">#NoSchedule 是 effect，代表不容忍的 Pod不能调度到这个节点</span></span><br></pre></td></tr></table></figure><hr><p><strong>2. 在 Pod 里加容忍（Toleration）</strong></p><p>如果 Pod 想上这个有污点的节点，就得声明容忍它：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">tolerations:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;dedicated&quot;</span>          <span class="comment"># 污点的 key</span></span><br><span class="line">  <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span>         <span class="comment"># 匹配方式（Equal 或 Exists）</span></span><br><span class="line">  <span class="attr">value:</span> <span class="string">&quot;db&quot;</span>       <span class="comment"># 污点的值</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="string">&quot;NoSchedule&quot;</span>       <span class="comment"># 容忍的污点类型</span></span><br><span class="line">  <span class="attr">tolerationSeconds:</span> <span class="number">3600</span>   <span class="comment"># 容忍多久（秒）</span></span><br></pre></td></tr></table></figure><p>这样 Pod 就拿到了“通行证”，能调度到有 <code>dedicated=db:NoSchedule</code> 污点的节点上。</p><hr><h3 id="4-5-资源请求与限制-Resource-Requests-Limits"><a href="#4-5-资源请求与限制-Resource-Requests-Limits" class="headerlink" title="4.5 资源请求与限制 (Resource Requests &amp; Limits)"></a>4.5 资源请求与限制 (Resource Requests &amp; Limits)</h3><ul><li><p><strong>概念</strong>：</p><ul><li><p><strong>Requests (请求)</strong>：Pod 调度时保证的最小资源。</p></li><li><p><strong>Limits (限制)</strong>：Pod 可使用的最大资源。</p></li></ul></li><li><p><strong>资源类型</strong>：<code>cpu</code> (m 或 core), <code>memory</code> (Mi, Gi)。</p></li><li><p><strong>QoS Class (服务质量)</strong>：Guaranteed, Burstable, BestEffort。</p></li><li><p><strong>YAML 示例</strong>：</p></li></ul><h2 id="五、网络"><a href="#五、网络" class="headerlink" title="五、网络"></a>五、网络</h2><h3 id="5-1-Service-服务"><a href="#5-1-Service-服务" class="headerlink" title="5.1 Service (服务)"></a>5.1 Service (服务)</h3><ul><li><strong>概念</strong>：为一组 Pod 提供稳定的网络访问方式和负载均衡。</li><li>在 Kubernetes 集群中，Pod 是可以随时创建、销毁和重新调度的。这意味着它们的 IP 地址是动态变化的。如果一个前端应用需要与后端 Pod 通信，直接使用 Pod 的 IP 地址是不可靠的。</li></ul><p><strong>Service 解决了这些问题。它充当了 Pod 的一个抽象层和稳定代理。</strong></p><aside> 💡<p>Pod 请求 → Service(ClusterIP) → kube-proxy 查 Endpoints → 挑选 Pod IP:Port → 转发流量</p></aside><p><em>Service 解决的核心问题：</em></p><ol><li>Pod IP 动态变化</li><li>Pod 数量弹性伸缩</li><li>服务发现和负载均衡</li></ol><ul><li><p><strong>Service 类型</strong>：</p><ul><li><code>ClusterIP</code> (默认)：集群内部访问。</li><li><code>NodePort</code>：通过节点 IP 和端口从外部访问。</li><li><code>LoadBalancer</code>：云服务商提供外部负载均衡。</li><li><code>ExternalName</code>：外部服务别名。</li></ul></li><li><p><strong>Endpoints</strong>：Service 关联的 Pod IP 和端口列表。</p></li><li><p><strong>Headless Service</strong>：不分配 <code>ClusterIP</code>，用于 StatefulSet。</p></li></ul><h6 id="Service-的-FQDN"><a href="#Service-的-FQDN" class="headerlink" title="Service 的 FQDN"></a>Service 的 <strong>FQDN</strong></h6><p>Kubernetes 集群里，Service 的 <strong>FQDN（完全限定域名-Fully Qualified Domain Name）</strong> 有一个固定规则</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&lt;service-name&gt;.&lt;namespace&gt;.svc.cluster.local</span></span><br><span class="line"></span><br><span class="line"><span class="string">svc</span> <span class="string">表示这是一个</span> <span class="string">Service</span> <span class="string">对象</span></span><br><span class="line"></span><br><span class="line"><span class="string">cluster.local</span> <span class="string">是集群的默认域</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5-2-Ingress-入口"><a href="#5-2-Ingress-入口" class="headerlink" title="5.2 Ingress (入口)"></a>5.2 Ingress (入口)</h3><ul><li><p><strong>概念</strong>：从集群外部访问集群内 Service 的 HTTP&#x2F;HTTPS 路由规则。</p></li><li><p><strong>组件</strong>：Ingress Resource (定义规则), Ingress Controller (实现规则, 如 Nginx Ingress Controller)。</p></li><li><p><strong>YAML 示例</strong>：<code>rules</code>, <code>host</code>, <code>paths</code>, <code>backend</code>。</p></li></ul><aside> ♦️<p>四层代理service</p><p>Service 存在的核心问题：仅支持四层代理，基于IP和端口代理，无法直接处理七层协议（如 HTTP&#x2F;HTTPS）的流量。</p><p>Service的type类型有很多，如NodePort、clusterIp、loadbalancer、externalname，如果Service想要被k8s集群外部访问，需要用NodePort类型。nodeport会在物理机映射一个端口，绑定到物理机上，这样就导致，每个服务都要映射一个端口，端口过多，维护困难</p></aside><h4 id="1-1-什么是Ingress"><a href="#1-1-什么是Ingress" class="headerlink" title="1.1 什么是Ingress"></a>1.1 什么是Ingress</h4><p>Ingress是Kubernetes中管理外部访问集群内服务的API对象，通常管理HTTP和HTTPS流量。它提供负载均衡、SSL终止和基于名称的虚拟主机等功能。</p><h4 id="1-2-为什么需要Ingress"><a href="#1-2-为什么需要Ingress" class="headerlink" title="1.2 为什么需要Ingress"></a>1.2 为什么需要Ingress</h4><ul><li><strong>Service的局限性</strong>：NodePort和LoadBalancer类型的Service在大规模场景下不够灵活</li><li><strong>统一入口</strong>：提供集群的统一访问入口点</li><li><strong>高级路由</strong>：支持基于域名、路径的路由规则</li><li><strong>SSL&#x2F;TLS终止</strong>：集中处理HTTPS证书</li><li><strong>成本优化</strong>：避免为每个服务创建LoadBalancer<br>![ingress]((&#x2F;images&#x2F;Untitled diagram _ Mermaid Chart-2025-09-11-012859.png)</li></ul><h3 id="5-3-CNI-插件-CNI-Plugins"><a href="#5-3-CNI-插件-CNI-Plugins" class="headerlink" title="5.3 CNI 插件 (CNI Plugins)"></a>5.3 CNI 插件 (CNI Plugins)</h3><ul><li><p><strong>概念</strong>：Container Network Interface，提供 Pod 网络实现。</p></li><li><p><strong>常见插件</strong>：Calico, Flannel, Weave Net (了解其作用，无需深入配置)。</p></li></ul><h3 id="5-4-网络策略-Network-Policies"><a href="#5-4-网络策略-Network-Policies" class="headerlink" title="5.4 网络策略 (Network Policies)"></a>5.4 网络策略 (Network Policies)</h3><ul><li><p><strong>概念</strong>：基于 Pod 标签、Namespace 等定义 Pod 间的网络访问规则。</p></li><li><p><strong>作用</strong>：实现微隔离，增强安全性。</p></li><li><p><strong>YAML 示例</strong>：<code>podSelector</code>, <code>ingress</code>, <code>egress</code>。</p></li></ul><h2 id="六、存储-Storage"><a href="#六、存储-Storage" class="headerlink" title="六、存储 (Storage)"></a>六、存储 (Storage)</h2><h3 id="6-1-Volume"><a href="#6-1-Volume" class="headerlink" title="6.1 Volume"></a><strong>6.1 Volume</strong></h3><ul><li><strong>概念</strong>：Pod 中容器间共享数据的存储。</li><li><strong>类型</strong>：<code>emptyDir</code>, <code>hostPath</code>, <code>ConfigMap</code>, <code>Secret</code>, <code>PersistentVolumeClaim</code>。</li></ul><h4 id="emptyDir"><a href="#emptyDir" class="headerlink" title="emptyDir"></a>emptyDir</h4><p><strong><code>emptyDir</code></strong> 是一种临时的、空目录卷，它是在 Pod 被调度到节点上时创建的。</p><p>这个卷的生命周期与 Pod 相同，只要 Pod 还在运行，它就存在。一旦 Pod 被删除或终止，<strong><code>emptyDir</code></strong> 中的所有数据都会被永久清除。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod_emptydir</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">contain_1</span></span><br><span class="line">      <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">      <span class="attr">volumeMounts:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume_1</span> <span class="comment"># volumeMounts 的 name 应该与 volumes 的 name 对应</span></span><br><span class="line">          <span class="attr">mountPath:</span> <span class="string">/cache</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume_1</span></span><br><span class="line">      <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看所在node和uuid</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">volume</span>]<span class="comment"># kubectl get pod pod-emptydir -o wide</span></span><br><span class="line"><span class="string">NAME</span>           <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>     <span class="string">IP</span>              <span class="string">NODE</span>    <span class="string">NOMINATED</span> <span class="string">NODE</span>   <span class="string">READINESS</span> <span class="string">GATES</span></span><br><span class="line"><span class="string">pod-emptydir</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">9m59s</span>   <span class="number">10.244</span><span class="number">.104</span><span class="number">.28</span>   <span class="string">node2</span>   <span class="string">&lt;none&gt;</span>           <span class="string">&lt;none&gt;</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">volume</span>]<span class="comment"># kubectl get pods pod-emptydir -o yaml | grep uid</span></span><br><span class="line">  <span class="attr">uid:</span> <span class="string">d298e2ad-f201-4d5f-a8d4-6cd5b0b440ba</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">#在对应node节点上查看</span></span><br><span class="line">[<span class="string">root@node2</span> <span class="string">~</span>]<span class="comment"># cd /var/lib/kubelet/pods</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="hostPath"><a href="#hostPath" class="headerlink" title="hostPath"></a>hostPath</h4><p>将 Pod 所在节点（Host）上的一个文件或目录，直接挂载到 Pod 内部。</p><p><code>hostPath</code> 中的数据<strong>是持久的</strong>，即使 Pod 被删除，数据也会保留在节点上。这种卷主要用于需要访问节点底层文件系统的场景，比如系统监控或日志收集。然而，<code>hostPath</code> 存在安全风险，并且会破坏 Pod 的可移植性，因此在大多数情况下，并不推荐使用。</p><ul><li><code>hostPath</code> 类型及其含义：<ul><li><strong><code>DirectoryOrCreate</code></strong>: 如果指定路径不存在，Kubernetes 会创建一个<strong>空目录</strong>。如果路径已存在，它必须是一个目录。</li><li><strong><code>Directory</code></strong>: 挂载前，节点上的指定路径<strong>必须已经存在且是一个目录</strong>。如果不是，Pod 将无法启动。</li><li><strong><code>FileOrCreate</code></strong>: 如果指定路径不存在，Kubernetes 会创建一个<strong>空文件</strong>。如果路径已存在，它必须是一个文件。</li><li><strong><code>File</code></strong>: 挂载前，节点上的指定路径<strong>必须已经存在且是一个文件</strong>。如果不是，Pod 将无法启动。</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">test-hostpath</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">node1</span>  <span class="comment"># &lt;-- 指定node</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-volume</span>  <span class="comment"># &lt;-- 这里需要指定卷的名称</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/test-nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-tomcat</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">tomcat:8.5-jre8-alpine</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-volume</span>  <span class="comment"># &lt;-- 这里也需要指定卷的名称</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/test-tomcat</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># volumes 字段应该在这里，与 containers 平级</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-volume</span></span><br><span class="line">    <span class="attr">hostPath:</span> </span><br><span class="line">     <span class="attr">path:</span> <span class="string">/data1</span></span><br><span class="line">     <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建之后，可以进入pod查看，</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">volume</span>]<span class="comment"># kubectl exec -it test-hostpath -- /bin/bash</span></span><br><span class="line"><span class="string">Defaulted</span> <span class="string">container</span> <span class="string">&quot;test-nginx&quot;</span> <span class="attr">out of:</span> <span class="string">test-nginx,</span> <span class="string">test-tomcat</span></span><br><span class="line"><span class="comment">#不指定容器，默认nginx</span></span><br><span class="line"></span><br><span class="line"><span class="string">root@test-hostpath:/#</span> <span class="string">kubectl</span> <span class="string">exec</span> <span class="string">-it</span> <span class="string">test-hostpath</span> <span class="string">-c</span> <span class="string">test-tomcat</span> <span class="string">--</span> <span class="string">/bin/bash</span></span><br></pre></td></tr></table></figure><h4 id="NFS"><a href="#NFS" class="headerlink" title="NFS"></a>NFS</h4><p>允许 Pod 挂载一个来自远程 NFS 服务器的共享目录。</p><p>简单来说，它将 NFS 网络共享作为 Kubernetes 的持久化存储来使用，从而解决了 <code>emptyDir</code> 和 <code>hostPath</code> 所不具备的几个关键问题。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-nfs</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:v1</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">IfNotPresent</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volumes</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/usr/share/nginx/html</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nfs-volumes</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.40</span><span class="number">.180</span>   <span class="comment">#nfs服务端IP</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/data/volumes</span></span><br></pre></td></tr></table></figure><h3 id="6-2-PV与PVC"><a href="#6-2-PV与PVC" class="headerlink" title="6.2 PV与PVC"></a><strong>6.2 PV与PVC</strong></h3><p><strong>PersistentVolume</strong><br><strong>PersistentVolumeClaim</strong></p><p>用户通过 <strong>PVC</strong> 来申请 PV，就像“我要一块 10Gi 的盘”。</p><p>调度器会把 PVC 和合适的 PV 绑定起来，Pod 再去挂载 PVC，就能拿到这块盘。</p><ul><li><p><strong>供应方式</strong></p><p>  <strong>1. 静态供应（Static Provisioning）</strong></p><p>  管理员提前创建好 PV，指定存储类型和大小（比如 NFS 共享目录、云盘、Ceph 卷）。</p><p>  用户写 PVC 时，如果大小和访问模式匹配，就能直接绑定。</p><p>  缺点是比较死板，用多少准备多少，容易浪费。</p><p>  <strong>2. 动态供应（Dynamic Provisioning）</strong></p><p>  用户只写 PVC，不用管 PV 存在不存在。</p><p>  Kubernetes 会根据 PVC 的需求，调用对应的 <strong>StorageClass</strong>，自动生成一个 PV。</p><p>  这样灵活得多，尤其是在云环境下（比如 AWS EBS、GCP Persistent Disk、阿里云盘），想要多大就给你创建多大。</p></li><li><p><strong>访问模式</strong><br>访问模式（<code>accessModes</code>）同时存在于 PV 和 PVC 中，但它们代表的含义不同：<strong>PV 的 <code>accessModes</code> 声明了存储的“能力”。PVC 的 <code>accessModes</code> 表达了用户的“需求”。</strong></p><p>  <strong><code>accessModes</code> <code>&lt;[]string&gt;</code></strong></p><ul><li><strong>RWO<code>ReadWriteOnce</code></strong> ：只能被<strong>一个节点</strong>以读写方式挂载。</li><li><strong>ROX<code>ReadOnlyMany</code></strong>：可以被<strong>多个节点</strong>以只读方式挂载。</li><li><strong>RWX<code>ReadWriteMany</code></strong> ：可以被<strong>多个节点</strong>以读写方式挂载。这是 NFS 等共享存储最常使用的模式。</li></ul></li><li><p><strong>回收策略</strong><br>  **reclaimPolicy：**决定了 <strong>PVC 被删除后，PV 怎么处理</strong>：</p><ul><li><strong>Retain</strong>（默认）：PVC 删除后，PV 状态会变成 <code>Released</code>，但数据还在，需要你手动清理并重新设置才能再用。</li><li><strong>Delete</strong>：PVC 删除时，底层存储（比如 AWS EBS、GCE PD、动态 NFS 子目录）也会一起删掉。</li></ul></li><li><p>pv</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv1</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/data/volumes/v1</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">172.20</span><span class="number">.196</span><span class="number">.17</span></span><br></pre></td></tr></table></figure></li><li><p>pvc</p>  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">500Ki</span></span><br></pre></td></tr></table></figure></li></ul><p>删除pvc的步骤：需要先删除使用pvc的pod，再删除pvc</p><h3 id="6-3-StorageClass"><a href="#6-3-StorageClass" class="headerlink" title="6.3 StorageClass"></a><strong>6.3 StorageClass</strong></h3><ul><li><strong>概念</strong>：动态地供应 pv。在没有 StorageClass 之前，管理员需要手动创建每一个 PV，来满足开发者的 PVC 请求。如果集群中有成百上千个存储需求，这会变得非常低效。有了 StorageClass，这个过程就完全自动化了。开发者只需要在 <strong>PVC</strong> 中指定他们想要的 StorageClass 名称，Kubernetes 就会自动调用相应的<strong>供应器（Provisioner）</strong>，为该 PVC 创建一个匹配的 PV。</li><li><strong>关键字段</strong><ul><li><code>provisioner</code>供应商</li><li><code>parameters</code>参数</li><li><code>reclaimPolicy</code>回收策略</li></ul></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">storage.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">StorageClass</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nfs-sc</span></span><br><span class="line"><span class="attr">provisioner:</span> <span class="string">cluster.local/nfs-client-provisioner</span>   <span class="comment"># 和部署的 nfs-provisioner 的 provisioner 字段一致</span></span><br><span class="line"><span class="attr">reclaimPolicy:</span> <span class="string">Delete</span>        <span class="comment"># 回收策略，默认是 Delete（也可以是 Retain）</span></span><br><span class="line"><span class="attr">volumeBindingMode:</span> <span class="string">Immediate</span> <span class="comment"># 立即绑定（另一种是 WaitForFirstConsumer）</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="七、安全-Security"><a href="#七、安全-Security" class="headerlink" title="七、安全 (Security)"></a>七、安全 (Security)</h2><p>🌐 API 请求 → 🔍 认证 → ✅ 授权 → 🛡️ 准入控制 → ⚡ 执行<br>     ↓          ↓          ↓             ↓          ↓<br>   谁在请求    你是谁    你能做什么   做的合规吗     实际执行</p><p>Kubernetes 的安全管理通过<strong>认证 → 授权 → 准入控制</strong>三道防线，构建了完整的安全防护体系：</p><ol><li><strong>认证</strong>确保请求者身份可信</li><li><strong>授权</strong>确保请求者有相应权限</li><li><strong>准入控制</strong>确保请求内容符合策略</li></ol><h3 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h3><p>kubernetes主要通过<a href="https://so.csdn.net/so/search?q=API&spm=1001.2101.3001.7020">API</a>server对外提供服务，那么就需要对访问apiserver的用户做认证</p><h4 id="1-用户类型"><a href="#1-用户类型" class="headerlink" title="1.用户类型"></a>1.用户类型</h4><ol><li><p><strong>User（用户）</strong> - 真实用户账户</p> <aside> 💡 <p> <em>Kubernetes 没有 User 对象，用户信息来自：</em></p><ul><li>客户端证书的 Subject</li><li>Bearer Token</li><li>认证代理的头信息</li><li>外部身份提供商</li></ul> </aside> </li><li><p><strong>Group（用户组）</strong> - 用户组</p></li><li><p><strong>ServiceAccount（服务账户）</strong> - Pod 使用的账户</p></li></ol><h4 id="2-k8s客户端访问apiserver的几种认证方式"><a href="#2-k8s客户端访问apiserver的几种认证方式" class="headerlink" title="2.k8s客户端访问apiserver的几种认证方式"></a>2.k8s客户端访问apiserver的几种认证方式</h4><ol><li>客户端证书（Client Certificates）</li></ol><p><strong>原理</strong>：管理员通过集群的 CA (Certificate Authority) 签发一个客户端证书。这个证书包含了用户的身份信息。</p><ol start="2"><li>Service Account</li></ol><p>这是 Kubernetes <strong>内部 Pods</strong> 认证自己的<strong>唯一方式</strong>。</p><p><strong>使用场景</strong>：集群内部的<strong>应用程序</strong>或<strong>控制器</strong>（如你的日志收集器、CI&#x2F;CD 工具）访问 API Server 时使用。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 步骤 1: 定义一个 ServiceAccount</span></span><br><span class="line"><span class="comment"># 这是一个为应用程序提供身份的账户，它没有密码，只依赖于自动生成的令牌。</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-sa</span> <span class="comment"># ServiceAccount 的名称，将在 Pod 中引用</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将serviceaccount绑定到pod</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-app</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">serviceAccountName:</span> <span class="string">my-sa</span>   </span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">app</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure><h3 id="授权Authorization-RBAC"><a href="#授权Authorization-RBAC" class="headerlink" title="授权Authorization-RBAC"></a><strong>授权Authorization-RBAC</strong></h3><p><strong>什么是RBAC（基于角色的授权）？</strong></p><p>让一个用户（Users）扮演一个角色（Role），角色拥有权限，从而让用户拥有这样的权限。</p><h4 id="RBAC-权限流向"><a href="#RBAC-权限流向" class="headerlink" title="RBAC 权限流向"></a>RBAC 权限流向</h4><p>主体(用户&#x2F;组&#x2F;SA) → 绑定 → 角色 → 资源</p><h4 id="角色和绑定关系"><a href="#角色和绑定关系" class="headerlink" title="角色和绑定关系"></a>角色和绑定关系</h4><p>Role + RoleBinding：权限被限制在一个命名空间内。 ClusterRole + RoleBinding：引用全局的 ClusterRole，但权限仍被限制在 RoleBinding 所在的一个命名空间内。 ClusterRole + ClusterRoleBinding：权限在整个集群内有效。</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">config:</span><br><span class="line">  theme: redux</span><br><span class="line">  look: classic</span><br><span class="line">---</span><br><span class="line">flowchart TD</span><br><span class="line"> subgraph subjects[&quot;主体（Subjects）&quot;]</span><br><span class="line">        user[&quot;User&lt;br&gt;用户&lt;br&gt;&quot;]</span><br><span class="line">        group[&quot;Group&lt;br&gt;用户组&lt;br&gt;&quot;]</span><br><span class="line">        serviceaccount[&quot;ServiceAccount&lt;br&gt;服务账户&lt;br&gt;&quot;]</span><br><span class="line">  end</span><br><span class="line"> subgraph binding[&quot;绑定（Binding）&quot;]</span><br><span class="line">        rolebinding[&quot;RoleBinding&lt;br&gt;命名空间级别&lt;br&gt;&quot;]</span><br><span class="line">        clusterrolebinding[&quot;ClusterRoleBinding&lt;br&gt;集群级别&lt;br&gt;&quot;]</span><br><span class="line">  end</span><br><span class="line"> subgraph roles[&quot;角色（Roles）&quot;]</span><br><span class="line">        role[&quot;Role&lt;br&gt;命名空间级别&lt;br&gt;&quot;]</span><br><span class="line">        clusterrole[&quot;ClusterRole&lt;br&gt;集群级别&lt;br&gt;&quot;]</span><br><span class="line">  end</span><br><span class="line"> subgraph k8sresources[&quot;Kubernetes 资源&quot;]</span><br><span class="line">        pods[&quot;Pods&quot;]</span><br><span class="line">        services[&quot;Services&quot;]</span><br><span class="line">        configmaps[&quot;ConfigMaps&quot;]</span><br><span class="line">        secrets[&quot;Secrets&quot;]</span><br><span class="line">  end</span><br><span class="line">    subjects --&gt; binding</span><br><span class="line">    binding --&gt; roles</span><br><span class="line">    roles --&gt; k8sresources</span><br><span class="line">     user:::users</span><br><span class="line">     user:::pod</span><br><span class="line">     group:::groups</span><br><span class="line">     group:::pod</span><br><span class="line">     serviceaccount:::cr</span><br><span class="line">     serviceaccount:::pod</span><br><span class="line">     rolebinding:::rb</span><br><span class="line">     rolebinding:::Rose</span><br><span class="line">     clusterrolebinding:::crb</span><br><span class="line">     clusterrolebinding:::Rose</span><br><span class="line">     role:::r</span><br><span class="line">     role:::groups</span><br><span class="line">     clusterrole:::cr</span><br><span class="line">     clusterrole:::roles</span><br><span class="line">     clusterrole:::groups</span><br><span class="line">     pods:::pod</span><br><span class="line">     pods:::resources</span><br><span class="line">     services:::pod</span><br><span class="line">     services:::resources</span><br><span class="line">     configmaps:::pod</span><br><span class="line">     configmaps:::resources</span><br><span class="line">     secrets:::pod</span><br><span class="line">     secrets:::resources</span><br><span class="line">    classDef sa fill:#BA68C8,stroke:#8E24AA,color:#fff</span><br><span class="line">    classDef binding fill:#4DB6AC,stroke:#00796B,color:#fff</span><br><span class="line">    classDef rb fill:#FFD54F,stroke:#FBC02D,color:#fff</span><br><span class="line">    classDef r fill:#4DD0E1,stroke:#0097A7,color:#fff</span><br><span class="line">    classDef text fill:white,color:white</span><br><span class="line">    classDef users fill:#4FC3F7, stroke:#0288D1, color:#fff</span><br><span class="line">    classDef cr fill:#81D4FA, stroke:#0288D1, color:#fff</span><br><span class="line">    classDef Rose stroke-width:1px, stroke-dasharray:none, stroke:#FF5978, fill:#FFDFE5, color:#8E2236</span><br><span class="line">    classDef roles fill:#AED581, stroke:#689F38, color:#fff</span><br><span class="line">    classDef groups fill:#81C784, stroke:#388E3C, color:#fff</span><br><span class="line">    classDef resources fill:#FFB74D, stroke:#F57C00, color:#fff</span><br><span class="line">    classDef crb fill:#64B5F6, stroke:#1976D2, color:#fff</span><br><span class="line">    classDef pod fill:#90CAF9, stroke:#1565C0, color:#fff</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 步骤 1: 创建 Role</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这个 Role 定义了一组权限，允许对 pods 和 deployments 资源进行 &quot;get&quot;, &quot;watch&quot;, &quot;list&quot; 操作。</span></span><br><span class="line"><span class="comment"># 这个 Role 只在 default 命名空间中生效。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-and-deployment-reader</span></span><br><span class="line"><span class="attr">rules:</span>    </span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]        <span class="comment"># &quot;&quot; 表示核心 API 组</span></span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]    </span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"> <span class="comment">#角色可以读取核心 API 组中的所有 Pod 资源。</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;apps&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;deployments&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line"> <span class="comment">#角色可以读取 apps API 组中的所有 Deployment 资源。</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="comment"># 步骤 2: 创建 RoleBinding</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># 这个 RoleBinding 将上面创建的 &quot;pod-and-deployment-reader&quot; 角色，</span></span><br><span class="line"><span class="comment"># 授予给 &quot;dev-sa&quot; 服务账户。</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">read-pods-deployments-in-default</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">subjects:</span> <span class="comment">#和什么主体绑定</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-sa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span>  <span class="comment">#绑定哪个role</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-and-deployment-reader</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#以alice获取pod信息，被禁止</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">sa</span>]<span class="comment"># kubectl get pod --as=alice</span></span><br><span class="line"><span class="attr">Error from server (Forbidden): pods is forbidden:</span> <span class="string">User</span> <span class="string">&quot;alice&quot;</span> <span class="string">cannot</span> <span class="string">list</span> <span class="string">resource</span> <span class="string">&quot;pods&quot;</span> <span class="string">in</span> <span class="string">API</span> <span class="string">group</span> <span class="string">&quot;&quot;</span> <span class="string">in</span> <span class="string">the</span> <span class="string">namespace</span> <span class="string">&quot;default&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#步骤 1: 创建 Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role1</span>   <span class="comment">#命名role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">    <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">    <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>,<span class="string">&quot;list&quot;</span>]</span><br><span class="line"><span class="comment">#角色可以获取和列出核心 API 组中的所有 Pod 资源。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#步骤 2：创建rolebinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">rolebind1</span>  <span class="comment">#命名rolebindinf</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">roleRef:</span>   <span class="comment">#绑定哪个role</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span>   </span><br><span class="line">  <span class="comment">#定义了角色所属的 API 组。对于 RBAC 资源，这个值是固定的</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">role1</span></span><br><span class="line"><span class="attr">subjects:</span>  <span class="comment">##和什么主体绑定</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">alice</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#此时再次尝试，成功get到pod信息</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">sa</span>]<span class="comment"># kubectl get pod --as=alice</span></span><br><span class="line"><span class="string">NAME</span>                               <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>        <span class="string">AGE</span></span><br><span class="line"><span class="string">nfs-provisioner-7dbd9f7b8b-gmnzt</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">14</span> <span class="string">(139m</span> <span class="string">ago)</span>   <span class="string">5d1h</span></span><br><span class="line"><span class="string">web-0</span>                              <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>               <span class="string">4d22h</span></span><br><span class="line"><span class="string">web-1</span>                              <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>               <span class="string">4d22h</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出集群中所有资源类型</span></span><br><span class="line">kubectl api-resources</span><br><span class="line"></span><br><span class="line"><span class="comment">#验证权限</span></span><br><span class="line">kubectl auth can-i </span><br><span class="line">kubectl auth can-i --list</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="准入控制-Admission-Control"><a href="#准入控制-Admission-Control" class="headerlink" title="准入控制-Admission Control"></a>准入控制-Admission Control</h3><p>在API请求到达etcd存储之前的<strong>最后一道关卡</strong>，可以修改或拒绝请求。常见的有：</p><h4 id="ResourceQuota"><a href="#ResourceQuota" class="headerlink" title="ResourceQuota"></a>ResourceQuota</h4><p>在<strong>命名空间级别</strong>限制资源总量使用：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ResourceQuota</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">compute-quota</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">myteam</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">hard:</span></span><br><span class="line">    <span class="attr">requests.cpu:</span> <span class="string">&quot;4&quot;</span></span><br><span class="line">    <span class="attr">requests.memory:</span> <span class="string">8Gi</span></span><br><span class="line">    <span class="attr">limits.cpu:</span> <span class="string">&quot;8&quot;</span></span><br><span class="line">    <span class="attr">limits.memory:</span> <span class="string">16Gi</span></span><br><span class="line">    <span class="attr">pods:</span> <span class="string">&quot;10&quot;</span></span><br></pre></td></tr></table></figure><h4 id="LimitRanger"><a href="#LimitRanger" class="headerlink" title="LimitRanger"></a>LimitRanger</h4><p>在<strong>单个对象级别</strong>设置资源使用的范围限制：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">LimitRange</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">cpu-memory-limit-range</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">limits:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">default:</span>          <span class="string">*#</span> <span class="string">默认limit*</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">200m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">256Mi</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">defaultRequest:</span>    <span class="string">*#</span> <span class="string">默认request*</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">100m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">128Mi</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">max:</span>              <span class="string">*#</span> <span class="string">最大值*</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">500m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">min:</span>              <span class="string">*#</span> <span class="string">最小值*</span></span><br><span class="line">      <span class="attr">cpu:</span> <span class="string">50m</span></span><br><span class="line">      <span class="attr">memory:</span> <span class="string">64Mi</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Container</span></span><br></pre></td></tr></table></figure><h2 id="八、集群维护-Cluster-Maintenance"><a href="#八、集群维护-Cluster-Maintenance" class="headerlink" title="八、集群维护 (Cluster Maintenance)"></a>八、集群维护 (Cluster Maintenance)</h2><h3 id="8-1-集群升级-Cluster-Upgrades"><a href="#8-1-集群升级-Cluster-Upgrades" class="headerlink" title="8.1 集群升级 (Cluster Upgrades)"></a>8.1 集群升级 (Cluster Upgrades)</h3><ul><li><p><strong><code>kubeadm</code> 升级</strong>：</p><ul><li><p>Master 节点升级 (<code>kubeadm upgrade apply</code>)。</p></li><li><p>Worker 节点升级 (<code>kubeadm upgrade node</code>)。</p></li><li><p><code>kubectl drain</code>, <code>kubectl uncordon</code>。</p></li></ul></li></ul><h3 id="8-2-节点维护-Node-Maintenance"><a href="#8-2-节点维护-Node-Maintenance" class="headerlink" title="8.2 节点维护 (Node Maintenance)"></a>8.2 节点维护 (Node Maintenance)</h3><ul><li><p><strong>排空节点</strong>：<code>kubectl drain &lt;node-name&gt;</code> (将 Pod 驱逐出节点)。</p></li><li><p><strong>解除排空</strong>：<code>kubectl uncordon &lt;node-name&gt;</code> (允许 Pod 重新调度到节点)。</p></li><li><p><strong>移除节点</strong>：<code>kubeadm reset</code> (在节点上执行), <code>kubectl delete node &lt;node-name&gt;</code>。</p></li></ul><h3 id="8-3-ETCD-操作-ETCD-Operations"><a href="#8-3-ETCD-操作-ETCD-Operations" class="headerlink" title="8.3 ETCD 操作 (ETCD Operations)"></a>8.3 ETCD 操作 (ETCD Operations)</h3><ul><li><p><strong>集群健康检查</strong>：<code>etcdctl endpoint health</code>。</p></li><li><p><strong>成员管理</strong>：<code>etcdctl member list</code>, <code>etcdctl member add/remove</code>。</p></li></ul><h2 id="九、日志与监控-Logging-Monitoring"><a href="#九、日志与监控-Logging-Monitoring" class="headerlink" title="九、日志与监控 (Logging &#x2F; Monitoring)"></a>九、日志与监控 (Logging &#x2F; Monitoring)</h2><h3 id="9-1-日志收集-Log-Collection"><a href="#9-1-日志收集-Log-Collection" class="headerlink" title="9.1 日志收集 (Log Collection)"></a>9.1 日志收集 (Log Collection)</h3><ul><li><p><strong>Pod 日志</strong>：<code>kubectl logs</code>, <code>kubectl logs -f</code>。</p></li><li><p><strong>节点日志</strong>：<code>journalctl -u kubelet</code>, <code>journalctl -u docker</code> 或 <code>containerd</code>。</p></li><li><p><strong>日志收集方案</strong>：Fluentd, Loki (概念性了解)。</p></li></ul><h3 id="9-2-监控工具-Monitoring-Tools-Concepts"><a href="#9-2-监控工具-Monitoring-Tools-Concepts" class="headerlink" title="9.2 监控工具 (Monitoring Tools - Concepts)"></a>9.2 监控工具 (Monitoring Tools - Concepts)</h3><ul><li><p><strong>Prometheus &#x2F; Grafana</strong>：K8s 监控的事实标准 (了解架构和作用)。</p></li><li><p><strong>Metrics Server</strong>：提供基本的 CPU&#x2F;内存指标 (<code>kubectl top</code>)。</p></li></ul><h3 id="9-3-健康检查-Probes"><a href="#9-3-健康检查-Probes" class="headerlink" title="9.3 健康检查 (Probes)"></a>9.3 健康检查 (Probes)</h3><ul><li><p><strong>概念</strong>：检查容器是否健康、是否准备好接收流量。</p></li><li><p><strong><code>livenessProbe</code> (存活探针)</strong>：判断容器是否存活，失败则重启容器。</p></li><li><p><strong><code>readinessProbe</code> (就绪探针)</strong>：判断容器是否准备好接收流量，失败则从 Service 终点中移除。</p></li><li><p><strong><code>startupProbe</code> (启动探针)</strong>：判断容器是否启动成功，避免 <code>livenessProbe</code> 过早失败。</p></li><li><p><strong>探针类型</strong>：<code>exec</code>, <code>httpGet</code>, <code>tcpSocket</code>。</p></li><li><p><strong>YAML 示例</strong>：</p></li></ul><h2 id="十、故障排除-Troubleshooting"><a href="#十、故障排除-Troubleshooting" class="headerlink" title="十、故障排除 (Troubleshooting)"></a>十、故障排除 (Troubleshooting)</h2><h3 id="10-1-Pod-故障-Pod-Failures"><a href="#10-1-Pod-故障-Pod-Failures" class="headerlink" title="10.1 Pod 故障 (Pod Failures)"></a>10.1 Pod 故障 (Pod Failures)</h3><ul><li><p><strong>常见状态</strong>：Pending, CrashLoopBackOff, Error, OOMKilled。</p></li><li><p><strong>调试命令</strong>：</p><ul><li><p><code>kubectl describe pod &lt;name&gt;</code> (查看事件、状态、挂载、容器信息)</p></li><li><p><code>kubectl logs &lt;name&gt; [-c &lt;container&gt;]</code> (查看应用日志)</p></li><li><p><code>kubectl exec -it &lt;name&gt; -- bash</code> (进入容器调试)</p></li></ul></li><li><p><strong>可能原因</strong>：镜像拉取失败、端口冲突、资源不足、配置错误、健康检查失败。</p></li></ul><h3 id="10-2-节点故障-Node-Failures"><a href="#10-2-节点故障-Node-Failures" class="headerlink" title="10.2 节点故障 (Node Failures)"></a>10.2 节点故障 (Node Failures)</h3><ul><li><p><strong>常见状态</strong>：NotReady, SchedulingDisabled。</p></li><li><p><strong>调试命令</strong>：</p><ul><li><p><code>kubectl get nodes</code></p></li><li><p><code>kubectl describe node &lt;name&gt;</code> (查看节点事件、资源使用、污点)</p></li><li><p>SSH 到节点检查 <code>kubelet</code>, <code>containerd/docker</code> 服务状态 (<code>systemctl status kubelet</code>)。</p></li><li><p>检查节点资源使用。</p></li></ul></li><li><p><strong>可能原因</strong>：<code>kubelet</code> 停止、网络问题、磁盘空间不足、内存耗尽。</p></li></ul><h3 id="10-3-网络故障-Networking-Issues"><a href="#10-3-网络故障-Networking-Issues" class="headerlink" title="10.3 网络故障 (Networking Issues)"></a>10.3 网络故障 (Networking Issues)</h3><ul><li><p><strong>Pod 间通信</strong>：检查 CNI 插件状态、<code>kube-proxy</code> 日志。</p></li><li><p><strong>Service 访问</strong>：检查 <code>Service Selector</code> 是否匹配 Pod 标签，<code>Endpoints</code> 是否正确。</p></li><li><p><strong>外部访问</strong>：检查 <code>NodePort</code>, <code>LoadBalancer</code>, <code>Ingress</code> 配置。</p></li><li><p><strong>DNS 解析</strong>：检查 <code>coredns</code> Pod 状态、容器内 <code>nslookup</code>。</p></li></ul><h3 id="10-4-存储故障-Storage-Issues"><a href="#10-4-存储故障-Storage-Issues" class="headerlink" title="10.4 存储故障 (Storage Issues)"></a>10.4 存储故障 (Storage Issues)</h3><ul><li><p><strong>PVC 状态</strong>：Pending, Bound。</p></li><li><p><strong>PV 状态</strong>：Available, Bound, Released, Failed。</p></li><li><p><strong>调试命令</strong>：<code>kubectl describe pvc/pv</code>。</p></li><li><p><strong>可能原因</strong>：<code>StorageClass</code> 配置错误、存储后端问题、<code>accessModes</code> 不匹配。</p></li></ul><h3 id="10-5-控制平面故障-Control-Plane-Failures"><a href="#10-5-控制平面故障-Control-Plane-Failures" class="headerlink" title="10.5 控制平面故障 (Control Plane Failures)"></a>10.5 控制平面故障 (Control Plane Failures)</h3><ul><li><p><strong>API Server 不可用</strong>：<code>etcd</code> 问题、证书过期、端口冲突。</p></li><li><p><strong>Scheduler 不调度</strong>：<code>kube-scheduler</code> 进程问题、资源不足。</p></li><li><p><strong>Controller Manager 不工作</strong>：相关控制器错误。</p></li><li><p><strong>调试</strong>：查看 Master 节点上各组件的静态 Pod 日志 (<code>/etc/kubernetes/manifests/</code>)。</p></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;一、-集群架构&quot;&gt;&lt;a href=&quot;#一、-集群架构&quot; class=&quot;headerlink&quot; title=&quot;一、 集群架构&quot;&gt;&lt;/a&gt;一、 集群架构&lt;/h2&gt;&lt;h3 id=&quot;1-1-集群架构&quot;&gt;&lt;a href=&quot;#1-1-集群架构&quot; class=&quot;headerli</summary>
      
    
    
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://nikieuphoria.github.io/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="运维" scheme="https://nikieuphoria.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="kubernates" scheme="https://nikieuphoria.github.io/tags/kubernates/"/>
    
  </entry>
  
  <entry>
    <title>004-自由，很诱人啊</title>
    <link href="https://nikieuphoria.github.io/2025/09/17/004-%E8%87%AA%E7%94%B1%EF%BC%8C%E5%BE%88%E8%AF%B1%E4%BA%BA%E5%95%8A/"/>
    <id>https://nikieuphoria.github.io/2025/09/17/004-%E8%87%AA%E7%94%B1%EF%BC%8C%E5%BE%88%E8%AF%B1%E4%BA%BA%E5%95%8A/</id>
    <published>2025-09-16T16:00:00.000Z</published>
    <updated>2025-11-19T09:39:05.083Z</updated>
    
    <content type="html"><![CDATA[<p>柴静写过一篇博客《我只是讨厌屈服》，几年后，她去采访一名因言论获罪被关押的人。</p><p> <em>“你为什么要这么做？”</em><br><em>“因为我看过一篇文章，说的是一个叫郝劲松的律师，那篇文章叫什么……叫什么屈服……”</em><br><em>“《我只是讨厌屈服》。”</em></p><p>有着不必久留的决定，因为无法完成工作而感受到的痛苦也削弱了。<br>在目标缺乏清晰定义、执行路径被反复推翻、评估标准模糊的环境里，任务天然就是“完成不了”的。</p><p><strong>“我对此不必负责”</strong></p><hr><p>奴性的“苦中苦”精神兑换成成为“人上人”的筹码：忍耐一下，再努力一点你就可以奴役别人了。<br>这种循环往复的权力游戏中，谄媚与霸凌如影随形，受压迫者终将成为压迫者。</p><p> 我实在害怕参与这种权利游戏。</p><p>最近久违看一部电视剧：女主角作为初级律师，被直接上级压榨甩锅，疲惫的加班后，神情落寞走在CBD的街道上。</p><p>看起来很常见的场景，都市剧为了体现角色的成长，不乏这种情节。</p><p>但看着她被客户和领导双面夹击，可悲的感同身受开始袭击大脑</p><hr><p>大通铺的工位上，我什么也没放。</p><p>漱口水、纸巾、人生切割术的周边鼠标垫、水杯，</p><p>身后经常传来项目经理的手机铃声，午夜梦回，鬼袭来，伴随的可能就是那个bgm。</p><p>恍然间一时困惑，我的痛苦是真是的吗？会不会是我想象出来的，我骟啊！</p><p>这不太对。</p><p>人在环境里会不自觉趋同，会困惑，失去洒脱，不断诉诸自己</p><p><em>这个世界是由强烈的信念、贫乏的想象力和微弱的理解所支配的。</em></p><hr><p>死亡，是一个词语，是一个动作，是一个状态，是结束，是开始。</p><p>最近很喜欢的一部恐怖片，是《TXQ FICTION <em>向饭沼一家谢罪</em>》</p><p>它完美符合我对恐惧的理解，人比鬼更加丑陋。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;柴静写过一篇博客《我只是讨厌屈服》，几年后，她去采访一名因言论获罪被关押的人。&lt;/p&gt;
&lt;p&gt; &lt;em&gt;“你为什么要这么做？”&lt;/em&gt;&lt;br&gt;&lt;em&gt;“因为我看过一篇文章，说的是一个叫郝劲松的律师，那篇文章叫什么……叫什么屈服……”&lt;/em&gt;&lt;br&gt;&lt;em&gt;“《我只是讨厌</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>003-贪嗔痴恨爱恶欲</title>
    <link href="https://nikieuphoria.github.io/2025/09/03/003-%E8%B4%AA%E5%97%94%E7%97%B4%E6%81%A8%E7%88%B1%E6%81%B6%E6%AC%B2/"/>
    <id>https://nikieuphoria.github.io/2025/09/03/003-%E8%B4%AA%E5%97%94%E7%97%B4%E6%81%A8%E7%88%B1%E6%81%B6%E6%AC%B2/</id>
    <published>2025-09-02T16:00:00.000Z</published>
    <updated>2025-11-19T09:38:56.200Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>游泳是贪嗔痴恨爱恶欲短暂消失的飞行时刻，陆地上的声音太多太杂：批评的声音，嘲笑的声音，轻蔑的声音。</p></blockquote><p>陆地上除了呼吸自由，什么都不自由。在水里，除了呼吸不自由，其他都自由!<br>下了水的那一刻，世界变得美妙起来，耳边安静，身体轻盈，这是属于一个人的世界，蹬壁出发的那一刻，我感觉自己像一支离弦的箭，各种情绪都跟不上我的速度。<br>游完泳的筋疲力尽，湿漉的头发，皮肤上略带紧绷感的潮湿，走出泳池之后风很轻的触摸皮肤，柔柔的，感觉身体很重又很轻，出来后骑车吹风听着歌喝着汽水，是人生中最爽最爽的时刻。<br>回到家便可拥有一个非常安心的好眠，四肢瘫软，睡到自然醒，第二天轻了两三斤，一切的一切，都是这么好</p><p>什么时候去学自由泳？</p><p>技术、学科类的学习，我喜欢自由探索和拆解问题的过程。可像游泳这种，动作标准和身体反馈很难靠自己完全判断，我就喜欢找老师，正确的动作和及时纠错比探索更重要。</p><p>上周末去深圳找朋友玩，六个人居然都是校友（为什么用都</p><p>晚上我躺在朋友的床上，空调的冷风让手臂起了小小的颤栗，我格外喜欢。</p><p>对她倾诉了一些郁结之事后，她惊诧：你还想在工作中学到什么啊？</p><p><img src="/images/sunset.jpg" alt="EC2"></p><hr><p>上个月微信读书记录了53个小时：</p><ul><li>一本嬴政统一六国为背景的故事</li><li>一本安史之乱后的架空唐朝故事</li><li>一本日本明治及大正时代</li><li>张天翼的《人鱼之间》</li></ul><hr><p>计划好十月的出行，却买反了往返机票。</p><hr><p>我最喜欢的寓言故事是小马过河<br>现在我这匹小马在河边来回徘徊踌躇不前犹豫不决</p><hr>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;游泳是贪嗔痴恨爱恶欲短暂消失的飞行时刻，陆地上的声音太多太杂：批评的声音，嘲笑的声音，轻蔑的声音。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;陆地上除了呼吸自由，什么都不自由。在水里，除了呼吸不自由，其他都自由!&lt;br&gt;下了水的那一刻，世界变得美妙</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>002-薛定谔，你在吗？</title>
    <link href="https://nikieuphoria.github.io/2025/08/05/002-%E8%96%9B%E5%AE%9A%E8%B0%94%EF%BC%8C%E4%BD%A0%E5%9C%A8%E5%90%97%EF%BC%9F/"/>
    <id>https://nikieuphoria.github.io/2025/08/05/002-%E8%96%9B%E5%AE%9A%E8%B0%94%EF%BC%8C%E4%BD%A0%E5%9C%A8%E5%90%97%EF%BC%9F/</id>
    <published>2025-08-04T16:00:00.000Z</published>
    <updated>2025-11-19T09:38:39.048Z</updated>
    
    <content type="html"><![CDATA[<p>最近的新闻频繁上演诡谲的话题：宛如《哭悲》里面异化的世界。</p><p>极端的焦虑、不安、困惑和痛苦，我想要呕吐，恐惧自己马上成为刀刃下的腐骨，更恐惧的是我甚至发不出愤怒的声音，就此寂静下去。</p><p>当然，这是一篇2025过半的回顾，我控制自己不要呕吐出太多负面的情绪。</p><hr><p>打字的时候是八月，年中已经过去了整整两个月，我却几乎毫无察觉。身体还滞留在年初的某个时间点。<br>工作后一个问题产生了：<br><strong>在工作中寻求成长感和价值感是不是一种错？  工作是不是就该只是一个赚钱的工具？</strong><br>从更换项目以来，这个疑问宛如缠绕我的恶鬼，时时刻刻将我逼迫到崩溃的边缘。</p><p>说实话，我的第一个项目环境挺轻松，领导同事也都很好。但就算这样，我还是能从中榨出一些痛苦，那种现在看来已经算奢侈的痛苦：比如工作一段时间后就觉得自己学习的速度减慢了，不再像刚入职那样快速吸收新东西。<br>但那个项目起码流程清晰、可追溯、标准化，领导给的权限是有限但稳定的。更重要的是，同事的工作方式彻底改变了我对技术的理解和看法。</p><p>可惜，当时我也开始感到不安。生活很美好，甚至可以说无聊，而我却因此感到恐惧：<br>“要是一直这样，我是不是就停滞不前了？是不是成长得太慢了？”</p><p>于是我去了另一个项目。搬家的琐碎、通勤时间成本增加、生活成本增加、居住环境质量下降、新环境、新同事……</p><p>做决定很纠结。但对我来说，“纠结”往往不是因为不知道选哪条路，而是我心里已经有答案了，但需要一些成熟的逻辑和可信任的理论来支撑。</p><p>第一天我就有即将不幸的预感，如同宿命论的舞台上最后一幕的雨，象征着悲剧。<br>第一周我就开始不安。<br>第一个半月我崩溃了。</p><p>然后前文所说的疑问就开始唱歌，无时无刻我质询自己，观察别人，试图获得答案。<br>我还开始写职场七宗罪，^ ^<br>叙述那些经历和感受都是一种痛，跳过。</p><p>疑问没有答案。<br>为了不把自己拖死，我开始自我保护，也就是彻底摆烂。上班带上耳机听犯罪播客，看罪案（倾情推荐xinklings，我超喜欢的一个写罪案的女博主）。<br>我不再提出疑问，不再思考如何更好解决工作中出现的问题，不再积极跟进问题。甲领导说A好，我就照着A做，即使A根本没有道理。</p><p>就这样摆烂了一个月。<br>我和领导五月argue过，直到八月才调整工作重点。<br><img src="/images/sky.jpg" alt="EC2"><br>漫长的时间里，对工作本体的不满已经升维成为对领导能力、甲方、客户、公司制度、公司属性的多面一体不满了。<br>工作一步一步侵占我的自由，管理者满不在乎：“不就几分钟嘛，到底是有多难？”<br>打卡，日报，周报，工作量汇总，服装，工牌……<br>一切永无止境。</p><p>疑问还是没有答案，我还是时常愤怒和痛苦，目前还在寻找解决方式。<br>顺便一提，职场七宗罪已经写道第六条了。</p><blockquote><p>任何一个在普世登本位里给上级打工的feminist，基本上没有不反思自己、不为工作的组织框架下被管理、被训诫、被规训而痛苦的。</p></blockquote><hr><p>第一个问题浮现后，第二个也紧随其后：我是否真的适合做技术工作。<br>有时候过度思考某个问题会陷入深渊。</p><p>我的解决方式是：</p><blockquote><p><strong>不要在不会某件事情的时候断言自己不喜欢不适合。</strong></p></blockquote><p><img src="/images/tree.jpg" alt="EC2"></p><hr><p>今年搬家后，我和这个城市遇到的一个同期同事，成为了朋友，我们一起过了生日。</p><p>灵感终于落实成文字，虽然因为工作中断了，但至少5W字了。</p><p>本来年初写下阅读目标是30本，现在已经读完24本，得益于每天通勤时间的变长。</p><p>开始建设自己的Linkedin，封了两次号，现在终于正常运行。</p><p>有了第一个文身。</p><p>公众号邀请我写了技术分享文章。</p><p>虽然还是没有去学自由泳。&gt;_&lt;</p><p>奇怪，怎么写得像是年终总结。工作，你毁了我！！！<br><img src="/images/w1.jpg" alt="EC2"></p><p>所谓“时代变局”不只是新闻用语，它正在一点点渗进我的日常。<br>命运的诡谲之处就在于，没有是非题，只要我骗过自己，就能皆大欢喜。<br>可我并不想欺骗自己：我过得幸福。</p><p>我忍不住朝虚空大喊：“薛定谔，你在吗？”</p><p><img src="/images/xde.jpg" alt="EC2"></p><p>可事实上，在盒子里我注定只是工具，想要摆脱黑暗，只能逃出去，顺便反咬薛定谔一口。</p><p><img src="/images/taluo.jpg" alt="EC2"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;最近的新闻频繁上演诡谲的话题：宛如《哭悲》里面异化的世界。&lt;/p&gt;
&lt;p&gt;极端的焦虑、不安、困惑和痛苦，我想要呕吐，恐惧自己马上成为刀刃下的腐骨，更恐惧的是我甚至发不出愤怒的声音，就此寂静下去。&lt;/p&gt;
&lt;p&gt;当然，这是一篇2025过半的回顾，我控制自己不要呕吐出太多负面的</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>AWS-SAA认证全攻略</title>
    <link href="https://nikieuphoria.github.io/2025/07/15/AWS-SAA%E8%AE%A4%E8%AF%81%E5%85%A8%E6%94%BB%E7%95%A5/"/>
    <id>https://nikieuphoria.github.io/2025/07/15/AWS-SAA%E8%AE%A4%E8%AF%81%E5%85%A8%E6%94%BB%E7%95%A5/</id>
    <published>2025-07-14T16:00:00.000Z</published>
    <updated>2025-08-05T06:27:30.640Z</updated>
    
    <content type="html"><![CDATA[<p>此篇文章源自我在WomenStack 百栈百胜公众号的一次分享，公众号文章链接附下，欢迎大家关注微信公众号WomenStack 百栈百胜<br><a href="https://mp.weixin.qq.com/s?__biz=Mzk4ODQ2NzkxOQ==&mid=2247485911&idx=1&sn=82f2435d9600c3b4be6aa200df2c1d7a&chksm=c4d61b2fafa6e6642660c64001f4dd53009cd7a998e79f94e9ff68accda2572c47d9ea51f575&mpshare=1&scene=1&srcid=0729ZToFy994c5rHOusSlaqM&sharer_shareinfo=8993ec30eec70b4e1b042681f1ed1f18&sharer_shareinfo_first=cc8c545add2d44d6f5095cb1a0818068#rd">https://mp.weixin.qq.com/s?__biz=Mzk4ODQ2NzkxOQ==&amp;mid=2247485911&amp;idx=1&amp;sn=82f2435d9600c3b4be6aa200df2c1d7a&amp;chksm=c4d61b2fafa6e6642660c64001f4dd53009cd7a998e79f94e9ff68accda2572c47d9ea51f575&amp;mpshare=1&amp;scene=1&amp;srcid=0729ZToFy994c5rHOusSlaqM&amp;sharer_shareinfo=8993ec30eec70b4e1b042681f1ed1f18&amp;sharer_shareinfo_first=cc8c545add2d44d6f5095cb1a0818068#rd</a></p><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>我学云计算的第一步，是靠考下 <strong>AWS Certified Solutions Architect – Associate（简称 SAA</strong><strong>）</strong> 完成的。</p><p>AWS（Amazon Web Services）是亚马逊（Amazon）旗下的云计算平台，与 Microsoft Azure、Google Cloud Platform（GCP）并称全球三大云服务商。 国内则有阿里巴巴、腾讯、华为等公司提供各自的云服务，分别是阿里云、腾讯云和华为云。</p><p>虽然各家厂商均推出自有认证体系，但AWS的很多架构与服务都是云计算的行业标准。即便考完很久，大部分知识都忘记了，但现在无论使用哪家厂商的云服务，我都能将其对应到 AWS 的服务。</p><p>这并不意味着考试万能，对我的职业路径也没有巨大增益，但在学习过程中，通过将零散的服务组件系统性地整合为完整的架构体系，重新审视并理解传统IT架构的本质特征与运行逻辑，这些对我而言是非常宝贵的经历。</p><p>我学习到的，<strong>不只是“该用哪个服务”，而是“如何思考”。<strong>它帮我建立了</strong>云原生****的思维方式</strong>，让我在后续的实际项目、技术决策中，能更清晰地分析问题、设计架构。</p><p>AWS提供非常多的认证，可以通过官网查看。大致分为入门、助理、专业、专项。详细认证信息可通过文末链接[2]查看。</p><p>作为初学者，应该选择<strong>入门级</strong>的Cloud Practitioner还是<strong>助理级</strong>的Solutions Architect Associate呢？</p><p>Cloud Practitioner（云计算从业者）更加关注云服务本身，适合没有技术背景的人员，需要知道有哪些产品、能做什么、大概怎么用即可，无需深究架构原理。</p><p>Solutions Architect Associate（解决方案架构师助理级）适合开发者、运维工程师、系统工程师，更加侧重云服务在架构中如何发挥作用，更要掌握它们如何组合成高可用、可扩展、成本优化的整体解决方案。</p><p>我本身是计算机专业背景，玩过虚拟机、搭过服务，对 Linux 、计算机网络不陌生，但不了解云原生云计算，当时的职业规划也更倾向于建立系统的云架构设计能力，所以选择SAA而非CP（Cloud Practitioner）。当然，国内的云认证更方便，如阿里云的ACP（阿里云云计算高级工程师Alibaba Cloud Certified Professional - Cloud Computing），资源更加好获取，语言也没有门槛，怎么选看个人倾向。</p><p>本文主要分享AWS-SAA（解决方案架构师助理级）的认证经验。</p><h1 id="个人情况"><a href="#个人情况" class="headerlink" title="个人情况"></a>个人情况</h1><p>背景：计算机专业，对云服务完全不了解</p><p>备考时长时间：48天左右</p><ul><li>学习：35天，每天有效学习时长3~5小时（其中可能有1-3天去玩了）</li><li>刷题：13天</li></ul><p>刷题来源：ExamTopics</p><h1 id="关于-AWS-SAA-考试："><a href="#关于-AWS-SAA-考试：" class="headerlink" title="关于 AWS SAA 考试："></a>关于 AWS SAA 考试：</h1><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ul><li>SAA-C03 是 <strong>AWS SAA</strong> 认证考试的最新版本代码，于 2022 年 8 月 30 日正式启用，替代旧版 SAA-C02。在获取资料、学习、刷题过程中请认准最新代码。</li><li>认证常见问题（重考政策等）见文末[3]。</li><li>考前、考中和考后的流程与要求见文末[4]。</li></ul><h2 id="折扣与报名"><a href="#折扣与报名" class="headerlink" title="折扣与报名"></a>折扣与报名</h2><ul><li>官方价格150 USD（约1085元），AWS官方提供多种活动获取折扣优惠。此外，通过任何一项认证后能够领取五折优惠券。</li><li>考试方式：线下考试中心或在线监考考试。</li><li>考试语言：推荐选<strong>中文</strong>，因为选了中文之后也可以查看英文考题，反之则不行。</li><li>提前 1 周预约即可，如果需要更改预约时间，在<strong>考试时间至少 24 小时之前</strong>取消或重新预约。</li><li>报考链接见文末[5]。</li></ul><hr><h2 id="题目结构"><a href="#题目结构" class="headerlink" title="题目结构"></a>题目结构</h2><ul><li>一共 <strong>65 道题。</strong></li><li>其中有15道为不计分试题。AWS 收集这些不计分试题的 答题情况以进行评估，以便将来将这些试题作为计分试题。在考试中不会标明不计分试题。</li><li>全部为 <strong>单选 &#x2F; 多选。</strong></li><li>题目比较长，包含场景描述、业务背景、架构限制等。</li></ul><hr><h2 id="考试时间与结果"><a href="#考试时间与结果" class="headerlink" title="考试时间与结果"></a>考试时间与结果</h2><ul><li>考试时长：130 分钟，非英语母语者申请 Exam Accommodations将考试时间延长 30 分钟。</li><li>考试结果换算分数为 100 – 1000 分。最低及格分数为 720 分。</li><li>完成考试后，不会立马在屏幕上看到考试结果。</li><li>未通过考试，需要 14 天后才能重考。重考次数没有限制，但每次重考都必须全额支付报名费。</li></ul><h1 id="学习资源"><a href="#学习资源" class="headerlink" title="学习资源"></a>学习资源</h1><h2 id="官方学习资料——AWS-白皮书"><a href="#官方学习资料——AWS-白皮书" class="headerlink" title="官方学习资料——AWS 白皮书"></a>官方学习资料——AWS 白皮书</h2><p>白皮书提供非常详细的文档支持，大部分疑问都可以得到答案。学会熟练查阅白皮书，从官方文档获取最全面的云产品信息。白皮书链接见文末[6]。</p><h2 id="考点知识大纲"><a href="#考点知识大纲" class="headerlink" title="考点知识大纲"></a>考点知识大纲</h2><p>AWS目前有近百项服务，不过如果想通过AWS的助理级认证，只需要熟悉掌握主要的服务即可。对其他服务只需要明白其使用场景以及一些应用限制。官方提供的大纲更加详细，但是以<strong>设计架构</strong>的角度出发。官方大纲pdf可通过文末[7]获取。</p><p>我的大纲是从学习者角度出发整理的，这里只作为补充参考。一部分内容如机器学习几乎不占比重，不是考试重点，但偶尔也会出现在考题中，你只需要大概知道即可。</p><ol><li>计算服务（Compute）<br> EC2：需掌握启动、配置、安全组、弹性 IP、Auto Scaling<br> Lambda：事件驱动的无服务器计算服务<br> Elastic Beanstalk：自动化部署与管理<br> ECS &#x2F; EKS（容器服务）</li><li>存储服务（Storage）<br> S3：存储桶、存储类别、生命周期管理、版本控制、加密等<br> EBS：卷类型（gp3、io2）、快照、加密<br> EFS：适用于多个 EC2 实例共享访问的文件存储<br> FSx：适用于 Windows 文件服务器或高性能计算（Lustre）</li><li>数据库服务（Database）：<br> RDS：托管版数据库</li></ol><p>Aurora：兼容 MySQL&#x2F;PostgreSQL，比 RDS 更快更贵</p><p>DynamoDB：NoSQL 数据库</p><p>ElastiCache：托管版 Redis 或 Memcached</p><p>Redshift：数据仓库，跑大规模分析 SQL，适合 BI 报表</p><p>Transfer Family：用 SFTP&#x2F;FTP&#x2F;FTPS 把数据安全地迁到 AWS 上</p><p>Snow Family：实体硬件设备，用来物理迁移海量数据进云</p><ol start="4"><li>网络（Networking）<br> VPC：包含子网（公有&#x2F;私有）、路由表、安全组（SG）与网络ACL<br> IGW NAT Gateway：分别用于公网访问与私网出站访问<br> Bastion Host：跳板机，用于安全访问私有子网<br> Route 53：DNS 服务<br> CloudFront：CDN 加速服务<br> Direct Connect &#x2F; Transit Gateway</li><li>Serverless 、应用解耦与集成<br> Lambda + API Gateway<br> Kinesis<br> SNS（发布&#x2F;订阅）<br> SQS（消息队列）<br> EventBridge：事件总线，支持跨服务事件驱动架构<br> Step Functions：状态管理 + 工作流编排</li><li>灾难恢复与数据迁移（DR &amp; Migration）<br> 灾难恢复方案<br> 数据迁移工具<br> 备份策略</li><li>安全与权限控制（Security &amp; Identity）<br> IAM：身份与访问管理（用户、组、角色、策略）<br> Organizations &#x2F; SCP：多账户管理与集中策略控制<br> KMS：密钥管理服务（对数据加密解密）<br> CloudTrail &#x2F; Config：操作记录审计与合规性监控<br> CloudWatch：监控服务，含日志、指标、报警、仪表板</li></ol><h2 id="Udemy课程"><a href="#Udemy课程" class="headerlink" title="Udemy课程"></a>Udemy课程</h2><p>Udemy平台Stephane Maarek的《Ultimate AWS Certified Solutions Architect Associate》，官方链接见文末[8]。</p><p>该课程面向初学者，无需了解任何 AWS 知识，提供完整的学习路径，包括：</p><ul><li>完整的模拟考试，包括解释！</li><li>所有 800 多张幻灯片均以可下载的 PDF 形式提供</li><li>实操部分的详细讲解，包括Troubleshooting</li><li>了解 AWS 基础知识：计算服务（EC2&#x2F;Lambda&#x2F;EKS、存储体系（S3&#x2F;EBS&#x2F;EFS）、 网络架构（VPC&#x2F;Route53&#x2F;CloudFront）、数据库服务（RDS&#x2F;DynamoDB&#x2F;ElastiCache）</li><li>解决方案架构：架构设计原则、高性能架构、安全合规、成本优化</li></ul><p>最重要的几个产品讲解得非常细，搭配动手操作。对于云计算小白来说很不错，加深理解，巩固记忆。课程为英文，前期我挂了翻译，我后期基本就不需要翻译也能够看懂。</p><h1 id="学习路径"><a href="#学习路径" class="headerlink" title="学习路径"></a>学习路径</h1><h2 id="动手实践——理论与实操相结合"><a href="#动手实践——理论与实操相结合" class="headerlink" title="动手实践——理论与实操相结合"></a>动手实践——理论与实操相结合</h2><p>注册 AWS <strong>全球区</strong>账号，绑定信用卡即可激活一年的 Free Tier。免费额度覆盖大部分备考所需资源。</p><p>针对重要服务可以多练手，如EC2，S3，网络部分的服务。例如：</p><ul><li>启动EC2实例、配置安全组、SSH 连接、安装 web server；</li><li>S3： 上传下载对象、设置 bucket policy、版本控制等 ；</li><li>VPC + EC2 + S3 组合</li></ul><h2 id="高效笔记策略——记录与知识内化"><a href="#高效笔记策略——记录与知识内化" class="headerlink" title="高效笔记策略——记录与知识内化"></a>高效笔记策略——记录与知识内化</h2><p>入门阶段，你会被大量缩写词包围，各个云厂商的命名也不尽相同。例如，AWS 把云服务器叫作 EC2（Elastic Compute Cloud），阿里云则叫 ECS（Elastic Compute Service）。</p><p>网上中英文备考笔记俯拾皆是，官方白皮书更是全面，Stephane Maarek课程所提供的PPT干货满满。</p><p>但我仍强烈建议——<strong>用自己的话再写一遍</strong>。把别人的知识先嚼碎，再用自己的逻辑吐出来，记忆最深，理解也最透彻。</p><p>每个人的习惯不同，我习惯抓住几个点进行衍射：</p><h3 id="服务理解"><a href="#服务理解" class="headerlink" title="服务理解"></a>服务理解</h3><ul><li>是什么，有什么用？</li><li>在传统架构中对应什么服务？（这一步只是在初期帮助小白建立云原生的基础认知，后期应建立纯粹的云原生思维就不需要这一步骤了）</li><li>和别的服务如何组合，和其他服务的区别是什么？</li></ul><p>比如<strong>EC2</strong></p><ul><li>是什么：服务器，不过是在云上的服务器，你不需要再关注传统服务器的硬件等问题。</li><li>有什么用：跑网站、跑脚本、部署程序，物理服务器能干的它就能，物理服务器不能干的它也能，而且更加灵活。</li><li>之后再衍生到EC2的细节。</li></ul><h3 id="结构化记录"><a href="#结构化记录" class="headerlink" title="结构化记录"></a>结构化记录</h3><p>阶段性整理笔记，填充到学习大纲中。</p><h3 id="可视化输出"><a href="#可视化输出" class="headerlink" title="可视化输出"></a>可视化输出</h3><p>用一张图理清架构，用一张表分清差异</p><p>等你大致知道每个服务“干啥用”的时候，就要开始想它们<strong>怎么组合</strong>，以及两个相似产品的<strong>差异</strong>。 这里推荐draw.io绘制架构图，它提供了很多厂商的图标，如AWS、Cisco、Azure、Google等。</p><p>当你学习到网络这一部分时：</p><p>怎样做才能实现私有子网的 Internet 访问？</p><p>VPC和Internet之间相互通信可以用什么服务？</p><p>区域到区域、 可用区到可用区、私有到公有间的通信方式？</p><p>这时候，你可以通过架构图来帮助自己理解。</p><p><img src="/2025/07/15/AWS-SAA%E8%AE%A4%E8%AF%81%E5%85%A8%E6%94%BB%E7%95%A5/AWS-%E7%BD%91png.png" title="null"><img src="https://cdn.nlark.com/yuque/0/2025/png/58720042/1752744653217-7fd7970f-3bd9-4e4c-bd8d-233e0d4504ba.png" title="我绘制的网络部分架构图"></p><p>那SG和NACL有什么区别，你可以通过表格来直观感受他们的相似和不同：</p><table><thead><tr><th></th><th></th><th></th></tr></thead><tbody><tr><td>特点 &#x2F; 注意事项</td><td>安全组 (SG)</td><td>网络访问控制列表 (NACL)</td></tr><tr><td>类型</td><td>instance级别防火墙</td><td>subnet级别防火墙</td></tr><tr><td>方向</td><td>可以配置入站和出站规则</td><td><strong>必须</strong>同时配置入站和出站规则</td></tr><tr><td>默认规则</td><td>拒绝所有流量</td><td>允许所有流量</td></tr><tr><td>有状态性</td><td>有状态，自动允许相关回复流量</td><td>无状态，入站和出站流量的状态是分开维护</td></tr><tr><td>数量限制</td><td>一个实例可以关联多个SG</td><td>一个子网只能关联一个NACL</td></tr><tr><td>功能</td><td>简单，易于使用</td><td>较为复杂，可用于更细粒度的控制</td></tr></tbody></table><h2 id="刷题"><a href="#刷题" class="headerlink" title="刷题"></a>刷题</h2><p><strong>懂产品 ≠ 会做题</strong>。传统选择题往往是选择正确答案，但AWS-SAA认证中，题干往往是：</p><ul><li>哪个服务在特定场景下最合适？</li><li>哪种方案最安全 &#x2F; 最省钱 &#x2F; 最少运维？</li></ul><p>许多考生常陷入一个认知误区：认为掌握AWS产品功能就等同于具备通过认证考试的能力。实际上，AWS认证考核的是一种更高阶的架构思维。考试设计的深层逻辑：</p><ul><li>场景化决策</li><li>可能没有绝对”正确”的答案，只有针对特定约束条件的”最优解”</li></ul><h3 id="刷题资源"><a href="#刷题资源" class="headerlink" title="刷题资源"></a>刷题资源</h3><p>主要使用 <strong>ExamTopics</strong>，官方目前题量超 1000 题。官方链接见文末[9]。</p><ul><li><strong>优点</strong>：<br>  题目质量接近考试真实难度，命中率高，国内大多数人选择该题库。我实际考试中碰到好几道原题。即使只刷了约 400 题精选题，收获也很大。国内也很容易找到整理好的中英双语版本，包括高频精选题、各种格式的 PDF 或表格，获取成本不高。</li><li><strong>缺点</strong>：<br>  个别题目存在答案争议，站内讨论和 AI 解读也无法统一。好在这类题占比极低，影响不大。</li></ul><p><strong>其他来源</strong><br>Udemy 的Practice Exams ：难度普遍高于真题，我评估后没有采用；</p><p>Whizlabs &#x2F; Tutorial Dojo（TD）： 解释详细，命中率略低于 ExamTopics ；</p><p>Ping-T：日语；</p><h3 id="刷题策略：高效规划你的学习路径"><a href="#刷题策略：高效规划你的学习路径" class="headerlink" title="刷题策略：高效规划你的学习路径"></a>刷题策略：高效规划你的学习路径</h3><p>个人刷题方法：每天 50 题左右，不求多但求精。做完一定会提炼每题的关键考点，错题或我觉得有意义的题进行归档，标注错因与正确思路；把相关知识点再复习一遍。我选择的是最适合自己的方式，也有很多人选择背题备考，速度更快。</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/58720042/1753077463133-334e4d8b-3d34-4e65-89f7-106b9cc09867.png" title="当时的做题记录"></p><h3 id="刷题精髓：掌握这些技巧让效率倍增"><a href="#刷题精髓：掌握这些技巧让效率倍增" class="headerlink" title="刷题精髓：掌握这些技巧让效率倍增"></a>刷题精髓：掌握这些技巧让效率倍增</h3><p><strong>使用 AI 辅助学习：</strong><br>当你学完课程开始做题，最开始可能完全看不懂题干。不用担心，这很正常。此时你可以借助AI，让它向你解释。你需要10-20题的适应期来理解出题逻辑。</p><p><strong>适当总结记忆：</strong></p><ul><li><p>EBS 加密 → 想到 <strong>KMS</strong></p></li><li><p>移动&#x2F;网络应用程序身份验证 → 想到 <strong>Cognito</strong> 和 <strong>MFA</strong></p></li><li><p><img src="https://cdn.nlark.com/yuque/0/2025/png/58720042/1753112096433-c0311260-b1ca-4687-9dfb-1df87d8f04f0.png" title="不同服务的延迟时间"></p></li></ul><p><strong>关键词识别技巧：</strong><br>当题目中出现 <strong>“细粒度”</strong> 时，要特别关注：</p><ul><li>是否仅授予特定实体（用户、角色、服务）<strong>最小必要权限</strong></li><li>是否限定权限只作用于<strong>特定资源</strong>，而不是整块服务或整个 bucket</li></ul><h3 id="实例解析：手把手教你做题"><a href="#实例解析：手把手教你做题" class="headerlink" title="实例解析：手把手教你做题"></a>实例解析：手把手教你做题</h3><p>一家公司使用在 Amazon EC2 实例上运行的 RESTful Web 服务应用程序从数千个远程设备收集数据。 EC2 实例接收原始数据，转换原始数据，并将所有数据存储在 Amazon S3存储桶中。远程设备的数量很快将增加到数百万。该公司需要一个<strong>高度可扩展</strong>的解决方案，<strong>最大限度地减少运维开销</strong>。</p><p>解决方案架构师应该采取哪些步骤<strong>组合</strong>来满足这些要求？ （选择两个。）</p><p>A. 使用 AWS Glue 处理 Amazon S3 中的原始数据。</p><p>B. 使用 Amazon Route 53 将流量路由到不同的 EC2 实例。</p><p>C. 添加更多 EC2 实例以适应不断增加的传入数据量。</p><p>D. 将原始数据发送到 Amazon Simple Queue Service (Amazon SQS)。使用 EC2 实例来处理数据。</p><p>E. 使用 Amazon API Gateway 将原始数据发送到 Amazon Kinesis 数据流。配置 Amazon Kinesis Data Firehose 以使用数据流作为源将数据传输到 Amazon S3</p><p>简单来说就是有家公司将 Web 服务部署在 EC2 （云服务器）上，它会接收大量数据，然后做些处理，最后把结果存到 S3（一个对象存储服务），现在数据开始变多。</p><p>等你开始学习课程，你一定会捕捉到题干中很关键的两点：</p><ul><li><strong>高度可扩展， highly scalable,：需要能自动扩容的架构</strong></li><li><strong>减少运维开销：优先选择Serverless（无服务器）方案</strong></li></ul><p>目前业务架构：EC2 接收数据，EC2 处理数据，EC2 存入 S3</p><p><img src="https://cdn.nlark.com/yuque/0/2025/png/58720042/1752744723175-04471ffc-e54e-490b-a6f1-3a1c98e45993.png" title="公司当前的业务架构"></p><p>接着我们了解一下选项中的服务：</p><ul><li>AWS Glue ：集成、转换和加载数据的服务。scalable，severless</li><li>Amazon Route 53：DNS 服务，用来解析域名</li><li>Amazon SQS：消息队列服务，缓冲流量、解耦系统。 scalable，severless</li><li>Amazon API Gateway：并将不同的后端服务整合到一个统一的接口中。自动扩容能力，无需关心并发数severless</li><li>Amazon Kinesis：<strong>完全托管</strong>的流数据处理服务。 scalable，severless</li></ul><p>这时候我们需要考虑，如何高效接收海量数据，如何处理这些数据。</p><ul><li><p>B选项：使用 Amazon Route 53 将流量路由到不同的 EC2 实例。</p></li><li><p>Amazon Route 53是 DNS 路由服务，不能直接处理请求或做负载均衡</p></li><li><p>C选项： 添加更多 EC2 实例以适应不断增加的传入数据量。</p></li><li><p>可扩展是可扩展，但搭 Auto Scaling之后，管理大量 EC2 实例会带来高昂的运维成本</p></li><li><p>D选项：将原始数据发送到 Amazon Simple Queue Service (Amazon SQS)。使用 EC2 实例来处理数据。</p></li><li><p>SQS虽然解耦了流量，但仍然要运维 EC2实例</p></li></ul><p>现在我们来看一下选择AE之后，业务架构变成下图：</p><p><img src="/2025/07/15/AWS-SAA%E8%AE%A4%E8%AF%81%E5%85%A8%E6%94%BB%E7%95%A5/question.drawio.png" title="null"><img src="https://cdn.nlark.com/yuque/0/2025/png/58720042/1752744740911-0f5b4518-68d2-4203-ba5e-2856a6dd92c6.png" title="AE选项组合后的业务架构"></p><p>这时候，API Gateway 作为流量入口，<strong>动态应对高并发</strong>；</p><p>Kinesis Data Stream可<strong>动态扩展</strong>应对激增的请求量；</p><p>Firehose 从数据流中读取数据，然后写入 S3，<strong>无需人工干预，全自动交付</strong>；</p><p>S3存储原始数据，AWS Glue处理数据，<strong>完全托管无需运维</strong>。</p><h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>以上内容都是我的个人经验分享，不具备权威性，也可能因时间推移而有所滞后，仅供参考。</p><p>最后私心放上Stephane Maarek的几句话：</p><p>当开始学习并使用云服务时，你会遇到一些困难，你会尖叫：</p><p>Nothing is working - “aaaahhhhhh”</p><p>Don’t panic.</p><p>If you still don’t understand it, no worries, this is not a blocker for the course.</p><p>Keep on going, and come back to this concept towards the end.</p><p>这不仅是我入门云原生的起点，更让我切实感受到学习的快乐、魅力，还有一种近乎狂喜的兴奋。希望你也能够获得！</p><p>Happy learning!</p><h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>[1]AWS官网</p><p>aws.amazon.com</p><p>[2]AWS的认证信息</p><p><a href="https://aws.amazon.com/cn/certification/?nc2=h_ql_le_tc_c&ams%23interactive-card-vertical%23pattern-data.filter=%257B%2522filters%2522%253A%255B%255D%257D">https://aws.amazon.com/cn/certification/?nc2=h_ql_le_tc_c&amp;ams%23interactive-card-vertical%23pattern-data.filter=%257B%2522filters%2522%253A%255B%255D%257D</a></p><p>[3]AWS认证常见问题（包括重考政策，考试更新频率等）</p><p><a href="https://aws.amazon.com/cn/certification/faqs/">https://aws.amazon.com/cn/certification/faqs/</a></p><p>[4]考前、考中和考后的流程与要求</p><p><a href="https://aws.amazon.com/cn/certification/policies/">https://aws.amazon.com/cn/certification/policies/</a></p><p>[5]AWS-SAA的报考链接</p><p><a href="https://aws.amazon.com/cn/certification/certified-solutions-architect-associate/">https://aws.amazon.com/cn/certification/certified-solutions-architect-associate/</a></p><p>[6]AWS白皮书文档</p><p><a href="https://docs.aws.amazon.com/zh_cn/">https://docs.aws.amazon.com/zh_cn/</a></p><p>[7]官方提供的大纲（链接可直接下载PDF）</p><p><a href="https://d1.awsstatic.com/zh_CN/training-and-certification/docs-sa-assoc/">https://d1.awsstatic.com/zh_CN/training-and-certification/docs-sa-assoc/</a></p><p>[8]demy平台Stephane Maarek的《Ultimate AWS Certified Solutions Architect Associate》课程链接</p><p><a href="https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/?couponCode=KEEPLEARNING">https://www.udemy.com/course/aws-certified-solutions-architect-associate-saa-c03/?couponCode=KEEPLEARNING</a></p><p>[9]examtopics链接</p><p><a href="https://www.examtopics.com/exams/amazon/aws-certified-solutions-architect-associate-saa-c03/">https://www.examtopics.com/exams/amazon/aws-certified-solutions-architect-associate-saa-c03/</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;此篇文章源自我在WomenStack 百栈百胜公众号的一次分享，公众号文章链接附下，欢迎大家关注微信公众号WomenStack 百栈百胜&lt;br&gt;&lt;a href=&quot;https://mp.weixin.qq.com/s?__biz=Mzk4ODQ2NzkxOQ==&amp;mid=22</summary>
      
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="云原生" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
    
    <category term="DevOps" scheme="https://nikieuphoria.github.io/tags/DevOps/"/>
    
    <category term="云原生" scheme="https://nikieuphoria.github.io/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/"/>
    
  </entry>
  
  <entry>
    <title>K8S-day1-初始化安装k8s集群的环境</title>
    <link href="https://nikieuphoria.github.io/2025/07/15/K8S-day1-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E7%9A%84%E7%8E%AF%E5%A2%83/"/>
    <id>https://nikieuphoria.github.io/2025/07/15/K8S-day1-%E5%88%9D%E5%A7%8B%E5%8C%96%E5%AE%89%E8%A3%85k8s%E9%9B%86%E7%BE%A4%E7%9A%84%E7%8E%AF%E5%A2%83/</id>
    <published>2025-07-14T16:00:00.000Z</published>
    <updated>2025-07-15T09:54:19.412Z</updated>
    
    <content type="html"><![CDATA[<h1 id="初始化安装k8s集群的环境"><a href="#初始化安装k8s集群的环境" class="headerlink" title="初始化安装k8s集群的环境"></a>初始化安装k8s集群的环境</h1><h2 id="环境与注意事项"><a href="#环境与注意事项" class="headerlink" title="环境与注意事项"></a>环境与注意事项</h2><table><thead><tr><th>主机名</th><th>ip地址</th></tr></thead><tbody><tr><td>master</td><td>172.20.196.17</td></tr><tr><td>node1</td><td>172.20.196.18</td></tr><tr><td>node2</td><td>172.20.196.19</td></tr></tbody></table><ul><li>我用的是云服务器，故一部分操作不需要做。<br><img src="/images/ecs.png" alt="EC2"></li><li>操作过程可以通过ansible减少重复操作。</li><li>在每台机器安装基础软件包</li></ul><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y device-mapper-persistent-data lvm2 wget net-tools nfs-utils lrzsz gcc gcc-c++ make cmake libxml2-devel openssl-devel curl curl-devel unzip sudo ntp libaio-devel wget vim ncurses-devel autoconf automake zlib-devel  python-devel epel-release openssh-server socat  ipvsadm conntrack telnet ipvsadm</span><br></pre></td></tr></table></figure><h2 id="1-配置静态ip地址"><a href="#1-配置静态ip地址" class="headerlink" title="1.  配置静态ip地址"></a>1.  配置静态ip地址</h2><p>  修改配置文件后重启网络服务</p><h2 id="2-修改主机名"><a href="#2-修改主机名" class="headerlink" title="2. 修改主机名"></a>2. 修改主机名</h2><p>分别修改三台主机名称</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname master &amp;&amp; bash </span><br></pre></td></tr></table></figure><h2 id="3-配置hosts文件"><a href="#3-配置hosts文件" class="headerlink" title="3. 配置hosts文件"></a>3. 配置hosts文件</h2><p><strong>配置主机hosts文件，相互之间通过主机名互相访问</strong><br>分别修改每台机器的&#x2F;etc&#x2F;hosts文件增加如下内容</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">172.20.196.17 master</span><br><span class="line">172.20.196.18 node1</span><br><span class="line">172.20.196.19 node2</span><br></pre></td></tr></table></figure><h2 id="4-免密登录"><a href="#4-免密登录" class="headerlink" title="4. 免密登录"></a>4. 免密登录</h2><p><strong>方便相互之前传文件</strong><br>生成密钥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br><span class="line">一路回车</span><br></pre></td></tr></table></figure><p>传输公钥（master传给node-1，node-2，other。依次传给初自己外的机器）</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id node1</span><br></pre></td></tr></table></figure><p>测试登录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# ssh node1</span><br><span class="line">Last login: Tue Jul 15 16:58:01 2025 from 120.238.191.115</span><br><span class="line"></span><br><span class="line">Welcome to Alibaba Cloud Elastic Compute Service !</span><br></pre></td></tr></table></figure><h2 id="5-关闭selinux"><a href="#5-关闭selinux" class="headerlink" title="5. 关闭selinux"></a>5. 关闭selinux</h2><p><strong>为什么要关闭selinux？</strong><br><strong>SELinux 是 Linux 系统的一种安全机制，可以限制系统资源（如文件、网络等）的访问，提高系统的安全性。在 Kubernetes 运行过程中，需要访问系统资源，但 SELinux 可能会限制访问，从而影响 Kubernetes 的运行。因此，在安装 Kubernetes 时，需要关闭 SELinux，以避免它对 Kubernetes 的影响。</strong></p><p>修改&#x2F;etc&#x2F;selinux&#x2F;config</p><h2 id="6-关闭swap分区"><a href="#6-关闭swap分区" class="headerlink" title="6. 关闭swap分区"></a>6. 关闭swap分区</h2><p>**Swap交换分区是一种在计算机中使用的虚拟内存技术。当物理内存不足以容纳当前运行的程序时，操作系统将会把一部分内存空间暂时转移到硬盘上，以便为当前程序提供运行所需的内存空间。这个过程就称为交换。**<strong>交换分区（Swap Partition）就是硬盘上专门预留给操作系统进行交换的一块空间。</strong></p><p><strong>交换分区的使用可以有效避免程序因为内存不足而崩溃或运行缓慢的问题，但是硬盘的读写速度比内存要慢得多，因此交换分区的使用会对系统的性能产生一定的影响。</strong></p><p><strong>在 Kubernetes 运行过程中，需要频繁地使用内存和磁盘等系统资源。如果使用了交换分区，会导致 Kubernetes 的运行速度变慢，从而影响整个集群的性能。因此，在安装 Kubernetes 时，通常会建议关闭交换分区。</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# swapoff -a</span><br><span class="line"></span><br><span class="line">#永久关闭：注释swap挂载，给swap这行开头加注释</span><br><span class="line">[root@master ~]# vim /etc/fstab </span><br><span class="line">#/dev/mapper/centos-swap swap      swap    defaults        0 0</span><br></pre></td></tr></table></figure><h2 id="7-修改机器内核参数"><a href="#7-修改机器内核参数" class="headerlink" title="7. 修改机器内核参数"></a>7. 修改机器内核参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# modprobe br_netfilter</span><br><span class="line"></span><br><span class="line">#modprobe br_netfilter 的作用是将 br_netfilter 模块添加到 Linux 内核中。这个模块是 Linux 网桥的核心模块，它提供了网络包转发和过滤的功能</span><br><span class="line"></span><br><span class="line">[root@master ~]# vim /etc/sysctl.d/k8s.conf </span><br><span class="line">输入如下内容：</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1    #启用ipv6数据包的过滤和处理</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1   #启用ipv4数据包的过滤和处理</span><br><span class="line">net.ipv4.ip_forward = 1   #启用了  IP 转发功能</span><br><span class="line"></span><br><span class="line">[root@master ~]# sysctl -p /etc/sysctl.d/k8s.conf</span><br></pre></td></tr></table></figure><h2 id="8-关闭防火墙"><a href="#8-关闭防火墙" class="headerlink" title="8. 关闭防火墙"></a>8. 关闭防火墙</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# systemctl stop firewalld</span><br><span class="line">[root@master ~]# systemctl disable firewalld</span><br></pre></td></tr></table></figure><h2 id="9-配置repo源"><a href="#9-配置repo源" class="headerlink" title="9. 配置repo源"></a>9. 配置repo源</h2><h2 id="10-时间同步"><a href="#10-时间同步" class="headerlink" title="10. 时间同步"></a>10. 时间同步</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#安装ntpdate命令</span><br><span class="line">[root@master ~]# yum install ntpdate -y</span><br><span class="line">#跟网络时间做同步</span><br><span class="line">[root@master ~]# ntpdate cn.pool.ntp.org</span><br><span class="line">#把时间同步做成计划任务</span><br><span class="line">[root@master ~]# crontab -e</span><br><span class="line">* *  * * * /usr/sbin/ntpdate   cn.pool.ntp.org</span><br><span class="line">[root@master ~]# systemctl restart crond</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;初始化安装k8s集群的环境&quot;&gt;&lt;a href=&quot;#初始化安装k8s集群的环境&quot; class=&quot;headerlink&quot; title=&quot;初始化安装k8s集群的环境&quot;&gt;&lt;/a&gt;初始化安装k8s集群的环境&lt;/h1&gt;&lt;h2 id=&quot;环境与注意事项&quot;&gt;&lt;a href=&quot;#环境</summary>
      
    
    
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="k8s" scheme="https://nikieuphoria.github.io/categories/%E6%8A%80%E6%9C%AF/k8s/"/>
    
    
    <category term="kubenates" scheme="https://nikieuphoria.github.io/tags/kubenates/"/>
    
    <category term="运维" scheme="https://nikieuphoria.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
  </entry>
  
  <entry>
    <title>001-a glass of Baileys</title>
    <link href="https://nikieuphoria.github.io/2025/05/06/001-a%20glass%20of%20Baileys/"/>
    <id>https://nikieuphoria.github.io/2025/05/06/001-a%20glass%20of%20Baileys/</id>
    <published>2025-05-05T16:00:00.000Z</published>
    <updated>2025-11-19T09:38:27.886Z</updated>
    
    <content type="html"><![CDATA[<p>The Labor Day holiday ended.<br>I was on a delayed flight  when I saw the news—she had passed away.<br>She chose to leave before summer even began.</p><p>The meaninglessness of work, of career, of life itself—and the grief of her death—<strong>haunt me.</strong></p><p>A line from a movie has been echoing in my head:</p><blockquote><p><em>Is life always this hard, or is it just when you’re a kid?</em><br><em>Always like this.</em></p></blockquote><p>I rewrote it into something that belongs to me now:</p><blockquote><p><em>Is work always this hard, or is it just because I’m in this place?</em></p></blockquote><p>I’ve been enduring.<br>Enduring the performance of working life.<br>Enduring the unspoken rule that <em>if you’re not exhausted, you’re not working hard enough.</em><br>I’m anxious. I’m overwhelmed. I’m becoming unrecognizable to myself.</p><p>And still, people keep telling me,</p><blockquote><p><em>“You’re already so lucky.”</em></p></blockquote><p>Just like the comments under Joan’s old videos:</p><blockquote><p><em>“You’re so beautiful, so talented, so brilliant.”</em></p></blockquote><p>But none of those words can save you.<br>They can’t protect you from the quiet truth that <strong>some of us simply can’t live in blurred, diluted versions of life.</strong><br>That clarity—too much of it—hurts.</p><p>Sometimes I wonder:<br>Is it naïve to still want growth, meaning, and selfhood through work?</p><p>I don’t know.</p><p>But I do know this:</p><p>This job, this system, this culture—<br>is not where my soul belongs.</p><p>Summer has come<br>And I want to drink a glass of Baileys </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;The Labor Day holiday ended.&lt;br&gt;I was on a delayed flight  when I saw the news—she had passed away.&lt;br&gt;She chose to leave before summer e</summary>
      
    
    
    
    <category term="flee as a bird to your mountain" scheme="https://nikieuphoria.github.io/categories/flee-as-a-bird-to-your-mountain/"/>
    
    
    <category term="life" scheme="https://nikieuphoria.github.io/tags/life/"/>
    
  </entry>
  
  <entry>
    <title>WSL-Windows Subsystem for Linux</title>
    <link href="https://nikieuphoria.github.io/2025/05/06/WSL/"/>
    <id>https://nikieuphoria.github.io/2025/05/06/WSL/</id>
    <published>2025-05-05T16:00:00.000Z</published>
    <updated>2025-08-05T06:28:08.429Z</updated>
    
    <content type="html"><![CDATA[<h1 id="WSL-Windows-Subsystem-for-Linux"><a href="#WSL-Windows-Subsystem-for-Linux" class="headerlink" title="WSL-Windows Subsystem for Linux"></a>WSL-Windows Subsystem for Linux</h1><h4 id="wsl是什么？"><a href="#wsl是什么？" class="headerlink" title="wsl是什么？"></a>wsl是什么？</h4><p>适用于Windows的Linux子系统，可以在windows下运行linux操作系统。</p><ol><li>轻量：不像虚拟机那样吃内存，不跑完整 Linux 系统，运行速度快，资源占用少</li><li>无缝：能和 Windows 系统共享文件、剪贴板、网络</li><li>无需虚拟机：不需要装 VMware、VirtualBox，也不用重启，直接在 Win 下跑 Linux</li><li>开发友好：支持绝大多数 Linux 工具链（如 apt、git、docker、conda 等），尤其适合开发者</li></ol><h4 id="wsl用来干什么"><a href="#wsl用来干什么" class="headerlink" title="wsl用来干什么"></a>wsl用来干什么</h4><h4 id="安装教程"><a href="#安装教程" class="headerlink" title="安装教程"></a>安装教程</h4><p><a href="https://blog.csdn.net/u011119817/article/details/130745551?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522ae299346a694700a68e917c31739a4f5%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=ae299346a694700a68e917c31739a4f5&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-130745551-null-null.142%5Ev102%5Epc_search_result_base3&utm_term=wsl%E5%AE%89%E8%A3%85&spm=1018.2226.3001.4187">windows11 安装WSL2全流程_wsl2安装-CSDN博客</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;WSL-Windows-Subsystem-for-Linux&quot;&gt;&lt;a href=&quot;#WSL-Windows-Subsystem-for-Linux&quot; class=&quot;headerlink&quot; title=&quot;WSL-Windows Subsystem for Linu</summary>
      
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="linux" scheme="https://nikieuphoria.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>git</title>
    <link href="https://nikieuphoria.github.io/2025/02/08/git-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/"/>
    <id>https://nikieuphoria.github.io/2025/02/08/git-%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6/</id>
    <published>2025-02-08T07:48:57.013Z</published>
    <updated>2025-05-07T02:38:47.016Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Git-是分布式版本控制系统。"><a href="#Git-是分布式版本控制系统。" class="headerlink" title="Git 是分布式版本控制系统。"></a>Git 是分布式版本控制系统。</h1><p><img src="/images/git.png" alt="Untitled"></p><h1 id="版本控制-Revision-control"><a href="#版本控制-Revision-control" class="headerlink" title="版本控制-Revision control"></a>版本控制-Revision control</h1><p>在开发的过程中用于管理我们对文件、目录或工程等内容的修改历史，方便查看更改历史记录，备份以便恢复以前的版本的软件工程技术。</p><p>主流的版本控制器有如下这些：</p><ul><li><strong>Git</strong></li><li><strong>SVN</strong>（Subversion）</li><li><strong>CVS</strong>（Concurrent Versions System）</li><li><strong>VSS</strong>（Micorosoft Visual SourceSafe）</li><li><strong>TFS</strong>（Team Foundation Server）</li><li>Visual Studio Online</li></ul><h2 id="版本控制分类"><a href="#版本控制分类" class="headerlink" title="版本控制分类"></a>版本控制分类</h2><h3 id="1、本地版本控制"><a href="#1、本地版本控制" class="headerlink" title="1、本地版本控制"></a><strong>1、本地版本控制</strong></h3><p>记录文件每次的更新，可以对每个版本做一个快照，或是记录补丁文件，适合个人用，如RCS。</p><p><a href="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0Dg3fHrbPqbNEOMO9GTjFhVaukMZWx54icS7eS2x8A7BEu0VB9ibwEhzQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png&#x2F;uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0Dg3fHrbPqbNEOMO9GTjFhVaukMZWx54icS7eS2x8A7BEu0VB9ibwEhzQ&#x2F;640?wx_fmt&#x3D;png&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p><h3 id="2、集中版本控制-SVN"><a href="#2、集中版本控制-SVN" class="headerlink" title="2、集中版本控制  SVN"></a><strong>2、集中版本控制  SVN</strong></h3><p>所有的版本数据都保存在服务器上，协同开发者从服务器上同步更新或上传自己的修改</p><p><a href="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p00V4uLaibxtZI9RLpq7tkSdlWiaF92AVeZ0ib9DicqBkS2poo5u8sEU2mCQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png&#x2F;uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p00V4uLaibxtZI9RLpq7tkSdlWiaF92AVeZ0ib9DicqBkS2poo5u8sEU2mCQ&#x2F;640?wx_fmt&#x3D;png&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p><p>所有的版本数据都存在服务器上，用户的本地只有自己以前所同步的版本，如果不连网的话，用户就看不到历史版本，也无法切换版本验证问题，或在不同分支工作。</p><p>而且，所有数据都保存在单一的服务器上，有很大的风险这个服务器会损坏，这样就会丢失所有的数据，当然可以定期备份。代表产品：SVN、CVS、VSS</p><h3 id="3、分布式版本控制-Git"><a href="#3、分布式版本控制-Git" class="headerlink" title="3、分布式版本控制 Git"></a><strong>3、分布式版本控制 Git</strong></h3><h3 id="服务器断网也可以开发，且每个客户端都保存着完整代码"><a href="#服务器断网也可以开发，且每个客户端都保存着完整代码" class="headerlink" title="服务器断网也可以开发，且每个客户端都保存着完整代码"></a>服务器断网也可以开发，且每个客户端都保存着完整代码</h3><p>每个人都拥有全部的代码！安全隐患！</p><p>所有版本信息仓库全部同步到本地的每个用户，这样就可以在本地查看所有版本历史，可以离线在本地提交，只需在连网时push到相应的服务器或其他用户那里。由于每个用户那里保存的都是所有的版本数据，只要有一个用户的设备没有问题就可以恢复所有的数据，但这增加了本地存储空间的占用。</p><p>不会因为服务器损坏或者网络问题，造成不能工作的情况！</p><p><a href="https://mmbiz.qpic.cn/mmbiz_png/uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0ev8Q7qXjsTfeSwFexdA4tGjFAiaVEKQzAHdGcINXILKflI2cfk9BiawQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1">https://mmbiz.qpic.cn/mmbiz_png&#x2F;uJDAUKrGC7Ksu8UlITwMlbX3kMGtZ9p0ev8Q7qXjsTfeSwFexdA4tGjFAiaVEKQzAHdGcINXILKflI2cfk9BiawQ&#x2F;640?wx_fmt&#x3D;png&amp;wxfrom&#x3D;5&amp;wx_lazy&#x3D;1&amp;wx_co&#x3D;1</a></p><h1 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a><strong>基本概念</strong></h1><h2 id="三个区域"><a href="#三个区域" class="headerlink" title="三个区域"></a>三个区域</h2><ul><li><p><strong>工作区（Working Directory或Workspace）</strong>：看到的目录，平时存放项目代码的地方</p></li><li><p><strong>暂存区（Stage&#x2F;Index）</strong>：英文名stage或者index，用于准备提交的文件区域。</p><ul><li>一般存放在**<code>.git</code>**目录下index文件中，所以也称为索引index</li></ul></li><li><p><strong>仓库（Repository或Git Directory）</strong>：用于存储项目的所有文件和历史记录。</p><ul><li>通常存储在项目根目录的 <strong><code>.git</code></strong> 子目录中。</li><li>其中**<code>HEAD</code>**指向最新放入仓库的版本</li></ul><p>  <img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/3afe2fdd-cad2-43f1-8adc-f1d3b699ee5c/627d280e-15d4-47b3-997b-8a0ec484a12d/Untitled.png" alt="Untitled"></p></li></ul><p>**远程的git仓库(Remote Directory)：**存储在远程服务器上的仓库副本，用于多人协作和备份。你可以使用 <strong><code>git push</code></strong> 命令将本地仓库的内容推送到远程仓库，也可以使用 <strong><code>git pull</code></strong> 命令从远程仓库拉取最新的更改。</p><h2 id="git-工作流程"><a href="#git-工作流程" class="headerlink" title="git 工作流程"></a>git <strong>工作流程</strong></h2><ul><li><p><strong>工作区 -&gt; 暂存区 -&gt; 本地仓库 -&gt; 远程仓库</strong></p></li><li><p>工作区：代码存放的位置。在工作区可以修改代码，且没有历史记录；</p></li><li><p>暂存区：将工作区的代码 添加(<code>git add</code>) 到暂存区，也可以修改代码并且没有历史记录；</p></li><li><p>本地库：将暂存区的代码提交 (<code>git commit</code>) 到本地库，就会生成历史版本。在本地库的版本不能修改。若发现代码不尽人意，只能在工作区修改后再次提交，此时本地库同时存在这两个版本。例如，先提交了 v1 版本，发现不好，则只能在 v1 版本基础上修改然后提交为 v2；</p></li><li><p>代码托管中心（远程库）：将本地库的代码推送 (<code>git push</code>) 至远程库。</p><p>  <img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/3afe2fdd-cad2-43f1-8adc-f1d3b699ee5c/108604d8-e083-4eee-87e5-aae75338e618/Untitled.png" alt="Untitled"></p></li></ul><p>文件在这四个区域之间的转换关系如下：</p><h2 id="git-文件状态"><a href="#git-文件状态" class="headerlink" title="git 文件状态"></a>git 文件状态</h2><p><strong>查看工作区的文件状态</strong><code>git status</code></p><ol><li><strong>未追踪（Untracked）</strong>：<ul><li>这是指在Git仓库中没有记录的文件。这些文件存在于工作区中，但尚未被添加到Git的版本控制中。</li></ul></li><li><strong>已暂存（Staged）</strong>：<ul><li>这是指将工作区中的文件添加到了暂存区（也叫索引）中，表示你打算在下一次提交中包括这些更改。</li></ul></li><li><strong>已修改（Modified）</strong>：<ul><li>这是指已经修改了某个文件，但尚未将这些更改添加到暂存区。</li></ul></li><li><strong>已提交（Committed）</strong>：<ul><li>这是指已经将文件的更改保存到了本地版本库中。</li></ul></li></ol><h2 id="git分支-Branch"><a href="#git分支-Branch" class="headerlink" title="git分支-Branch"></a>git<strong>分支-Branch</strong></h2><p>分支（Branch）是用来开发新功能或修复错误的独立工作流。它允许你将工作从主线（通常是**<code>master</code>**分支）中分离出来，以便不会影响到主线上的其他开发工作。</p><p>master主分支应该非常稳定，用来发布新版本，一般情况下不允许在上面工作</p><p>工作一般情况下在新建的dev分支上工作，dev分支代码稳定后可以合并到主分支master上来。</p><p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/3afe2fdd-cad2-43f1-8adc-f1d3b699ee5c/38ae47d3-468a-4d9a-9bda-71a05d71ccfa/Untitled.png" alt="Untitled"></p><p>多个分支：用户分支，测试分支，开发分支…… 不同分支互不干扰，可以同时推进，完成开发后就可以进行分支合并（在用户看来就是更新）。分支底层就是指针的引用。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 列出所有本地分支</span></span><br><span class="line">git branch</span><br><span class="line"><span class="comment">#这会列出所有可用的分支，并用一个**星号标记当前所在的分支**。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 列出所有远程分支</span></span><br><span class="line">git branch -r</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支</span></span><br><span class="line">git branch [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新建一个分支，并切换到该分支</span></span><br><span class="line">git checkout -b [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment">#切换分支</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 合并指定分支到当前分支</span></span><br><span class="line">$ git merge [branch]</span><br><span class="line"></span><br><span class="line"><span class="comment">#将dev分支合并到master分支</span></span><br><span class="line">git merge dev</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除分支</span></span><br><span class="line">$ git branch -d [branch-name]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除远程分支</span></span><br><span class="line">$ git push origin --delete [branch-name]</span><br><span class="line">$ git branch -dr [remote/branch]</span><br></pre></td></tr></table></figure><h2 id="解决冲突"><a href="#解决冲突" class="headerlink" title="解决冲突"></a><strong>解决冲突</strong></h2><ul><li>在合并分支时，如果Git无法自动合并，会产生冲突。需要手动解决冲突后再提交。</li></ul><h2 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h2><h3 id="创建仓库"><a href="#创建仓库" class="headerlink" title="创建仓库"></a>创建仓库</h3><ol><li><p>本地仓库搭建</p></li><li><p>克隆远程仓库：克隆远程目录，由于是将远程服务器上的仓库完全镜像一份至本地</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">1.初始化</span><br><span class="line"></span><br><span class="line">git init <span class="comment"># 初始化仓库</span></span><br><span class="line">git <span class="built_in">clone</span> <span class="comment"># 拷贝一份远程仓库，也就是下载一个项目</span></span><br><span class="line"></span><br><span class="line">git init --bare shell.git</span><br><span class="line">git init 是 Git 的一个命令，用于初始化一个新的 Git 仓库。</span><br><span class="line">--bare 是一个选项，它告诉 Git 创建一个裸仓库</span><br><span class="line">  也就是不包含工作区（Working Directory）的仓库。**裸仓库只包含版本历史记录。**</span><br><span class="line">shell.git 是你为新仓库选择的名称，实际上就是仓库的目录名。</span><br><span class="line"></span><br><span class="line">2.克隆</span><br><span class="line">git <span class="built_in">clone</span> &lt;https://github.com/repository.git&gt;</span><br><span class="line"><span class="comment">#URL克隆</span></span><br><span class="line">git <span class="built_in">clone</span> git@github.com:username/repository.git</span><br><span class="line"><span class="comment">#SSH协议来进行克隆</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="提交与修改"><a href="#提交与修改" class="headerlink" title="提交与修改"></a>提交与修改</h3><p>在工作区commit</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git add <span class="comment"># 添加文件到暂存区</span></span><br><span class="line">git status <span class="comment"># 查看仓库当前的状态，显示有变更的文件</span></span><br><span class="line"></span><br><span class="line">git diff <span class="comment"># 比较文件的不同，即暂存区和工作区的差异</span></span><br><span class="line"></span><br><span class="line">git commit -m <span class="string">&quot;commit message&quot;</span> <span class="comment"># 提交暂存区到本地仓库</span></span><br><span class="line"></span><br><span class="line">git reset <span class="comment"># 回退版本</span></span><br><span class="line">git <span class="built_in">rm</span> <span class="comment"># 删除工作区文件</span></span><br><span class="line">git <span class="built_in">mv</span> <span class="comment"># 移动或重命名工作区文件</span></span><br></pre></td></tr></table></figure><p>提交日志</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">log</span> <span class="comment"># 查看历史提交记录</span></span><br><span class="line">git blame&lt;file&gt; <span class="comment"># 以列表形式查看指定文件的历史修改记录</span></span><br><span class="line">远程操作</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;Git-是分布式版本控制系统。&quot;&gt;&lt;a href=&quot;#Git-是分布式版本控制系统。&quot; class=&quot;headerlink&quot; title=&quot;Git 是分布式版本控制系统。&quot;&gt;&lt;/a&gt;Git 是分布式版本控制系统。&lt;/h1&gt;&lt;p&gt;&lt;img src=&quot;/images/</summary>
      
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    
  </entry>
  
  <entry>
    <title>Linux 内核--Cgroup与namespace</title>
    <link href="https://nikieuphoria.github.io/2025/02/08/Linux%20%E5%86%85%E6%A0%B8--Cgroup%E4%B8%8Enamespace/"/>
    <id>https://nikieuphoria.github.io/2025/02/08/Linux%20%E5%86%85%E6%A0%B8--Cgroup%E4%B8%8Enamespace/</id>
    <published>2025-02-08T07:43:55.000Z</published>
    <updated>2025-05-07T02:38:58.078Z</updated>
    
    <content type="html"><![CDATA[<h2 id="容器-cgroup-namespace-rootfs-容器引擎"><a href="#容器-cgroup-namespace-rootfs-容器引擎" class="headerlink" title="容器 &#x3D; cgroup + namespace + rootfs + 容器引擎"></a>容器 &#x3D; cgroup + namespace + rootfs + 容器引擎</h2><p>容器的核心技术是 <strong>Cgroup</strong> + <strong>Namespace</strong></p><ul><li>​Cgroup： 资源控制 </li><li>​namespace： 访问隔离</li><li>​rootfs：文件系统隔离。镜像的本质就是一个rootfs文件</li><li>​容器引擎：生命周期控制</li></ul><p><strong>cgroup（控制组）和namespace（命名空间）</strong> 是 Linux 内核中的两个核心技术，主要用于实现<strong>资源管理</strong>和<strong>环境隔离</strong>，它们是容器技术（如 Docker）的底层基础。</p><hr><h3 id="cgroup（控制组）："><a href="#cgroup（控制组）：" class="headerlink" title="cgroup（控制组）："></a><strong>cgroup（控制组）：</strong></h3><p><strong>核心作用</strong>：<strong>限制、分配和监控进程的资源使用</strong>，比如 CPU、内存、磁盘 I&#x2F;O 等。</p><ul><li><strong>作用：</strong> 通过cgroup，系统管理员可以为一组进程分配资源，并限制它们对系统资源的使用。这对于实现资源隔离和管理是很有用的，特别是在容器化环境中，可以确保容器之间不会相互干扰，同时允许对资源进行有效的分配和控制。</li></ul><h3 id="namespace（命名空间）："><a href="#namespace（命名空间）：" class="headerlink" title="namespace（命名空间）："></a><strong>namespace（命名空间）：</strong></h3><p>命名空间是 Linux 内核提供的一种隔离机制，用于<strong>隔离</strong>容器的进程和文件系统等。</p><ul><li><strong>作用：</strong> 命名空间提供了一种隔离的手段，使得进程可以在一个独立的环境中运行，与其他命名空间中的进程隔离开。常用的命名空间包括 PID（进程 ID）、NET（网络）、UTS（主机名和域名）、IPC（进程间通信）、MNT（挂载点）等。在容器技术中，命名空间是实现容器隔离的基础，使得容器内的进程和资源与主机及其他容器隔离开。</li></ul><hr><h3 id="cgroup-vs-namespace-的区别"><a href="#cgroup-vs-namespace-的区别" class="headerlink" title="cgroup vs namespace 的区别"></a>cgroup vs namespace 的区别</h3><table><thead><tr><th><strong>特性</strong></th><th><strong>cgroup</strong></th><th><strong>namespace</strong></th></tr></thead><tbody><tr><td><strong>核心目标</strong></td><td>限制资源用量（如 CPU、内存）</td><td>隔离资源视图（如进程、网络）</td></tr><tr><td><strong>关注点</strong></td><td><strong>资源控制</strong></td><td><strong>环境隔离</strong></td></tr><tr><td><strong>类比</strong></td><td>给进程分配“资源配额”</td><td>给进程创造一个“独立房间”</td></tr></tbody></table>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;容器-cgroup-namespace-rootfs-容器引擎&quot;&gt;&lt;a href=&quot;#容器-cgroup-namespace-rootfs-容器引擎&quot; class=&quot;headerlink&quot; title=&quot;容器 &amp;#x3D; cgroup + namespace +</summary>
      
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/linux/"/>
    
    
    <category term="DevOps" scheme="https://nikieuphoria.github.io/tags/DevOps/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/tags/linux/"/>
    
    <category term="容器" scheme="https://nikieuphoria.github.io/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>SElinux-安全上下文</title>
    <link href="https://nikieuphoria.github.io/2025/01/21/SElinux-%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87/"/>
    <id>https://nikieuphoria.github.io/2025/01/21/SElinux-%E5%AE%89%E5%85%A8%E4%B8%8A%E4%B8%8B%E6%96%87/</id>
    <published>2025-01-21T08:59:08.643Z</published>
    <updated>2025-05-07T02:39:16.603Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SElinux-Security-Enhanced-Linux-安全增强型-linux"><a href="#SElinux-Security-Enhanced-Linux-安全增强型-linux" class="headerlink" title="SElinux-Security-Enhanced Linux 安全增强型 linux"></a>SElinux-Security-Enhanced Linux 安全增强型 linux</h2><p>Linux系统安全的强制访问控制体系</p><h3 id="三种配置模式"><a href="#三种配置模式" class="headerlink" title="三种配置模式"></a>三种配置模式</h3><ol><li>selinux的配置文件：&#x2F;etc&#x2F;sysconfig&#x2F;selinux</li></ol><table><thead><tr><th>状态</th><th>含义</th></tr></thead><tbody><tr><td>enforcing</td><td>级别为强制</td></tr><tr><td>permissive</td><td>级别为警告</td></tr><tr><td>disable</td><td>关闭</td></tr></tbody></table><ol start="2"><li>模式管理</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看当前工作模式</span></span><br><span class="line">[root@server ~]# getenforce</span><br><span class="line"></span><br><span class="line">[root@server ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line"><span class="comment"># 临时关闭进入宽容模式</span></span><br><span class="line">[root@server ~]# setenforce  0  </span><br><span class="line">[root@server ~]# getenforce</span><br><span class="line">Permissive</span><br><span class="line"> <span class="comment"># 临时开启</span></span><br><span class="line">[root@server ~]# setenforce  1 </span><br><span class="line">[root@server ~]# getenforce</span><br><span class="line">Enforcing</span><br><span class="line"></span><br><span class="line"><span class="comment">#永久性关闭</span></span><br><span class="line">[root@server ~]# vim  /etc/selinux/config </span><br><span class="line">SELINUX=disabled    </span><br></pre></td></tr></table></figure><p><code>注意</code>：enforceing与permissive二者可以直接进行切换，但是关闭selinux（disabled）进行切换时要重启reboot</p><h3 id="安全上下文（security-context）"><a href="#安全上下文（security-context）" class="headerlink" title="安全上下文（security context）"></a><strong>安全上下文（security context）</strong></h3><ul><li>所有进程、文件和目录都有自己的安全上下文</li><li>进程是否能够访问文件或目录，就要其安全上下文是否匹配</li></ul><p><strong>安全上下文用冒号分为四个字段：Identify：role：type：</strong></p><ul><li>身份标识（Identify）：相当于账号方面的身份标识，主要有以下三种常见的类型：<ul><li>root：表示root的账号身份；</li><li>system_u：表示程序方面的标识，通常就是进程</li><li>unconfined_u：代表的是一般用户账号相关的身份。</li></ul></li><li>角色（role）：通过角色字段，可知道这个数据是属于程序、文件资源还是代表用户。一般角色有：<ul><li>object_r：代表的是文件或目录等文件资源；</li><li>system_r：代表的是进程。</li></ul></li><li><strong>类型（type）：</strong><ul><li>type：在文件资源上面称为类型。</li><li>domain：在主体程序中则称为域。domain需要与type搭配，则该程序才能够顺利读取文件资源。</li></ul></li><li>最后一个字段是和MLS和MCS相关的东西，代表灵敏度，一般用s0、s1、s2来命名，数字代表灵敏度的分级。数值越大、灵敏度越高。</li></ul><p><strong>查看安全上下文</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -Z</span><br></pre></td></tr></table></figure><p><strong>chcon手动修改文件的SELinux类型</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chcon</span> [-R] [-t <span class="built_in">type</span>] [-u user] [-r role] 文件</span><br><span class="line"><span class="built_in">chcon</span> [-R] --reference=范例文件 文件</span><br><span class="line">选项：</span><br><span class="line">-R：连同该目录下的子目录也同时修改</span><br><span class="line">-t：后面接安全上下文的类型栏位，例如httpd_sys_content_t</span><br><span class="line">-u：后面接身份识别，例如system_u</span><br><span class="line">-r：后面接角色，例如 system_r</span><br><span class="line">-v：若有变化成功，请将变动的结果列出来</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>restorecon让文件恢复正确的SELinux类型</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">restorecon [-Rv] 文件目录</span><br><span class="line">选项：</span><br><span class="line">-R：连同子目录一起修改</span><br><span class="line">-v：将过程显示到屏幕</span><br></pre></td></tr></table></figure><p><strong>semanage默认目录的安全上下文查询与修改</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# yum -y install policycoreutils-python semanage</span><br><span class="line"></span><br><span class="line">semanage 选项 参数  文件</span><br><span class="line"></span><br><span class="line">选项：</span><br><span class="line">login</span><br><span class="line">user</span><br><span class="line">port</span><br><span class="line">interface</span><br><span class="line">fcontext  <span class="comment">#注意：fcontext查询默认安全上下文（重要）</span></span><br><span class="line">translation</span><br><span class="line">boolean</span><br><span class="line">参数：</span><br><span class="line"> -l :查询；</span><br><span class="line"> -a :添加</span><br><span class="line"> -m :修改</span><br><span class="line"> -d :删除</span><br><span class="line"> -t :类型</span><br><span class="line"> -r :角色</span><br><span class="line"> -s :用户</span><br><span class="line"> -f :文件</span><br><span class="line">文件：</span><br><span class="line">文件或目录</span><br><span class="line"></span><br><span class="line">semanage  fcontext  -l |  grep  文件名</span><br><span class="line">semanage  port  -l  |  grep  协议</span><br><span class="line">semanage port -a -t http_port_t  -p  tcp  7777 <span class="comment"># 添加新端口</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例1 查询一下/etc/  /etc/cron.d默认的SELinux类型是什么</span></span><br><span class="line">[root@chenshiren ~]# semanage  fcontext -l |grep -E <span class="string">&#x27;^/etc|^/etc/cron&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li><strong>实验1</strong></li></ul>]]></content>
    
    
    <summary type="html">&quot;Linux系统安全的强制访问控制体系&quot;</summary>
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/linux/"/>
    
    
    <category term="运维" scheme="https://nikieuphoria.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>文件系统与磁盘管理</title>
    <link href="https://nikieuphoria.github.io/2025/01/21/linux-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/"/>
    <id>https://nikieuphoria.github.io/2025/01/21/linux-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E4%B8%8E%E7%A3%81%E7%9B%98%E7%AE%A1%E7%90%86/</id>
    <published>2025-01-21T08:59:08.631Z</published>
    <updated>2025-05-07T02:39:09.625Z</updated>
    
    <content type="html"><![CDATA[<p><strong>disk -&gt; partition -&gt; PV -&gt; VG -&gt; LV -&gt; fs</strong></p><p><strong>磁盘-&gt;分区-&gt;物理卷-&gt;卷组-&gt;逻辑卷-&gt;文件系统。</strong><br>![[&#x2F;images&#x2F;disk.drawio.png]]</p><h4 id="文件系统-File-System"><a href="#文件系统-File-System" class="headerlink" title="文件系统 File System"></a>文件系统 <strong>File System</strong></h4><ol><li>EXT4：EXT4是Linux默认文件系统</li><li>XFS</li><li><strong>SWAP</strong>：交换文件系统，相当于虚拟内存</li></ol><h4 id="df"><a href="#df" class="headerlink" title="df"></a>df</h4><p>列出文件系统的整体磁盘使用量</p><p>df -h</p><h4 id="du"><a href="#du" class="headerlink" title="du"></a>du</h4><p>检查磁盘空间使用量</p><h4 id="lsblk"><a href="#lsblk" class="headerlink" title="lsblk"></a>lsblk</h4><ul><li>列出块设备的信息，包括磁盘和分区。它以树状结构显示</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列出当前系统所有磁盘与磁盘内的分区信息</span></span><br><span class="line">[root@master ~]# lsblk</span><br><span class="line">NAME              MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                 8:0    0   20G  0 disk</span><br><span class="line">├─sda1              8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2              8:2    0   19G  0 part</span><br><span class="line">  ├─centos-root   253:0    0   17G  0 lvm  /</span><br><span class="line">  └─centos-swap   253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sdb                 8:16   0  100G  0 disk</span><br><span class="line">├─datavg-data1_lv 253:2    0   45G  0 lvm</span><br><span class="line">└─datavg-data2_lv 253:3    0  200M  0 lvm</span><br><span class="line">sr0                11:0    1  9.5G  0 rom</span><br><span class="line"></span><br><span class="line"><span class="comment">#sda1：sd代表SCSI磁盘，a代表第一块磁盘，1代表第一个分区</span></span><br><span class="line"><span class="comment">#sdb：sd代表SCSI磁盘，b代表第二块磁盘，1代表第一个分区</span></span><br><span class="line"><span class="comment">#解释：</span></span><br><span class="line">NAME <span class="comment">#设备名称</span></span><br><span class="line">MAJ:MIN <span class="comment">#主设备号:次设备号，内核通过主次设备号识别磁盘</span></span><br><span class="line">RM <span class="comment">#是否为可卸载设备，1可卸载，0不可卸载</span></span><br><span class="line">SIZE <span class="comment">#设备的容量大小</span></span><br><span class="line">RO <span class="comment">#表示设备是否为只读，0非只读设备，1只读设备</span></span><br><span class="line">TYPE <span class="comment">#表示设备类型（disk为磁盘，part为分区，lvm逻辑卷，rom只读）</span></span><br><span class="line">MOUNTPOINT <span class="comment">#设备挂载点（SWAP没有挂载点）</span></span><br><span class="line"></span><br><span class="line">lsblk -f <span class="comment">##列出所有磁盘分区内使用的文件系统类型</span></span><br></pre></td></tr></table></figure><h2 id="磁盘分区"><a href="#磁盘分区" class="headerlink" title="磁盘分区"></a>磁盘分区</h2><ul><li>**分区过程：**添加新硬盘–分区–格式化文件系统–挂载使用</li></ul><h3 id="1-fdisk-磁盘分区"><a href="#1-fdisk-磁盘分区" class="headerlink" title="1.fdisk-磁盘分区"></a>1.fdisk-磁盘分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fdisk /dev/sdb</span><br><span class="line">**m <span class="comment">#获取命令帮助 ※**</span></span><br><span class="line">**p <span class="comment">#显示磁盘分区表 ※**</span></span><br><span class="line">**n <span class="comment">#新增加一个分区 ※**</span></span><br><span class="line">q <span class="comment">#不保存分区退出 ※</span></span><br><span class="line">d <span class="comment">#删除一个分区 ※</span></span><br><span class="line">**w <span class="comment">#保存分区退出 ※  记得保存**   </span></span><br><span class="line">a <span class="comment">#设置可引导标记</span></span><br><span class="line">b <span class="comment">#编辑bsd磁盘标签</span></span><br><span class="line">c <span class="comment">#设置DOS操作系统兼容标记</span></span><br><span class="line">l <span class="comment">#显示已知的文件系统类型，82为swap交换分区，83为Linux分区</span></span><br><span class="line">o <span class="comment">#建立空白DOS分区表</span></span><br><span class="line">s <span class="comment">#新建空白SUN磁盘标签</span></span><br><span class="line">t <span class="comment">#改变分区的系统ID</span></span><br><span class="line">u <span class="comment">#改变显示记录单位</span></span><br><span class="line">v <span class="comment">#验证分区表</span></span><br><span class="line">x <span class="comment">#附加功能</span></span><br></pre></td></tr></table></figure><ul><li><p>示例</p>  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# fdisk /dev/sdb   **#*对sdb进行分区***   </span><br><span class="line">Welcome to fdisk (util-linux 2.23.2).</span><br><span class="line"></span><br><span class="line">Changes will remain <span class="keyword">in</span> memory only, <span class="keyword">until</span> you decide to write them.</span><br><span class="line">Be careful before using the write <span class="built_in">command</span>.</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): n  **#增加分区**  </span><br><span class="line">Partition <span class="built_in">type</span>:</span><br><span class="line">   p   primary (2 primary, 0 extended, 2 free)</span><br><span class="line">   e   extended</span><br><span class="line">Select (default p):  <span class="comment">#**回车选择默认主分区**    </span></span><br><span class="line">Using default response p</span><br><span class="line">Partition number (2,4, default 2): 2   **#输入分区号为2**    </span><br><span class="line">First sector (4097-209715199, default 26624):  **#回车选择默认起始位置**   </span><br><span class="line">Using default value 26624</span><br><span class="line">Last sector, +sectors or +size&#123;K,M,G&#125; (26624-209715199, default 209715199): 409600</span><br><span class="line"><span class="comment">#**输入磁柱结束位置**  </span></span><br><span class="line">Partition 2 of <span class="built_in">type</span> Linux and of size 187 MiB is <span class="built_in">set</span></span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): </span><br><span class="line"></span><br><span class="line">Disk /dev/sdb: 107.4 GB, 107374182400 bytes, 209715200 sectors</span><br><span class="line">Units = sectors of 1 * 512 = 512 bytes</span><br><span class="line">Sector size (logical/physical): 512 bytes / 512 bytes</span><br><span class="line">I/O size (minimum/optimal): 512 bytes / 512 bytes</span><br><span class="line">Disk label <span class="built_in">type</span>: dos</span><br><span class="line">Disk identifier: 0xbf03ef25</span><br><span class="line"></span><br><span class="line">   Device Boot      Start         End      Blocks   Id  System</span><br><span class="line">/dev/sdb1            2048        4096        1024+  83  Linux</span><br><span class="line">/dev/sdb2           26624      409600      191488+  83  Linux</span><br><span class="line">/dev/sdb3            6144       24689        9273   83  Linux</span><br><span class="line"></span><br><span class="line">Partition table entries are not <span class="keyword">in</span> disk order</span><br><span class="line"></span><br><span class="line">Command (m <span class="keyword">for</span> <span class="built_in">help</span>): w   **#保存分区并退出**    </span><br><span class="line">The partition table has been altered!</span><br><span class="line"></span><br><span class="line">Calling ioctl() to re-read partition table.</span><br><span class="line">Syncing disks.</span><br><span class="line">[root@master ~]# lsblk   **#查看磁盘信息，sdb分区2已经创建**    </span><br><span class="line">NAME              MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sda                 8:0    0   20G  0 disk</span><br><span class="line">├─sda1              8:1    0    1G  0 part /boot</span><br><span class="line">└─sda2              8:2    0   19G  0 part</span><br><span class="line">  ├─centos-root   253:0    0   17G  0 lvm  /</span><br><span class="line">  └─centos-swap   253:1    0    2G  0 lvm  [SWAP]</span><br><span class="line">sdb                 8:16   0  100G  0 disk</span><br><span class="line">├─sdb1              8:17   0    1M  0 part</span><br><span class="line">├─sdb2              8:18   0  187M  0 part</span><br><span class="line">├─sdb3              8:19   0  9.1M  0 part</span><br><span class="line">├─datavg-data1_lv 253:2    0   45G  0 lvm</span><br><span class="line">└─datavg-data2_lv 253:3    0  200M  0 lvm</span><br><span class="line">sr0                11:0    1  9.5G  0 rom</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><h3 id="2-mkxfs格式化分区为文件系统"><a href="#2-mkxfs格式化分区为文件系统" class="headerlink" title="2.mkxfs格式化分区为文件系统"></a>2.mkxfs<strong>格式化分区为文件系统</strong></h3><ul><li>mkfs命令用于在分区上建立文件系统</li><li>常用文件系统类型：ext4，xfs</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkfs -t 文件系统格式 /dev/sdb1</span><br><span class="line">mkfs.文件格式 /dev/sdb1  </span><br></pre></td></tr></table></figure><h3 id="3-mount挂载分区"><a href="#3-mount挂载分区" class="headerlink" title="3.mount挂载分区"></a>3.mount挂载分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建挂载点目录</span></span><br><span class="line">[root@localhost ~]# <span class="built_in">mkdir</span> /mybak</span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载文件系统</span></span><br><span class="line">[root@localhost ~]# mount /dev/sdb1 /mybak</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看正在使用中的分区信息</span></span><br><span class="line">[root@localhost ~]# <span class="built_in">df</span> -Th</span><br></pre></td></tr></table></figure><h3 id="4-永久挂载"><a href="#4-永久挂载" class="headerlink" title="4.永久挂载"></a>4.永久挂载</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">5. **永久挂载：** 更新 /etc/fstab 文件，以确保在系统重新启动时分区会自动挂载</span><br><span class="line"></span><br><span class="line"><span class="comment">#开机自动挂载</span></span><br><span class="line">[root@localhost ~]# vim /etc/fstab</span><br><span class="line"></span><br><span class="line"><span class="comment">#末行 添加  </span></span><br><span class="line">/dev/sdc1 /mnt/sdc_drive ext4 defaults 0 0</span><br><span class="line"><span class="comment">#设备 挂载点 文件类型 defaults 0 0    </span></span><br></pre></td></tr></table></figure><h2 id="SWAP"><a href="#SWAP" class="headerlink" title="SWAP"></a>SWAP</h2><p>在物理内存空间不足时，可以将物理内存中的一些不重要数据拷贝到磁盘的 swap 分区中，从而让出内存空间，并且在需要那些已被拷出数据时再从 swap 分区中拷回到内存。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看内存及swap</span></span><br><span class="line">free</span><br><span class="line">free -h</span><br><span class="line">free -m</span><br></pre></td></tr></table></figure><h3 id="增加swap分区"><a href="#增加swap分区" class="headerlink" title="增加swap分区"></a>增加swap分区</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">**方法一**</span><br><span class="line"><span class="comment">#创建分区</span></span><br><span class="line">[root@node2 ~]# fdisk /dev/vdb</span><br><span class="line"><span class="comment">#格式化为文件系统</span></span><br><span class="line">[root@node2 ~]# mkswap /dev/vdb3</span><br><span class="line"><span class="comment">#保存设置使其永久生效</span></span><br><span class="line">[root@node2 ~]# vim /etc/fstab</span><br><span class="line">/dev/vdb3 swap swap defaults 0 0</span><br><span class="line"><span class="comment"># 激活SWAP文件</span></span><br><span class="line">swapon -a</span><br><span class="line"><span class="comment">#查看交换分区组成</span></span><br><span class="line">swapon -s</span><br><span class="line">free -h</span><br><span class="line"></span><br><span class="line">**方法二**</span><br><span class="line"><span class="comment"># 在根目录创建分区路径</span></span><br><span class="line">$ <span class="built_in">mkdir</span> -p /swap/</span><br><span class="line"><span class="comment"># 设置分区的大小</span></span><br><span class="line"><span class="comment"># bs=64M是块大小，count=64是块数量，所以swap空间大小是bs*count=4096MB=4GB</span></span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=/swap/swap0 bs=64M count=64</span><br><span class="line"><span class="comment"># 设置该目录权限</span></span><br><span class="line">$ <span class="built_in">chmod</span> 0600 /swap/swap0</span><br><span class="line"><span class="comment"># 创建SWAP文件</span></span><br><span class="line">$ mkswap /swap/swap0</span><br><span class="line"><span class="comment"># 激活SWAP文件</span></span><br><span class="line">$ swapon /swap/swap0</span><br><span class="line"><span class="comment"># 查看SWAP信息是否正确</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="LVM"><a href="#LVM" class="headerlink" title="LVM"></a>LVM</h2><table><thead><tr><th>PV</th><th>物理卷physical volume</th></tr></thead><tbody><tr><td>VG</td><td>卷组Volume Group</td></tr><tr><td>LV</td><td>逻辑卷logical volume</td></tr></tbody></table><p><img src="https://prod-files-secure.s3.us-west-2.amazonaws.com/3afe2fdd-cad2-43f1-8adc-f1d3b699ee5c/94a1f2ee-e740-44cf-bd2c-a6c21df5515a/image.png" alt="image.png"></p><h3 id="pv-物理卷"><a href="#pv-物理卷" class="headerlink" title="pv-物理卷"></a>pv-物理卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# pvcreate /dev/sdb1  /dev/sbd2</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看物理卷</span></span><br><span class="line">[root@newrain ~]# pvs</span><br></pre></td></tr></table></figure><h3 id="vg-卷组"><a href="#vg-卷组" class="headerlink" title="vg-卷组"></a>vg-卷组</h3><p>将创建好的物理卷组成卷组</p><p>直接创建卷组(系统会先将分区或磁盘创建为PV再创建卷组）</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vgcreate vg1 /dev/sdb1</span><br><span class="line"> Volume group <span class="string">&quot;vg1&quot;</span> successfully created</span><br><span class="line">  </span><br><span class="line"> vgcreate -s [PE大小] </span><br><span class="line">  </span><br><span class="line">[root@localhost ~]# vgs</span><br></pre></td></tr></table></figure><h3 id="lv-逻辑卷"><a href="#lv-逻辑卷" class="headerlink" title="lv-逻辑卷"></a>lv-逻辑卷</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">#创建逻辑卷</span></span><br><span class="line">[root@localhost ~]# lvcreate -L 10G -n mylv vg1</span><br><span class="line">Logical volume <span class="string">&quot;mylv&quot;</span> created.</span><br><span class="line"></span><br><span class="line">-L：指定逻辑卷的大小，如 -L 10G 表示 10GB。</span><br><span class="line">-l [PE个数] PE物理拓展块</span><br><span class="line"></span><br><span class="line">查看逻辑卷信息：</span><br><span class="line">lvs       //显示有关逻辑卷的信息</span><br><span class="line">lvscan     //扫描并显示LVM逻辑卷</span><br><span class="line">lvdisplay   //显示LVM逻辑卷属性</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="格式化并挂载使用"><a href="#格式化并挂载使用" class="headerlink" title="格式化并挂载使用"></a><strong>格式化并挂载使用</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#格式化文件系统</span></span><br><span class="line">[root@localhost ~]# mkfs.xfs /dev/vg1/mylv</span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载使用</span></span><br><span class="line">[root@localhost ~]# <span class="built_in">mkdir</span> /mount</span><br><span class="line">[root@localhost ~]# mount /dev/vg1/mylv /mount</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="拓展空间"><a href="#拓展空间" class="headerlink" title="拓展空间"></a>拓展空间</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#拓展卷组  </span></span><br><span class="line">[root@localhost ~]# vgextend vg1 /dev/sdb5 </span><br><span class="line"></span><br><span class="line"><span class="comment">#扩容逻辑卷</span></span><br><span class="line">[root@localhost ~]# lvextend -L +9G /dev/vg1/mylv</span><br><span class="line"></span><br><span class="line">扩展文件系统：当逻辑卷扩大以后，也需要对逻辑卷的文件系统进行扩展</span><br><span class="line">扩展文件系统容量：</span><br><span class="line">xfs_growfs <span class="comment">#用于扩容XFS设备</span></span><br><span class="line">resize2fs <span class="comment">#用于扩容EXT3/EXT4设备</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#扩展文件系统</span></span><br><span class="line"> xfs_growfs /dbbak</span><br><span class="line"> resize2fs /dev/myvol/vo</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&quot;FS文件系统与磁盘管理&quot;</summary>
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/linux/"/>
    
    
    <category term="linux" scheme="https://nikieuphoria.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>linux-文件的访问控制列表facl</title>
    <link href="https://nikieuphoria.github.io/2025/01/21/%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8facl/"/>
    <id>https://nikieuphoria.github.io/2025/01/21/%E6%96%87%E4%BB%B6%E7%9A%84%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6%E5%88%97%E8%A1%A8facl/</id>
    <published>2025-01-21T08:59:08.627Z</published>
    <updated>2025-05-07T09:52:42.995Z</updated>
    
    <content type="html"><![CDATA[<p><code>setfacl</code>工具： 设置和修改文件或目录的访问控制列表（ACLs）的命令行工具。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setfacl -m option:name[:permission] file</span><br></pre></td></tr></table></figure><ul><li><code>-m</code> 表示修改现有的 ACL 条目。</li><li><code>option</code> 可以是 <code>u</code>（用户）、<code>g</code>（组）、<code>o</code>（其他）、<code>d</code>（默认）、<code>-</code>（掩码，用于限制通过 ACL 授予的权限）。</li><li><code>name</code> 是用户或组的名称。</li><li><code>permission</code> 是逗号分隔的权限列表，可以是 <code>r</code>（读）、<code>w</code>（写）、<code>x</code>（执行）、<code>R</code>（读，但不允许执行）、<code>W</code>（写，但不允许执行）、<code>X</code>（执行，但不允许写）。</li></ul>]]></content>
    
    
    <summary type="html">&quot;更细粒度地控制文件和目录的访问权限&quot;</summary>
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/linux/"/>
    
    
    <category term="linux" scheme="https://nikieuphoria.github.io/tags/linux/"/>
    
  </entry>
  
  <entry>
    <title>ansible</title>
    <link href="https://nikieuphoria.github.io/2024/10/30/ansible/"/>
    <id>https://nikieuphoria.github.io/2024/10/30/ansible/</id>
    <published>2024-10-30T06:47:12.000Z</published>
    <updated>2025-11-17T07:02:17.224Z</updated>
    
    <content type="html"><![CDATA[<h1 id="一、安装与配置"><a href="#一、安装与配置" class="headerlink" title="一、安装与配置"></a><span style>一、安装与配置</span></h1><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1.安装"></a>1.安装</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#yum安装</span></span><br><span class="line">yum install epel-release -y</span><br><span class="line">yum install ansible –y</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看ansible版本</span></span><br><span class="line">ansible --version</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-管理节点与被管理节点建⽴SSH信任关系"><a href="#2-管理节点与被管理节点建⽴SSH信任关系" class="headerlink" title="2.管理节点与被管理节点建⽴SSH信任关系"></a>2.管理节点与被管理节点建⽴SSH信任关系</h2><pre><code>2.1.生成私钥[root@server ~]# ssh-keygen   2.2.向主机分发私钥[root@server ~]# ssh-copy-id root@192.168.37.122[root@server ~]# ssh-copy-id root@192.168.37.133</code></pre><h2 id="3-ansible配置文件"><a href="#3-ansible配置文件" class="headerlink" title="3. ansible配置文件"></a>3. ansible配置文件</h2><p>修改配置文件，创建主机清单文件 ：写在[]里的是组名，[ ]下面的是组内的主机名<br>[root@server ~]# vim &#x2F;etc&#x2F;ansible&#x2F;hosts<br>[web]<br>192.168.37.122<br>192.168.37.133</p><h1 id="二、核心组件"><a href="#二、核心组件" class="headerlink" title="二、核心组件"></a>二、核心组件</h1><p>主机清单（Inventory）<br>模块（Modules）<br>任务（Tasks）和剧本（Playbooks）<br>角色（Roles）</p><h1 id="三、ansible-doc-命令行模块"><a href="#三、ansible-doc-命令行模块" class="headerlink" title=" 三、ansible-doc 命令行模块"></a><span style> 三、ansible-doc 命令行模块</span></h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ansible &lt;ip组&gt; -m &lt;模块&gt; -a &lt;argument参数&gt; [options]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ansible dev,<span class="built_in">test</span>,prod -a <span class="string">&#x27;getenforce&#x27;</span> </span><br></pre></td></tr></table></figure><p>命令的工作目录默认是远程用户的主目录（~），command 模块不会保留shell的环境状态（包括当前工作目录）</p><p> ansible-doc -l  #列出当前系统中ansible的所有模块<br>ansible-doc  -s  模块名   #查看模块的参数<br>ansible-doc  模块名   #查看模块的详细信息包括用法</p><h3 id="1-ping模块"><a href="#1-ping模块" class="headerlink" title="1.ping模块"></a>1.ping模块</h3><p><code>ansible all -m ping</code></p><h3 id="2-command模块"><a href="#2-command模块" class="headerlink" title="2.command模块"></a>2.command模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chdir=/etc/sysconfig  ---执行命令前先切换到指定目录</span><br><span class="line">creates=/doc/1.txt：判断指定文件是否存在，如果存在，不执行后面的操作</span><br><span class="line">removes：判断指定文件是否存在，如果存在，执行后面的操作</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>注意，该命令不支持&#x3D;&#x3D;<code>| 管道命令</code>&#x3D;&#x3D;。</li></ul><p><code>ansible all -m command -a ‘removes=/etc/sysconfig/network-scripts/ifcfg-ens33 ip addr ’</code></p><h3 id="3-shell模块"><a href="#3-shell模块" class="headerlink" title="3.shell模块"></a>3.shell模块</h3><p>ansible all -m shell -a ‘echo “niki_ansible” |cat &gt;&gt;1.txt&#96;</p><p>ansible webservers -m shell -a ‘ifconfig | grep ens33’</p><p>ansible webservers -m shell -a ‘ifconfig &gt; &#x2F;opt&#x2F;kx.txt’</p><h3 id="4-file模块"><a href="#4-file模块" class="headerlink" title="4.file模块"></a>4.file模块</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">state　　#状态，有以下选项：</span><br><span class="line"></span><br><span class="line">directory：如果目录不存在，就创建目录</span><br><span class="line">file：文件不存在，不会被创建</span><br><span class="line">touch：文件不存在，创建新文件，如果文件或目录已存在，则更新其最后修改时间</span><br><span class="line">absent：删除目录、文件或者取消链接文件</span><br><span class="line">link：创建软链接，hard：创建硬链接</span><br></pre></td></tr></table></figure><p><code>ansible web -m file -a &#39;path=/data/app state=directory’</code>   创建目录</p><p><code>ansible web -m file -a &#39;path=/data/a state=absent’</code>      删除文件</p><p><code>ansible dbservers -m file -a &#39; group=root mode=644 path=/opt/host_ansible&#39;</code> #修改文件的属主属组权限等</p><h3 id="5-copy模块-将文件复制到远程主机"><a href="#5-copy模块-将文件复制到远程主机" class="headerlink" title="5.copy模块-将文件复制到远程主机"></a>5.copy模块-将文件复制到远程主机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">src　　　　<span class="comment">#被复制到远程主机的本地文件。可以是绝对路径，也可以是相对路径。如果路径是一个目录，则会递归复制，用法类似于&quot;rsync&quot;</span></span><br><span class="line">content　　　<span class="comment">#用于替换&quot;src&quot;，可以直接指定文件的值</span></span><br><span class="line">dest　　　　<span class="comment">#必选项，将源文件复制到的远程主机的绝对路径</span></span><br><span class="line">backup　　　<span class="comment">#当文件内容发生改变后，在覆盖之前把源文件备份，备份文件包含时间信息</span></span><br><span class="line">directory_mode　　　　<span class="comment">#递归设定目录的权限，默认为系统默认权限</span></span><br></pre></td></tr></table></figure><p> <code>ansible web -m copy -a &#39;src=~/hello dest=/data/hello&#39;</code> </p><p><code>ansible web -m copy -a &#39;content=&quot;I am keer\n&quot; dest=/data/name mode=666’</code></p><h3 id="6-fetch-模块-从远程主机获取文件到本地"><a href="#6-fetch-模块-从远程主机获取文件到本地" class="headerlink" title="6.fetch 模块-从远程主机获取文件到本地"></a>6.<strong>fetch 模块-从远程主机获取文件到本地</strong></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dest：用来存放文件的目录</span><br><span class="line">src：在远程拉取的文件，**并且必须是一个file**，不能是目录</span><br></pre></td></tr></table></figure><p><code>ansible web -m fetch -a &#39;src=/data/hello dest=/data&#39;</code>  </p><h3 id="7-yum-apt-模块"><a href="#7-yum-apt-模块" class="headerlink" title="7.yum&#x2F;apt 模块"></a>7.<strong>yum&#x2F;apt 模块</strong></h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">name：要管理的包名</span></span><br><span class="line"><span class="string">state：#present---&gt;安装</span> <span class="string">latest---&gt;安装最新的,</span> <span class="string">absent---&gt;</span> <span class="string">卸载软件。</span></span><br></pre></td></tr></table></figure><hr><h3 id="8-service-模块"><a href="#8-service-模块" class="headerlink" title="8. service 模块"></a>8. service 模块</h3><p>　　该模块用于服务程序的管理。<br>　　其主要选项如下：</p><blockquote><p><code>arguments</code> #命令行提供额外的参数<br><code>enabled</code> #设置开机启动。<br><code>name=</code> #服务名称<br><code>runlevel</code> #开机启动的级别，一般不用指定。<br><code>sleep</code> #在重启服务的过程中，是否等待。如在服务关闭以后等待2秒再启动。(定义在剧本中。)<br><code>state</code> #有四种状态，分别为：<code>started</code>—&gt;启动服务， <code>stopped</code>—&gt;停止服务， <code>restarted</code>—&gt;重启服务， <code>reloaded</code>—&gt;重载配置</p></blockquote><p>　　下面是一些例子：<br><strong>① 开启服务并设置自启动</strong></p><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="meta">@server</span> ~]# ansible web -m service -a <span class="string">&#x27;name=nginx state=started enabled=true&#x27;</span> </span><br><span class="line"><span class="number">192.168</span>.<span class="number">37.122</span> | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="keyword">true</span>, </span><br><span class="line">    <span class="string">&quot;enabled&quot;</span>: <span class="keyword">true</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;nginx&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;started&quot;</span>, </span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">192.168</span>.<span class="number">37.133</span> | SUCCESS =&gt; &#123;</span><br><span class="line">    <span class="string">&quot;changed&quot;</span>: <span class="keyword">true</span>, </span><br><span class="line">    <span class="string">&quot;enabled&quot;</span>: <span class="keyword">true</span>, </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;nginx&quot;</span>, </span><br><span class="line">    <span class="string">&quot;state&quot;</span>: <span class="string">&quot;started&quot;</span>, </span><br><span class="line">    ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="firewalld-模块"><a href="#firewalld-模块" class="headerlink" title="firewalld 模块"></a>firewalld 模块</h2><p>一个动态防火墙管理工具<br><strong>1. <strong>state</strong>：设置规则的状态。<br>    - <code>enabled</code>：启用规则。<br>    - <code>disabled</code>：禁用规则。<br>2. <strong>permanent</strong>：设置规则是否永久生效。<br>    - <code>yes</code>：规则永久生效，重启后依然有效。<br>    - <code>no</code>：规则临时生效，重启后失效。<br>3. <strong>immediate</strong>：是否立即应用规则变更。<br>    - <code>yes</code>：立即应用规则变更。<br>    - <code>no</code>：规则变更将在下一次 <code>firewalld</code> 重启时生效。<br>4. <strong>service</strong>：指定要允许或拒绝的服务名称，例如 <code>http</code>、<code>https</code>、<code>ssh</code> 等。<br>5. <strong>port</strong>：指定要允许或拒绝的端口，可以是单个端口（如 <code>8080/tcp</code>）或端口范围（如 <code>1024-2048/tcp</code>）。</strong></p><pre><code><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#启动 firewalld 服务**：</span><br><span class="line">- name: Start firewalld service</span><br><span class="line">  ansible.builtin.firewalld:</span><br><span class="line">    state: started</span><br><span class="line">    enabled： yes</span><br><span class="line">    </span><br><span class="line">#添加允许规则：</span><br><span class="line">- name: Open port <span class="number">80</span> <span class="keyword">in</span> firewalld</span><br><span class="line">  ansible.builtin.firewalld:</span><br><span class="line">    service: http</span><br><span class="line">    permanent: yes</span><br><span class="line">    state: enabled</span><br><span class="line">    immediate: yes</span><br></pre></td></tr></table></figure></code></pre><h2 id="Setup模块"><a href="#Setup模块" class="headerlink" title="Setup模块"></a>Setup模块</h2><p>使用<strong>setup模块</strong>获取被管理主机的所有facts信息，可以使用filter来查看指定的信息。setup模块获取的整个facts信息被包装在一个JSON格式的数据结构中，ansible_facts是最外层的值。我们可以通过以下Ansible Ad-Hoc命令查看facts信息：</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible all -m setup | grep hostname</span><br><span class="line"></span><br><span class="line"> ansible all -m setup -a &#x27;filter=&quot;ansible_nodename&quot;&#x27;   </span><br></pre></td></tr></table></figure><h1 id="四、playbook-剧本"><a href="#四、playbook-剧本" class="headerlink" title="四、playbook-剧本"></a>四、playbook-剧本</h1><h3 id="playbook格式"><a href="#playbook格式" class="headerlink" title="playbook格式"></a>playbook格式</h3><p><strong>playbook 是 ansible 用于配置，部署，和管理被控节点的剧本。</strong><code>类似于脚本</code></p><ol><li><code>-</code>和<code>:</code>后必须<font color="#ff0000">空一格</font></li><li>大小写敏感,使用缩进表示层级关系</li><li>缩进时不允许使用tab键、只允许使用空格</li><li>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</li><li><strong>任务列表</strong>：每个任务前使用<code>-</code> 表示一个新的任务。</li></ol><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---   </span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">playbook</span>  </span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">web：test</span>  <span class="comment"># 指定此 Play 将在哪些主机上运行</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">tasks:</span>  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">connect</span> <span class="string">test</span>  </span><br><span class="line">      <span class="attr">ping:</span>    </span><br><span class="line">  </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">new</span> <span class="string">file</span>  </span><br><span class="line">      <span class="attr">file:</span> </span><br><span class="line">        <span class="attr">group:</span> <span class="string">root</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="number">744</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/niki1/file1</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">touch</span> </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="comment">#以上为普通形式，行数较多，但更容易操作。任务的关键字垂直堆叠，更容易区分。</span></span><br><span class="line">    <span class="comment">#以下可以运行但不推荐</span></span><br><span class="line">    <span class="attr">tasks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">shorthand</span> <span class="string">form</span></span><br><span class="line">        <span class="attr">service:</span> <span class="string">name=httpd</span> <span class="string">enabled=true</span> <span class="string">state=started</span></span><br><span class="line">        </span><br></pre></td></tr></table></figure><h3 id="运行剧本"><a href="#运行剧本" class="headerlink" title="运行剧本"></a>运行剧本</h3><p>空运行 <code>ansible-playbook -C pb.yml</code></p><p>直接运行 <code>ansible-playbook pb.yml</code></p><p>语法验证 <strong><code>ansible-playbook --syntax-check pb.yml</code></strong></p><p>指定从某个task开始运行<code>ansible-playbook pb.yml --start-at-task=&#39;xxx&#39;</code>  </p><p><font color="#00b050">| 绿色代表执行成功，系统保持原样</font></p><p><font color="#ffff00">| 黄色代表系统代表系统状态发生改变</font></p><p><font color="#ff0000">| 红色代表执行失败，显示错误输出</font></p><h4 id="ansible-navigator容器中运行剧本"><a href="#ansible-navigator容器中运行剧本" class="headerlink" title="ansible-navigator容器中运行剧本"></a>ansible-navigator容器中运行剧本</h4><p>ansible-navigator 利用容器化的执行环境，用于与 Ansible Playbooks、Roles、Collections 等交互。<br>ansible-navigator run playbook.yml <span style="background:rgba(173, 239, 239, 0.55)">-m stdout</span><br>-<code>-m stdout</code>：这个选项指定输出模式为 <code>stdout</code>，即将执行结果输出到标准输出（终端），而不是使用交互式界面。</p><h3 id="Handler-notify-触发器"><a href="#Handler-notify-触发器" class="headerlink" title="Handler+notify-触发器"></a><strong>Handler+notify-触发器</strong></h3><p>在特定条件下触发；接收到其它任务的通知<code>notify</code>时被触发</p><p>Handlers 最佳的应用场景是用来重启服务,或者触发系统重启操作.除此以外很少用到了.</p><h3 id="Tag-标签"><a href="#Tag-标签" class="headerlink" title="Tag-标签"></a>Tag-标签</h3><p>为tasks或play添加标记，选择性地执行playbook的特定部分。</p><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><p>如果命令或脚本的退出码不为零，可以使用如下方式替代</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line">  <span class="string">-name:</span> <span class="string">run</span> <span class="string">this</span> <span class="string">command</span> <span class="string">and</span> <span class="string">ignore</span> <span class="string">the</span> <span class="string">result</span></span><br><span class="line">   <span class="attr">shell:</span> <span class="string">/usr/bin/somecommand</span> <span class="string">||</span> <span class="string">/bin/true</span></span><br><span class="line"><span class="string">转错为正</span> <span class="string">如果命令失败则执行</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="string">或者使用ignore_errors来忽略错误信息</span></span><br><span class="line"><span class="attr">tasks:</span></span><br><span class="line"><span class="string">-name:</span> <span class="string">run</span> <span class="string">this</span> <span class="string">command</span> <span class="string">and</span> <span class="string">ignore</span> <span class="string">the</span> <span class="string">result</span></span><br><span class="line"> <span class="attr">shell:</span> <span class="string">/usr/bin/somecommand</span></span><br><span class="line"> <span class="attr">ignore_errors:</span> <span class="literal">True</span> <span class="string">忽略错误</span></span><br></pre></td></tr></table></figure><h3 id="Variable-变量"><a href="#Variable-变量" class="headerlink" title="Variable-变量"></a><strong>Variable-变量</strong></h3><p>变量名：仅能由字母、数字和下划线组成，且只能以字母开头<br>变量定义：直接定义  key&#x3D;value<br>根据变量的作⽤范围⼤体的将变量分为:</p><pre><code>全局变量剧本变量资产变量内置变量:内置变量⼏乎都是以 ansible_ 为前缀。系统自带事实变量facts：ansible setup模块   </code></pre><p>  ansible all -m setup -a ‘filter&#x3D;”ansible_nodename”‘     #查询主机名</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">.系统自带事实变量facts：ansible</span> <span class="string">setup模块</span>   </span><br><span class="line">  <span class="string">ansible</span> <span class="string">all</span> <span class="string">-m</span> <span class="string">setup</span> <span class="string">-a</span> <span class="string">&#x27;filter=&quot;ansible_nodename&quot;&#x27;</span>     <span class="comment">#查询主机名</span></span><br><span class="line">  </span><br><span class="line"><span class="number">2</span><span class="string">./etc/ansible/hosts(主机清单)中定义变量</span></span><br><span class="line"></span><br><span class="line"><span class="number">3</span><span class="string">.在playbook中定义</span></span><br><span class="line">       <span class="attr">vars:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">var1:</span> <span class="string">value1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">var2:</span> <span class="string">value2</span></span><br><span class="line"></span><br><span class="line"><span class="number">4</span><span class="string">.在独立的变量YAML文件中定义</span></span><br><span class="line"><span class="string">vim</span> <span class="string">vars.yml</span></span><br><span class="line"><span class="attr">pack:</span> <span class="string">vsftpd</span></span><br><span class="line"><span class="attr">service:</span> <span class="string">vsftpd</span></span><br><span class="line"></span><br><span class="line"><span class="string">引用变量文件</span></span><br><span class="line"><span class="attr">vars_files:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">vars.yml</span></span><br><span class="line">  </span><br></pre></td></tr></table></figure><p>变量调用：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">通过&#123;&#123;</span> <span class="string">variable_name</span> <span class="string">&#125;&#125;</span> <span class="string">调用变量</span></span><br><span class="line"><span class="string">通过-e指定</span>  </span><br><span class="line"><span class="string">ansible-playbook</span> <span class="string">test.yml</span> <span class="string">-e</span> <span class="string">&quot;hosts=123&quot;</span></span><br></pre></td></tr></table></figure><h3 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#调用变量文件   </span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">vars_log</span> <span class="string">file</span></span><br><span class="line">  <span class="attr">vars_files:</span></span><br><span class="line">     <span class="bullet">-</span> <span class="string">/niki2/vars.yml</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">new</span> <span class="string">file</span></span><br><span class="line">      <span class="attr">file:</span></span><br><span class="line">         <span class="attr">path:</span> <span class="string">/niki1/&#123;&#123;</span> <span class="string">name1</span> <span class="string">&#125;&#125;_log.txt</span></span><br><span class="line">         <span class="attr">mode:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; mode1 &#125;&#125;</span>&quot;</span></span><br><span class="line">         <span class="attr">state:</span> <span class="string">touch</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="Template-模板"><a href="#Template-模板" class="headerlink" title="Template-模板"></a><strong>Template-模板</strong></h3><p>根据模板文件<strong>动态</strong>生成对应的配置文件，命名必须以 <strong>.j2</strong> 结尾（<code>Jinja2</code>：Jinja2是python的一种模板语言）</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">install</span> <span class="string">nginx</span>  <span class="comment">#安装nginx，若为centos7需要启用 EPEL 仓库</span></span><br><span class="line">      <span class="attr">yum:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">copy</span> <span class="string">template</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">src:</span> <span class="string">/etc/ansible/templates/nginx.conf.j2</span> </span><br><span class="line">        <span class="comment">#nginx.conf.j2模板设置worker_processes 的值为   &#123;&#123; ansible_processor_vcpus*2&#125;&#125;;</span></span><br><span class="line">        <span class="attr">dest:</span> <span class="string">/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="attr">notify:</span> <span class="string">restart</span> <span class="string">service</span></span><br><span class="line">      </span><br><span class="line">     </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">service</span> <span class="string">start</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">started</span></span><br><span class="line">        <span class="attr">enabled:</span> <span class="literal">yes</span> <span class="comment">#开机自启</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">service</span></span><br><span class="line">      <span class="attr">service:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">restarted</span></span><br></pre></td></tr></table></figure><h3 id="条件测试when与循环迭代-with-items"><a href="#条件测试when与循环迭代-with-items" class="headerlink" title="条件测试when与循环迭代  with_items"></a>条件测试when与循环迭代  with_items</h3><ul><li><p>when语句：在task中使用</p></li><li><p>循环：迭代，需要重复执行的任务；</p><p>  对迭代项的引用，固定变量名为”item”，而后，要在task中使用with_items给定要迭代的元素列表；</p></li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">groups</span></span><br><span class="line">      <span class="attr">group:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">with_items:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">group1</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">group2</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">group3</span></span><br><span class="line"></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">add</span> <span class="string">users</span></span><br><span class="line">      <span class="attr">user:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.name &#125;&#125;</span>&quot;</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123; item.group &#125;&#125;</span>&quot;</span></span><br><span class="line">      <span class="attr">with_items:</span></span><br><span class="line">        <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">&#x27;u1&#x27;</span>,<span class="attr">group:</span> <span class="string">&#x27;group1&#x27;</span>&#125;</span><br><span class="line">        <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">&#x27;u2&#x27;</span>,<span class="attr">group:</span> <span class="string">&#x27;group2&#x27;</span>&#125;</span><br><span class="line">        <span class="bullet">-</span> &#123;<span class="attr">name:</span> <span class="string">&#x27;u3&#x27;</span>,<span class="attr">group:</span> <span class="string">&#x27;group3&#x27;</span>&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="五、roles-角色"><a href="#五、roles-角色" class="headerlink" title="五、roles-角色"></a>五、roles-角色</h1><p>用于<strong>层次性，结构化</strong>地组织playbook<br>roles通过分别将变量(vars)、文件(file)、任务(tasks)、模块(modules)及处理器(handlers)放置于单独的目录中，并可以便捷地include它们的一种机制。角色一般用于基于主机构建服务的场景中，但也可以是用于构建守护进程等场景中。 </p><h3 id="创建role"><a href="#创建role" class="headerlink" title="创建role"></a>创建role</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ansible-galaxy init my_role</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="安装roels"><a href="#安装roels" class="headerlink" title="安装roels"></a>安装roels</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">直接从galaxy安装</span></span><br><span class="line">ansible-galaxy install &lt;role_name&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">从 requirements.yml 文件安装多个角色</span></span><br><span class="line">vim requirements.yml</span><br><span class="line"></span><br><span class="line">- src: geerlingguy.apache</span><br><span class="line">- src: geerlingguy.mysql</span><br><span class="line">- </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装</span></span><br><span class="line">ansible-galaxy install -r requirements.yml</span><br><span class="line">---</span><br><span class="line"> - name: webservers role</span><br><span class="line">   hosts: webservers</span><br><span class="line">   roles:</span><br><span class="line"> - apache</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="六、collection-集合"><a href="#六、collection-集合" class="headerlink" title="六、collection-集合"></a>六、collection-集合</h1><p>Collection 是一个更高级的封装，包含多个 Roles、模块、插件等，允许用户更全面地共享和分发自动化内容。它可以包含多个功能模块，适用于更复杂的项目。</p><h2 id="如何使用-Ansible-Collections"><a href="#如何使用-Ansible-Collections" class="headerlink" title="如何使用 Ansible Collections"></a>如何使用 Ansible Collections</h2><h3 id="1、安装-Collection"><a href="#1、安装-Collection" class="headerlink" title="1、安装 Collection"></a>1、安装 Collection</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">可以从 Ansible Galaxy 或其他来源安装 Collection：</span></span><br><span class="line">ansible-galaxy collection install &lt;namespace&gt;.&lt;collection_name&gt;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">也可以从本地目录或通过 requirements.yml 文件安装collection：</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2、Playbook-中使用-Collection"><a href="#2、Playbook-中使用-Collection" class="headerlink" title="2、Playbook 中使用 Collection"></a>2、Playbook 中使用 Collection</h3><p>在你的 playbook.yml 文件中，你可以指定要使用的 Collection：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">Playbook</span></span><br><span class="line">  <span class="attr">hosts:</span> <span class="string">all</span></span><br><span class="line">  <span class="attr">collections:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">my_namespace.my_collection</span></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Example</span> <span class="string">task</span></span><br><span class="line">      <span class="attr">my_namespace.my_collection.my_module:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">example</span></span><br><span class="line">        <span class="attr">state:</span> <span class="string">present</span></span><br></pre></td></tr></table></figure><h3 id="3、管理-Collection"><a href="#3、管理-Collection" class="headerlink" title="3、管理 Collection"></a>3、管理 Collection</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出已安装的 Collection：</span></span><br><span class="line">ansible-galaxy collection list</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">卸载 Collection：</span></span><br><span class="line">ansible-galaxy collection uninstall my_namespace.my_collection</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="使用-requirements-yml-文件管理-Collection"><a href="#使用-requirements-yml-文件管理-Collection" class="headerlink" title="使用 requirements.yml 文件管理 Collection"></a>使用 requirements.yml 文件管理 Collection</h3><blockquote><p>[!success] Title<br>创建一个 requirements.yml 文件来管理 Collection </p><p>collections模块中name通常为集合名字。<strong>如果直接提供 URL，格式为完整的链接。</strong></p></blockquote><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">collections:</span><br><span class="line">  - name: my_namespace.my_collection</span><br><span class="line">    source: https://my.custom.repo/path/to/collection/</span><br><span class="line">    version: 1.0.0</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">然后使用以下命令安装所有 Collection：</span></span><br><span class="line">ansible-galaxy collection install -r requirements.yml </span><br><span class="line"></span><br><span class="line">-r, --requirements</span><br><span class="line">从指定的 requirements 文件中安装 Collections。</span><br><span class="line"></span><br><span class="line">-p, --collections-path</span><br><span class="line">指定安装 Collections 的目录。如果没有指定，默认安装到系统的 Ansible Collections 路径。</span><br></pre></td></tr></table></figure><h1 id="七、ansible-galaxy"><a href="#七、ansible-galaxy" class="headerlink" title="七、ansible galaxy"></a>七、ansible galaxy</h1><p><a href="https://galaxy.ansible.com/ui/search/">https://galaxy.ansible.com/ui/search/</a><br>Ansible Galaxy 是一个在线平台，提供一个广泛的 Ansible 资源库，包括 <strong>角色（roles）</strong>、<strong>集合（collections）</strong> 和其他自动化内容。用户可以通过 Galaxy 搜索、下载和分享这些资源。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">安装角色</span></span><br><span class="line">ansible-galaxy role install &lt;role_name&gt;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">列出已安装的角色或集合：</span></span><br><span class="line">ansible-galaxy role list</span><br></pre></td></tr></table></figure><h1 id="八、debug-msg"><a href="#八、debug-msg" class="headerlink" title="八、debug  msg"></a>八、debug  msg</h1><p>在Ansible中，<code>debug</code>模块是一个非常有用的工具，它允许你在执行任务时输出变量的值或执行过程中的信息。这对于调试和理解你的Ansible playbooks的执行流程非常有用。</p><h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><ol><li><p><strong>基本用法</strong>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">a</span> <span class="string">debug</span> <span class="string">message</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">msg:</span> <span class="string">&quot;This is a debug message&quot;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>输出变量</strong>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">the</span> <span class="string">value</span> <span class="string">of</span> <span class="string">a</span> <span class="string">variable</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">msg:</span> <span class="string">&quot;The value of my_var is <span class="template-variable">&#123;&#123; my_var &#125;&#125;</span>&quot;</span></span><br></pre></td></tr></table></figure></li><li><p><strong>条件输出</strong>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">a</span> <span class="string">message</span> <span class="string">if</span> <span class="string">a</span> <span class="string">condition</span> <span class="string">is</span> <span class="string">met</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">msg:</span> <span class="string">&quot;This will only print if the condition is true&quot;</span></span><br><span class="line">  <span class="attr">when:</span> <span class="string">my_condition</span> <span class="string">is</span> <span class="string">defined</span> <span class="string">and</span> <span class="string">my_condition</span></span><br></pre></td></tr></table></figure></li><li><p><strong>输出变量内容</strong>:</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Print</span> <span class="string">the</span> <span class="string">content</span> <span class="string">of</span> <span class="string">a</span> <span class="string">variable</span></span><br><span class="line">  <span class="attr">debug:</span></span><br><span class="line">    <span class="attr">var:</span> <span class="string">my_var</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="调试技巧"><a href="#调试技巧" class="headerlink" title="调试技巧"></a>调试技巧</h3><ul><li><strong>在每个任务后添加debug模块</strong>: 这可以帮助你跟踪变量的值和任务的执行状态。</li><li><strong>使用<code>when</code>条件</strong>: 只在特定条件下输出信息，避免不必要的输出。</li><li><strong>使用<code>verbosity</code></strong>: 通过增加verbosity级别，可以输出更多的调试信息。在命令行中使用<code>-v</code>或<code>-vv</code>参数。</li></ul><h1 id="九、ansible-vault"><a href="#九、ansible-vault" class="headerlink" title="九、ansible-vault"></a>九、ansible-vault</h1><p><code>ansible-vault</code> 是一个用于加密和解密敏感数据的工具。它允许你以加密的形式存储敏感信息，如密码、密钥或任何其他敏感数据，以确保这些信息在Playbooks和变量文件中不会被暴露。</p>]]></content>
    
    
    <summary type="html">&quot;开源的自动化工具，专门用于配置管理、应用程序部署以及 IT 基础设施的自动化。采用无代理（agentless）设计。Ansible 能够轻松地将系统或应用配置推送到多台机器上，确保一致性和可靠性。&quot;</summary>
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    
    <category term="DevOps" scheme="https://nikieuphoria.github.io/tags/DevOps/"/>
    
    <category term="运维" scheme="https://nikieuphoria.github.io/tags/%E8%BF%90%E7%BB%B4/"/>
    
    <category term="#Automation" scheme="https://nikieuphoria.github.io/tags/Automation/"/>
    
  </entry>
  
  <entry>
    <title>linux用户与组管理</title>
    <link href="https://nikieuphoria.github.io/2024/07/20/%E7%94%A8%E6%88%B7%E4%B8%8E%E7%BB%84%E7%AE%A1%E7%90%86/"/>
    <id>https://nikieuphoria.github.io/2024/07/20/%E7%94%A8%E6%88%B7%E4%B8%8E%E7%BB%84%E7%AE%A1%E7%90%86/</id>
    <published>2024-07-19T16:00:00.000Z</published>
    <updated>2025-05-07T09:51:43.347Z</updated>
    
    <content type="html"><![CDATA[<h2 id="用户与组管理"><a href="#用户与组管理" class="headerlink" title="用户与组管理"></a>用户与组管理</h2><h3 id="useradd创建用户"><a href="#useradd创建用户" class="headerlink" title="useradd创建用户"></a>useradd创建用户</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">常用选项：</span><br><span class="line">-u 指定用户UID</span><br><span class="line">-d 指定用户家目录</span><br><span class="line">-c --comment用户描述信息</span><br><span class="line">-g 指定用户gid</span><br><span class="line">-G 指定用户附加组（次要组）</span><br><span class="line">-s --shell指定用户的解释器程序   </span><br><span class="line">⽆权访问系统上的交互式shell：/sbin/noloogin   /bin/false</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建用户指定用户UID、描述信息、附加组</span></span><br><span class="line">[root@localhost ~]# useradd -u 1600 -c yunwei -G <span class="built_in">test</span> xiaozhang</span><br><span class="line">[root@localhost ~]# <span class="built_in">id</span> xiaozhang</span><br><span class="line">uid=1600(xiaozhang) gid=1600(xiaozhang) 组=1600(xiaozhang),1401(<span class="built_in">test</span>)</span><br></pre></td></tr></table></figure><h3 id="groupadd创建组"><a href="#groupadd创建组" class="headerlink" title="groupadd创建组"></a>groupadd创建组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建组</span></span><br><span class="line"> groupadd -g GID   <span class="comment">#指定组的GID</span></span><br><span class="line">[root@localhost ~]# groupadd -g 1555 student</span><br></pre></td></tr></table></figure><h3 id="chgrp改变文件或目录所属组"><a href="#chgrp改变文件或目录所属组" class="headerlink" title="chgrp改变文件或目录所属组"></a>chgrp改变文件或目录所属组</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看文件或目录所属组</span></span><br><span class="line"><span class="built_in">ls</span> -l</span><br><span class="line"></span><br><span class="line"><span class="built_in">chgrp</span> [选项] [所属组] 文件/目录</span><br><span class="line">--reference=RFILE  使用参考文件的所属组</span><br><span class="line">-R  递归的更改目录下的所有目录以及文件</span><br><span class="line"></span><br><span class="line"><span class="built_in">chgrp</span> group1 /etc/niki</span><br><span class="line"></span><br><span class="line">sgid：给目录设置了sgid权限，在该目录下创建的文件或者目录的**属组**都与该目录一致</span><br><span class="line"></span><br><span class="line">授权格式：</span><br><span class="line"><span class="built_in">chmod</span> g+s 文件名称</span><br><span class="line">撤销格式：</span><br><span class="line"><span class="built_in">chmod</span> g-s 文件名称</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="chown归属关系管理"><a href="#chown归属关系管理" class="headerlink" title="chown归属关系管理"></a>chown归属关系管理</h3><p>chown（英文全拼：change owner）用于设置文件的所有者和所属组关系</p><ul><li>命令格式：<ul><li>chown [-选项] 所有者:所属组 文档</li><li>chown [-选项] 所有者 文档</li><li>chown [-选项] :所属组 文档</li></ul></li><li>常用选项:<ul><li><code>R</code> 递归地改变指定目录及其子目录和文件的所有者</li></ul></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改文件所有者与所属组为lisi</span></span><br><span class="line">[root@localhost ~]# <span class="built_in">chown</span> lisi:lisi /hello.txt </span><br></pre></td></tr></table></figure><h3 id="id查看信息"><a href="#id查看信息" class="headerlink" title="id查看信息"></a>id查看信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# <span class="built_in">id</span> user1</span><br><span class="line">uid=1001(user1) gid=1001(user1) 组=1001(user1)</span><br></pre></td></tr></table></figure><h3 id="passwd修改密码"><a href="#passwd修改密码" class="headerlink" title="passwd修改密码"></a>passwd修改密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置用户密码</span></span><br><span class="line">[root@localhost ~]# passwd user1</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> 密码 |passwd --stdin user1</span><br></pre></td></tr></table></figure><h3 id="etc-passwd用户信息文件"><a href="#etc-passwd用户信息文件" class="headerlink" title="&#x2F;etc&#x2F;passwd用户信息文件"></a>&#x2F;etc&#x2F;passwd用户信息文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">**[root@localhost ~]# vim /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line"><span class="comment">#每个字段含义解释：用户名:密码占位符:UID:基本组GID:用户描述信息:家目录:解释器程序</span></span><br><span class="line">UID：0 超级用户</span><br><span class="line">UID：1-999 系统伪用户，不能登录系统</span><br><span class="line">UID：1000-65535 普通用户，管理员创建的用户**</span><br></pre></td></tr></table></figure><h3 id="wheel用户组"><a href="#wheel用户组" class="headerlink" title="wheel用户组"></a>wheel用户组</h3><p><a href="https://www.cnblogs.com/linuxshare/p/18609179">linux中的wheel用户 - 爱折腾的大臭臭 - 博客园</a></p>]]></content>
    
    
    <summary type="html">&quot;Linux 系统中用户和组管理的基本操作，包括如何创建用户和组、修改文件所属的用户和组，以及管理用户密码等。&quot;</summary>
    
    
    
    <category term="lifelong learning" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/"/>
    
    <category term="技术" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/"/>
    
    <category term="linux" scheme="https://nikieuphoria.github.io/categories/lifelong-learning/%E6%8A%80%E6%9C%AF/linux/"/>
    
    
    <category term="linux" scheme="https://nikieuphoria.github.io/tags/linux/"/>
    
  </entry>
  
</feed>
